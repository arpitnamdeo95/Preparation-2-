<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Cache busting - force browser to reload -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Velosify | Neural Study OS</title>
    <link rel="icon" type="image/svg+xml" href="velosify-logo.svg?v=4" />
    <link rel="shortcut icon" href="velosify-logo.svg?v=4" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.469.0/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <!-- Prism language extensions commented out to fix initialization error -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script> -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #05050a;
            color: #e2e8f0;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        html.light body {
            background-color: #f1f5f9;
            color: #0f172a;
        }

        :root {
            --brand-500: 99 102 241;
            --brand-600: 79 70 229;
            --brand-400: 129 140 248;
        }

        .scifi-grid {
            position: fixed;
            width: 200%;
            height: 200%;
            bottom: -50%;
            left: -50%;
            background-image: linear-gradient(rgb(var(--brand-500)/0.15) 1px, transparent 1px), linear-gradient(90deg, rgb(var(--brand-500)/0.15) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            animation: grid-move 30s linear infinite;
            z-index: -2;
            opacity: 0.3;
            mask-image: linear-gradient(to top, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));
        }

        html.light .scifi-grid {
            background-image: linear-gradient(rgb(var(--brand-500)/0.1) 1px, transparent 1px), linear-gradient(90deg, rgb(var(--brand-500)/0.1) 1px, transparent 1px);
            opacity: 0.5;
        }

        .holo-card {
            background: rgba(10, 10, 15, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2), 0 8px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            --topic-color: rgba(var(--brand-500), 0.5);
            --topic-glow: rgba(var(--brand-500), 0.1);
        }

        html.light .holo-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            backdrop-filter: none;
        }

        .holo-card:hover {
            border-color: var(--topic-color);
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 40px var(--topic-glow);
        }

        html.light .holo-card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        html.light .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        html.light .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(var(--brand-500), 0.5);
        }

        /* Input Styles For Light Mode */
        html.light input,
        html.light select,
        html.light textarea {
            background-color: #ffffff !important;
            border-color: #cbd5e1 !important;
            color: #0f172a !important;
        }

        html.light input:focus,
        html.light select:focus,
        html.light textarea:focus {
            border-color: rgb(var(--brand-500)) !important;
            box-shadow: 0 0 0 2px rgba(var(--brand-500), 0.1) !important;
        }

        @keyframes grid-move {
            0% {
                transform: perspective(500px) rotateX(60deg) translateY(0);
            }

            100% {
                transform: perspective(500px) rotateX(60deg) translateY(50px);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.2, 0.9, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .perspective-1000 {
            perspective: 1000px;
        }

        .transform-style-3d {
            transform-style: preserve-3d;
        }

        .backface-hidden {
            backface-visibility: hidden;
        }

        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        /* Typography & Overrides */
        html.light .text-slate-400,
        html.light .text-slate-500 {
            color: #64748b;
        }

        html.light .text-white {
            color: #0f172a;
        }

        html.light .bg-black\/50,
        html.light .bg-black\/20,
        html.light .bg-black\/40 {
            background-color: rgba(255, 255, 255, 0.5);
        }

        html.light .border-white\/10,
        html.light .border-white\/5 {
            border-color: rgba(0, 0, 0, 0.05);
        }

        html.light .bg-white\/5 {
            background-color: rgba(0, 0, 0, 0.02);
        }

        html.light .hover:bg-white\/10:hover {
            background-color: rgba(0, 0, 0, 0.04);
        }

        /* Scrollbar track fix */
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        html.light ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            500: 'rgb(var(--brand-500) / <alpha-value>)',
                            600: 'rgb(var(--brand-600) / <alpha-value>)',
                            400: 'rgb(var(--brand-400) / <alpha-value>)'
                        },
                        surface: {
                            800: '#1e293b',
                            900: '#0f172a'
                        },
                        'neon-blue': '#00f3ff',
                        'neon-purple': '#a855f7',
                        'neon-green': '#22c55e',
                    },
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    animation: {
                        shimmer: 'shimmer 1.5s infinite',
                        blob: 'blob 20s infinite linear',
                        breathe: 'breathe 3s infinite ease-in-out',
                        marquee: 'marquee 40s linear infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '100%': { transform: 'translateX(100%)' }
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        breathe: {
                            '0%, 100%': { opacity: '0.6', transform: 'scale(1)' },
                            '50%': { opacity: '1', transform: 'scale(1.05)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0%)' },
                            '100%': { transform: 'translateX(-50%)' }
                        }
                    }
                }
            }
        }
    </script>
</head>

<body>
    <div id="boot-screen"
        class="fixed inset-0 z-50 bg-[#05050a] flex flex-col items-center justify-center text-white transition-opacity duration-500">
        <div class="loader mb-6 w-12 h-12 border-2 border-brand-500 border-t-transparent rounded-full animate-spin">
        </div>
        <h2 class="text-xl font-bold tracking-widest">VELOSIFY v2.0</h2>
        <p class="text-[10px] text-brand-400 mt-2 font-mono tracking-[0.3em] opacity-70 animate-pulse">SYSTEM
            INITIALIZATION</p>
    </div>
    <div
        class="fixed top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-blue-900/10 via-black to-black pointer-events-none z-[-1]">
    </div>
    <div class="scifi-grid"></div>
    <div id="root"></div>

    <script>
        window.SUPABASE_URL = "https://wgjwgovcarpsvvmwuaww.supabase.co";
        window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indnandnb3ZjYXJwc3Z2bXd1YXd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNDQ3NTksImV4cCI6MjA4NTYyMDc1OX0.Up0WU1xqUH5ZqAPpz0lVypZrcr9RJOjcMEKwG399f_A";
        window.sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
        window.__SESSION__ = null;

        async function boot() {
            try {
                const { data } = await window.sb.auth.getSession();
                window.__SESSION__ = data.session;
                if (window.location.hash?.includes('access_token')) {
                    const { data: { session } } = await window.sb.auth.getSession();
                    window.__SESSION__ = session;
                    window.history.replaceState(null, null, window.location.pathname);
                }
            } catch (e) { console.error("Boot:", e); window.__SESSION__ = null; }
            finally {
                window.dispatchEvent(new Event('velosify-ready'));
                setTimeout(() => { const el = document.getElementById('boot-screen'); el.style.opacity = '0'; setTimeout(() => el.remove(), 500); }, 800);
            }
        }
        boot();
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        /* --- ICONS & UI --- */
        const Icon = ({ name, size = 18, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (!window.lucide) return;
                try {
                    // Try PascalCase
                    const pascal = name.replace(/(^|-)([a-z])/g, (_, __, c) => c.toUpperCase());
                    const iconDef = window.lucide.icons?.[pascal] || window.lucide[pascal];

                    if (iconDef && ref.current) {
                        const svg = window.lucide.createElement(iconDef);
                        svg.setAttribute('width', size);
                        svg.setAttribute('height', size);
                        svg.setAttribute('stroke-width', '2');
                        ref.current.innerHTML = '';
                        ref.current.appendChild(svg);
                    } else if (ref.current) {
                        ref.current.innerHTML = `<i data-lucide="${name}" style="width: ${size}px; height: ${size}px;"></i>`;
                        window.lucide.createIcons({
                            attrs: { width: size, height: size, "stroke-width": 2 },
                            root: ref.current
                        });
                    }
                } catch (e) {
                    console.error("Icon error:", name, e);
                }
            }, [name, size]);
            return <span ref={ref} className={className} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', minWidth: size, minHeight: size }} />;
        };

        const TOPIC_CONFIG = {
            js: { name: 'JavaScript', color: '#F7DF1E', bg: 'rgba(247, 223, 30, 0.1)', border: 'rgba(247, 223, 30, 0.2)', text: '#F7DF1E', glow: 'rgba(247, 223, 30, 0.4)', icon: 'code-2' },
            'js-arch': { name: 'JS Systems Architecture', color: '#F7DF1E', bg: 'rgba(247, 223, 30, 0.1)', border: 'rgba(247, 223, 30, 0.2)', text: '#F7DF1E', glow: 'rgba(247, 223, 30, 0.6)', icon: 'cpu' },
            python: { name: 'Python', color: '#3776AB', bg: 'rgba(55, 118, 171, 0.1)', border: 'rgba(55, 118, 171, 0.2)', text: '#3776AB', glow: 'rgba(55, 118, 171, 0.4)', icon: 'terminal' },
            react: { name: 'React', color: '#61DAFB', bg: 'rgba(97, 218, 251, 0.1)', border: 'rgba(97, 218, 251, 0.2)', text: '#61DAFB', glow: 'rgba(97, 218, 251, 0.4)', icon: 'component' },
            node: { name: 'Node.js', color: '#339933', bg: 'rgba(51, 153, 51, 0.1)', border: 'rgba(51, 153, 51, 0.2)', text: '#339933', glow: 'rgba(51, 153, 51, 0.4)', icon: 'server' },
            html: { name: 'HTML5', color: '#E34F26', bg: 'rgba(227, 79, 38, 0.1)', border: 'rgba(227, 79, 38, 0.2)', text: '#E34F26', glow: 'rgba(227, 79, 38, 0.4)', icon: 'layout' },
            css: { name: 'CSS3', color: '#1572B6', bg: 'rgba(21, 114, 182, 0.1)', border: 'rgba(21, 114, 182, 0.2)', text: '#1572B6', glow: 'rgba(21, 114, 182, 0.4)', icon: 'palette' },
            'sql-dsa': { name: 'SQL Mastery & DSA', color: '#A855F7', bg: 'rgba(168, 85, 247, 0.1)', border: 'rgba(168, 85, 247, 0.2)', text: '#A855F7', glow: 'rgba(168, 85, 247, 0.4)', icon: 'database' },
            git: { name: 'Git', color: '#F05032', bg: 'rgba(240, 80, 50, 0.1)', border: 'rgba(240, 80, 50, 0.2)', text: '#F05032', glow: 'rgba(240, 80, 50, 0.4)', icon: 'git-branch' },
            'sys-design': { name: 'Systems Design & Scalability', color: '#00F3FF', bg: 'rgba(0, 243, 255, 0.1)', border: 'rgba(0, 243, 255, 0.2)', text: '#00F3FF', glow: 'rgba(0, 243, 255, 0.4)', icon: 'layers' },
            'sys-design-primer': { name: 'System Design Primer', color: '#6366F1', bg: 'rgba(99, 102, 241, 0.1)', border: 'rgba(99, 102, 241, 0.2)', text: '#6366F1', glow: 'rgba(99, 102, 241, 0.4)', icon: 'layout' },
            'interview-protocol': { name: 'Executive Interview Protocol', color: '#3B82F6', bg: 'rgba(59, 130, 246, 0.1)', border: 'rgba(59, 130, 246, 0.2)', text: '#3B82F6', glow: 'rgba(59, 130, 246, 0.4)', icon: 'briefcase' },
            'resume-template': { name: 'Modern Resume Template', color: '#10B981', bg: 'rgba(16, 185, 129, 0.1)', border: 'rgba(16, 185, 129, 0.2)', text: '#10B981', glow: 'rgba(16, 185, 129, 0.4)', icon: 'file-text' },
            hr: { name: 'HR/SOP', color: '#707070', bg: 'rgba(112, 112, 112, 0.1)', border: 'rgba(112, 112, 112, 0.2)', text: '#707070', glow: 'rgba(112, 112, 112, 0.4)', icon: 'file-text' },
            default: { name: 'Learning', color: '#6366f1', bg: 'rgba(99, 102, 241, 0.1)', border: 'rgba(99, 102, 241, 0.2)', text: '#6366f1', glow: 'rgba(99, 102, 241, 0.4)', icon: 'graduation-cap' }
        };

        const STRUCTURED_LEARNING_DATA = {
            'sql-dsa': {
                id: 'sql-dsa',
                title: 'SQL Mastery & DSA',
                certification: {
                    name: 'Database Architect',
                    level: 'Gold',
                    badgeId: 'SQL-ARCH-001',
                    requirements: 'Complete all 5 Phases + Capstone'
                },
                modules: [
                    {
                        id: 'phase-1',
                        type: 'module',
                        title: 'Phase 1: Foundations',
                        description: 'Relational algebra, ACID properties, and the physical storage engine.',
                        sections: [
                            { title: 'The ACID Protocol', body: 'Atomicity, Consistency, Isolation, Durability. The non-negotiable laws of transactional integrity. Understanding WAL (Write-Ahead Logging).' },
                            { title: 'B-Tree Internals', body: 'Why B-Trees? O(log n) search. Branching factors and page sizes (8kb/16kb). The difference between Clustered and Non-Clustered indexes.' }
                        ],
                        practical: {
                            snippets: [
                                { lang: 'sql', title: 'Transaction Isolation', code: 'BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n-- Strict consistency check\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;\nCOMMIT;' }
                            ]
                        }
                    },
                    {
                        id: 'phase-2',
                        type: 'module',
                        title: 'Phase 2: Query Optimization',
                        description: 'Execution Plan analysis and Indexing strategies.',
                        sections: [
                            { title: 'Explain Analyze', body: 'Reading the query plan. Seq Scan vs Index Scan vs Bitmap Heap Scan. Cost estimation logic.' },
                            { title: 'The N+1 Problem', body: 'Detecting and fixing implicit loops in ORMs. Using eager loading and JOINs effectively.' }
                        ],
                        practical: {
                            snippets: [
                                { lang: 'sql', title: 'Analyzing Costs', code: 'EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM users WHERE last_login > NOW() - INTERVAL \'1 day\';' }
                            ]
                        }
                    },
                    {
                        id: 'phase-3',
                        type: 'module',
                        title: 'Phase 3: Adv. Data Structures',
                        description: 'LSM Trees, Bloom Filters, and Geo-Spatial Indexes.',
                        sections: [
                            { title: 'LSM Trees (Log-Structured Merge)', body: 'The engine behind NoSQL (Cassandra, RocksDB). Optimizing for heavy write throughput over read latency.' },
                            { title: 'Bloom Filters', body: 'Probabilistic data structures for existence checks. "Might be there, definitely not there".' }
                        ]
                    },
                    {
                        id: 'phase-4',
                        type: 'module',
                        title: 'Phase 4: Distributed SQL',
                        description: 'Sharding, Replication, and CAP Theorem in practice.',
                        sections: [
                            { title: 'Sharding Strategies', body: 'Horizontal partitioning. Range based vs Hash based. Handling "Hot Shards".' },
                            { title: 'Leaderless Replication', body: 'Quorum reads/writes (R + W > N). Handling conflict resolution (Last Write Wins, Vector Clocks).' }
                        ]
                    },
                    {
                        id: 'phase-5',
                        type: 'module',
                        title: 'Phase 5: Real-World Ops',
                        description: 'Interview patterns and production debugging.',
                        sections: [
                            { title: 'Deadlock Debugging', body: 'Identifying circular dependencies in locking. deadlock_timeout configurations.' },
                            { title: 'Vacuuming & Maintenance', body: 'PostgreSQL MVCC cleanup. Auto-vacuum tuning for high-churn tables.' }
                        ],
                        quiz: [
                            { question: 'Which isolation level prevents Phantom Reads?', options: ['Read Committed', 'Repeatable Read', 'Serializable'], correctAnswer: 'Serializable' },
                            { question: 'What is a "Covering Index"?', options: ['An index that hides data', 'An index containing all queried columns', 'A backup index'], correctAnswer: 'An index containing all queried columns' }
                        ]
                    }
                ]
            },
            'sys-design-primer': {
                id: 'sys-design-primer',
                title: 'System Design Primer',
                certification: { name: 'Systems Architect I', level: 'Silver', badgeId: 'ARCH-001' },
                modules: [
                    {
                        title: 'Foundations of Scale',
                        description: 'Vertical vs Horizontal Scaling. The hardware limits.',
                        sections: [
                            { title: 'Throughput vs Latency', body: 'Understanding the trade-offs. 100ms latency rule. P99 percentiles.' },
                            { title: 'Load Balancing', body: 'L4 vs L7 balancing. Round robin, Least Connections, IP Hash algorithms.' }
                        ]
                    },
                    {
                        title: 'Everything is a Trade-off',
                        description: 'CAP Theorem and Consistency Models.',
                        sections: [
                            { title: 'Consistency vs Availability', body: 'Eventual Consistency in social networks vs Strong Consistency in banking.' },
                            { title: 'PACELC Theorem', body: 'An extension of CAP: even when not partitioned (P), one must choose between Latency (L) and Consistency (C).' }
                        ]
                    }
                ]
            },
            'sys-design': {
                id: 'sys-design',
                title: 'Systems Design & Scalability',
                certification: { name: 'Systems Architect II', level: 'Elite', badgeId: 'ARCH-002' },
                modules: [
                    {
                        title: 'The 100M User Architecture',
                        description: 'Designing for global scale and fault tolerance.',
                        sections: [
                            { title: 'Global CDN Strategy', body: 'Edge computing. Caching static assets. Anycast DNS.' },
                            { title: 'Database Federation', body: 'Splitting DBs by function (User DB, Content DB, Analytics DB).' }
                        ],
                        practical: {
                            snippets: [{ lang: 'yaml', title: 'Kubernetes Autoscaler', code: 'minReplicas: 10\nmaxReplicas: 500\ntargetCPUUtilizationPercentage: 70' }]
                        }
                    },
                    {
                        title: 'Resiliency Patterns',
                        description: 'Circuit Breakers, Bulkheads, and Graceful Degradation.',
                        sections: [
                            { title: 'The Circuit Breaker', body: 'Preventing cascading failures. If a service fails 5 times, stop calling it for 30s.' },
                            { title: 'Rate Limiting', body: 'Token Bucket algorithm vs Leaky Bucket. Protecting the core API.' }
                        ]
                    }
                ]
            },
            'js-arch': {
                id: 'js-arch',
                title: 'JavaScript Systems Architecture',
                certification: { name: 'JS Core Engineer', level: 'Gold', badgeId: 'JS-CORE-001' },
                modules: [
                    {
                        title: 'V8 Engine Internals',
                        description: 'JIT Compilation, Hidden Classes, and Inline Caching.',
                        sections: [
                            { title: 'Bytecode to Machine Code', body: 'Ignition interpreter and TurboFan compiler. Optimization triggers.' },
                            { title: 'Garbage Collection', body: 'Orinoco (Parallel), Scavenger (Minor GC), and Mark-Sweep-Compact (Major GC).' }
                        ]
                    },
                    {
                        title: 'Memory Management Pattern',
                        description: 'Avoiding leaks in long-running Node.js processes.',
                        sections: [
                            { title: 'Heap Snapshots', body: 'Using Chrome DevTools to find detached DOM nodes and closure leaks.' },
                            { title: 'Streams & Buffers', body: 'Handling GBs of data with minimal RAM using piping.' }
                        ]
                    }
                ]
            },
            'interview-protocol': {
                id: 'interview-protocol',
                title: 'Executive Interview Protocol',
                certification: { name: 'Executive Presence', level: 'Elite', badgeId: 'EXEC-001' },
                modules: [
                    {
                        title: 'The C-Suite Mindset',
                        description: 'Thinking like a partner, not a resource.',
                        sections: [
                            { title: 'Strategic Alignment', body: 'Connect your technical wins to business revenue/savings. Speak in ROI.' },
                            { title: 'The "Turnaround" Story', body: 'How you took a failing project and made it a success. Focus on the decision framework.' }
                        ]
                    },
                    {
                        title: 'Negotiation Leverage',
                        description: 'Maximizing compensation and autonomy.',
                        sections: [
                            { title: 'The Anchor Point', body: 'Never give the first number unless you know the band. Anchor high based on market research.' },
                            { title: 'Equity vs Cash', body: 'Evaluating RSUs/Options involves risk assessment of the company valuation.' }
                        ]
                    }
                ]
            },
            'resume-template': {
                id: 'resume-template',
                title: 'Modern Resume Template',
                certification: { name: 'Career Ready', level: 'Bronze', badgeId: 'CAREER-001' },
                modules: [
                    {
                        title: 'ATS Optimization',
                        description: 'Beating the bots to get to the human.',
                        sections: [
                            { title: 'Keyword Density', body: 'Matching the JD keywords without "stuffing". Contextual usage.' },
                            { title: 'Formatting Standards', body: 'Single column (mostly). Standard headers. No graphics for backend roles.' }
                        ]
                    },
                    {
                        title: 'The Impact Narrative',
                        description: 'Writing bullet points that sell.',
                        sections: [
                            { title: 'Quantifiable Metrics', body: 'Numbers pop. "Reduced latency by 50%" is better than "Optimized API".' },
                            { title: 'Action Verbs', body: 'Architected, Spearheaded, Deployed. Avoid "Helped with" or "Worked on".' }
                        ]
                    }
                ]
            },
            'hr': {
                id: 'hr',
                title: 'Neural Culture & Values',
                certification: { name: 'Cultural Architect', level: 'Silver', badgeId: 'CULT-001' },
                modules: [
                    {
                        title: 'Mission & Vision',
                        description: 'The "Why" behind Velosify.',
                        sections: [
                            { title: 'Cognitive Augmentation', body: 'We are building tools to expand the human mind, not replace it.' },
                            { title: 'High Velocity', body: 'Moving fast with precision. Direction matters as much as speed.' }
                        ]
                    },
                    {
                        title: 'Operating Principles',
                        description: 'How we make decisions.',
                        sections: [
                            { title: 'Disagree and Commit', body: 'Debate vigorously, but once a decision is made, support it 100%.' },
                            { title: 'Customer Obsession', body: 'Working backwards from the customer needs, even if it requires new skills.' }
                        ]
                    }
                ]
            }
        };

        const TopicIcon = ({ topic, size = 24, className = "" }) => {
            const config = TOPIC_CONFIG[topic] || TOPIC_CONFIG.default;
            const paths = {
                js: <path d="M3 3h18v18H3V3zm7 11.5c0 .8.7 1.5 1.5 1.5s1.5-.7 1.5-1.5v-2c0-.8-.7-1.5-1.5-1.5s-1.5.7-1.5 1.5v2zm4-3.5h3v5h-3v-5zM14 13h3" stroke="currentColor" strokeWidth="1.5" />,
                python: <path d="M12 2c-2.8 0-5 2.2-5 5v2h5v1H5c-1.7 0-3 1.3-3 3v4c0 1.7 1.3 3 3 3h2v-2c0-1.7 1.3-3 3-3h5c1.7 0 3-1.3 3-3V7c0-2.8-2.2-5-5-5z M12 22c2.8 0 5-2.2 5-5v-2h-5v-1h7c1.7 0 3-1.3 3-3V7c0-1.7-1.3-3-3-3h-2v2c0 1.7-1.3 3-3 3H9c-1.7 0-3 1.3-3 3v4c0 2.8 2.2 5 5 5z" stroke="currentColor" strokeWidth="1" />,
                react: <g stroke="currentColor" strokeWidth="1"><ellipse rx="10" ry="4.5" /><ellipse rx="10" ry="4.5" transform="rotate(60)" /><ellipse rx="10" ry="4.5" transform="rotate(120)" /><circle r="2" fill="currentColor" /></g>,
                html: <path d="M12 2l8 2-1.5 14L12 22l-6.5-4L4 4l8-2z M12 6v12l4-2.5L16.5 8 12 6z" stroke="currentColor" strokeWidth="1.5" />,
                css: <path d="M12 2l8 2-1.5 14L12 22l-6.5-4L4 4l8-2z M12 6h4l-.5 4.5h-3.5v2.5h3l-.5 3.5-3 1.5-3-1.5.2-1.5" stroke="currentColor" strokeWidth="1.5" fill="none" />,
                'sql-dsa': <g stroke="currentColor" strokeWidth="1.5"><path d="M12 2c6 0 6 2 6 2v10s0 2-6 2-6-2-6-2V4s0-2 6-2z" /><path d="M6 8c0 2 6 2 6 2s6 0 6-2" /><path d="M6 12c0 2 6 2 6 2s6 0 6-2" /><circle cx="18" cy="18" r="3" /><path d="M15 18h-3" /></g>,
                'sys-design': <g stroke="currentColor" strokeWidth="1.5"><rect x="2" y="2" width="6" height="6" rx="1" /><rect x="16" y="2" width="6" height="6" rx="1" /><rect x="9" y="14" width="6" height="6" rx="1" /><path d="M5 8v4h6m10-4v4h-6" /></g>,
                'sys-design-primer': <g stroke="currentColor" strokeWidth="1.5"><rect x="3" y="3" width="18" height="18" rx="2" /><path d="M3 9h18M9 21V9" /></g>,
                'js-arch': <g stroke="currentColor" strokeWidth="1.5"><rect x="4" y="4" width="16" height="16" rx="2" /><path d="M9 9h6v6H9z" /><path d="M12 2v2M12 20v2M2 12h2M20 12h2" /></g>,
                'interview-protocol': <g stroke="currentColor" strokeWidth="1.5"><path d="M16 3.13a4 4 0 0 1 0 7.75M16 19v-2a4 4 0 0 0-3-3.87M3 11a4 4 0 1 1 8 0 4 4 0 0 1-8 0zM7 21v-2a4 4 0 0 1 4-4" /></g>,
                'resume-template': <g stroke="currentColor" strokeWidth="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" /></g>,
                'company-culture': <g stroke="currentColor" strokeWidth="1.5"><path d="M12 2c0 0-4 4-4 8a4 4 0 0 0 8 0c0-4-4-8-4-8z" /><path d="M12 22s-9-5-9-11V5l9-3 9 3v6c0 6-9 11-9 11z" strokeOpacity="0.3" /><circle cx="12" cy="12" r="3" strokeDasharray="2 2" /></g>
            };

            if (paths[topic]) {
                const isReact = topic === 'react';
                return (
                    <svg width={size} height={size} viewBox={isReact ? "-12 -12 24 24" : "0 0 24 24"} fill="none" className={className} xmlns="http://www.w3.org/2000/svg">
                        {paths[topic]}
                    </svg>
                );
            }
            return <Icon name={config.icon} size={size} className={className} />;
        };

        const Logo = ({ className = "w-8 h-8" }) => (
            <svg
                viewBox="0 0 512 512"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className={className}
            >
                <path d="M128 128 L256 384 L384 128" stroke="currentColor" strokeWidth="60" strokeLinecap="round" strokeLinejoin="round" />
                <circle cx="128" cy="128" r="40" fill="#00f3ff" />
                <circle cx="384" cy="128" r="40" fill="#a855f7" />
                <circle cx="256" cy="384" r="40" fill="#22c55e" />
            </svg>
        );

        const StatLogo = ({ type, className = "w-6 h-6" }) => {
            const logos = {
                library: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                        <circle cx="12" cy="7" r="1.5" fill="currentColor" fillOpacity="0.3" />
                    </svg>
                ),
                protocols: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        <path d="M12 8v4M12 16h.01" strokeWidth="2" strokeLinecap="round" />
                        <circle cx="12" cy="12" r="6" strokeDasharray="2 2" />
                    </svg>
                ),
                streams: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M10 8l6 4-6 4V8z" fill="currentColor" />
                        <circle cx="12" cy="12" r="6" strokeDasharray="3 3" opacity="0.5" />
                    </svg>
                ),
                assets: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                        <path d="M14 2v6h6M8 13h8M8 17h8M8 9h2" />
                        <circle cx="18" cy="18" r="4" strokeDasharray="2 1" opacity="0.4" />
                    </svg>
                ),
                paths: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                        <path d="M6 12v5c3 3 9 3 12 0v-5" />
                        <circle cx="12" cy="10" r="2" fill="currentColor" fillOpacity="0.3" />
                    </svg>
                ),
                modules: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                        <path d="m9 12 2 2 4-4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                        <path d="M12 18V6M6 12h12" strokeOpacity="0.2" />
                    </svg>
                ),
                velocity: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="currentColor" fillOpacity="0.2" />
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" strokeLinecap="round" strokeLinejoin="round" />
                        <circle cx="12" cy="12" r="9" strokeOpacity="0.1" strokeDasharray="2 2" />
                    </svg>
                ),
                compliance: (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        <path d="M12 22s-8-4-8-10V5l8-3 8 3v7c0 6-8 10-8 10z" strokeOpacity="0.3" />
                        <path d="M9 12l2 2 4-4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                    </svg>
                ),
                'vault-hero': (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" strokeOpacity="0.2" />
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        <path d="M12 8v4l3 3" strokeLinecap="round" />
                        <circle cx="12" cy="12" r="6" strokeDasharray="3 3" />
                    </svg>
                ),
                'hr-hero': (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M9.5 20H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v13a2 2 0 01-2 2h-4.5" />
                        <path d="M12 20v2M12 17a3 3 0 100-6 3 3 0 000 6z" />
                        <path d="M12 11V3M7 7h10M8 11h8" strokeOpacity="0.5" />
                        <circle cx="12" cy="14" r="1.5" fill="currentColor" />
                    </svg>
                ),
                'culture-hero': (
                    <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="1.5">
                        <path d="M12 2c0 0-4 4-4 8a4 4 0 008 0c0-4-4-8-4-8z" strokeOpacity="0.5" />
                        <path d="M12 6c0 0-3 3-3 6a3 3 0 006 0c0-3-3-6-3-6z" fill="currentColor" fillOpacity="0.2" />
                        <path d="M12 22s-9-5-9-11V5l9-3 9 3v6c0 6-9 11-9 11z" strokeOpacity="0.2" />
                        <circle cx="12" cy="12" r="3" strokeDasharray="2 2" />
                    </svg>
                )
            };
            return logos[type] || logos.library;
        };

        const cn = (...c) => c.filter(Boolean).join(" ");
        const Card = ({ children, className = "", onClick }) => <div onClick={onClick} className={cn("holo-card rounded-2xl p-6 relative overflow-hidden group transition-all duration-200 ease-out hover:scale-[1.02] active:scale-[0.98] hover:shadow-lg hover:shadow-blue-500/10 dark:hover:shadow-black/50", className)}>{children}</div>;
        const Button = ({ children, onClick, variant = 'primary', className = "", icon = null, type = "button" }) => {
            const v = { primary: "bg-brand-600 text-white hover:bg-brand-500 shadow-[0_0_20px_rgba(var(--brand-500),0.3)]", secondary: "bg-white/5 border border-white/10 hover:bg-white/10 text-slate-200", danger: "bg-red-500/10 text-red-400 border border-red-500/30 hover:bg-red-500/20" };
            return <button type={type} onClick={onClick} className={cn("flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-[10px] font-bold transition-all duration-200 ease-out hover:scale-105 active:scale-95 uppercase tracking-widest", v[variant], className)}>{icon && <Icon name={icon} size={13} />}{children}</button>;
        };

        /* --- AUTH PAGE MODAL --- */
        const AuthModal = ({ onClose }) => {
            const [email, setEmail] = useState(""); const [password, setPassword] = useState(""); const [loading, setLoading] = useState(false); const [errorMsg, setErrorMsg] = useState(null); const [mode, setMode] = useState("signin");
            useEffect(() => { const h = (e) => { if (e.key === 'Escape') onClose(); }; window.addEventListener('keydown', h); return () => window.removeEventListener('keydown', h); }, [onClose]);

            const handleAuth = async (e) => {
                e.preventDefault(); setLoading(true); setErrorMsg(null);
                try {
                    const sb = window.sb;
                    const redirectTo = window.location.origin;
                    if (mode === 'signin') { const { error } = await sb.auth.signInWithPassword({ email, password }); if (error) throw error; }
                    else { const { data, error } = await sb.auth.signUp({ email, password, options: { emailRedirectTo: redirectTo } }); if (error) throw error; if (data.user && !data.session) alert("Check email for confirmation."); }
                    const { data } = await sb.auth.getSession(); if (data.session) window.location.reload();
                } catch (err) { setErrorMsg(String(err?.message || err || "Auth Failed")); } finally { setLoading(false); }
            };
            const handleGoogle = async () => {
                setLoading(true); setErrorMsg(null);
                try {
                    const redirectTo = window.location.origin;
                    const { error } = await window.sb.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } }); if (error) throw error;
                }
                catch (err) { setErrorMsg(String(err?.message || "Google Auth Failed")); setLoading(false); }
            };
            return (
                <div onClick={onClose} className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in">
                    <div onClick={e => e.stopPropagation()} className="w-full max-w-md holo-card rounded-2xl p-8 border-t border-white/20 relative shadow-[0_0_50px_rgba(var(--brand-500),0.2)]">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors bg-white/5 hover:bg-white/10 p-2 rounded-full"><Icon name="x" size={20} /></button>
                        <div className="text-center mb-10">
                            <Logo className="w-16 h-16 mx-auto mb-6 shadow-[0_0_30px_rgba(var(--brand-500),0.4)] animate-pulse" />
                            <h2 className="text-3xl font-extrabold text-white tracking-tight uppercase">Velosify</h2>
                            <p className="text-brand-400 text-[10px] font-mono tracking-[0.3em] mt-3 uppercase opacity-80">Identity Verification</p>
                        </div>
                        {errorMsg && <div className="mb-6 bg-red-500/10 border border-red-500/20 rounded-xl p-4 text-red-300 text-xs font-mono">{errorMsg}</div>}
                        <form onSubmit={handleAuth} className="space-y-5">
                            <div className="group relative"><Icon name="mail" size={16} className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-brand-400" /><input type="email" required value={email} onChange={e => setEmail(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl py-3 pl-11 pr-4 text-sm text-white focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all placeholder:text-slate-600 font-mono" placeholder="NEURAL ID" /></div>
                            <div className="group relative"><Icon name="lock" size={16} className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-brand-400" /><input type="password" required value={password} onChange={e => setPassword(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl py-3 pl-11 pr-4 text-sm text-white focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all placeholder:text-slate-600 font-mono" placeholder="ACCESS CODE" /></div>
                            <button type="submit" disabled={loading} className="w-full bg-brand-600 hover:bg-brand-500 text-white font-bold py-2.5 rounded-xl transition-all shadow-lg shadow-brand-600/20 active:scale-[0.98] uppercase text-[10px] tracking-widest">{loading ? 'PROCESSING...' : (mode === 'signin' ? 'AUTHENTICATE' : 'INITIATE REGISTRATION')}</button>
                        </form>
                        <div className="my-8 flex items-center gap-4 opacity-50"><div className="h-px bg-white/20 flex-1"></div><span className="text-[10px] uppercase font-bold tracking-widest">OR</span><div className="h-px bg-white/20 flex-1"></div></div>
                        <button onClick={handleGoogle} className="w-full bg-white text-black font-bold py-2.5 rounded-xl flex items-center justify-center gap-3 hover:bg-slate-200 transition-colors shadow-lg active:scale-[0.98] uppercase text-[10px] tracking-widest"><svg className="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /><path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /><path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /><path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" /></svg> GOOGLE ACCESS</button>
                        <div className="mt-8 text-center"><button onClick={() => setMode(mode === 'signin' ? 'signup' : 'signin')} className="text-brand-400 text-[10px] font-mono border-b border-dashed border-brand-500/50 pb-0.5 hover:text-white transition-colors uppercase tracking-widest">{mode === 'signin' ? 'New User? Initialize Protocol' : 'Existing User? Authenticate'}</button></div>
                    </div>
                </div>
            );
        };

        /* --- LANDING PAGE COMPONENTS --- */

        const TiltContainer = ({ children }) => {
            const { useMotionValue, useSpring, useTransform, motion } = window.Motion;
            const x = useMotionValue(0);
            const y = useMotionValue(0);
            const mouseX = useSpring(x, { stiffness: 150, damping: 15 });
            const mouseY = useSpring(y, { stiffness: 150, damping: 15 });

            function handleMouseMove({ currentTarget, clientX, clientY }) {
                const { left, top, width, height } = currentTarget.getBoundingClientRect();
                x.set(clientX - left - width / 2);
                y.set(clientY - top - height / 2);
            }

            return (
                <motion.div
                    onMouseMove={handleMouseMove}
                    onMouseLeave={() => { x.set(0); y.set(0); }}
                    style={{
                        rotateX: useTransform(mouseY, [-100, 100], [5, -5]), // Subtle tilt
                        rotateY: useTransform(mouseX, [-100, 100], [-5, 5]),
                        transformStyle: "preserve-3d",
                    }}
                    whileHover={{ scale: 1.02 }}
                    className="relative perspective-1000"
                >
                    {children}
                    {/* Glare Effect */}
                    <motion.div
                        style={{
                            opacity: useTransform(mouseX, [-300, 300], [0, 0.4]),
                            background: "linear-gradient(105deg, transparent 40%, rgba(255,255,255,0.4) 45%, rgba(255,255,255,0.2) 50%, transparent 54%)",
                            filter: "blur(5px)"
                        }}
                        className="absolute inset-0 pointer-events-none z-50 rounded-3xl mix-blend-overlay"
                    />
                </motion.div>
            );
        };

        const HeroTerminal = ({ onLogin }) => {
            const [text, setText] = useState("");
            const [phase, setPhase] = useState("idle"); // idle, typing, ready, focusing, complete
            const [timeLeft, setTimeLeft] = useState(10.0);
            const [showCursor, setShowCursor] = useState(true);
            const fullCommand = "start focus --mode=deep-work";

            useEffect(() => {
                const c = setInterval(() => setShowCursor(p => !p), 500);
                return () => clearInterval(c);
            }, []);

            useEffect(() => {
                if (phase === 'idle') {
                    let i = 0;
                    // Initial delay
                    const startDelay = setTimeout(() => {
                        const typeInterval = setInterval(() => {
                            setText(fullCommand.substring(0, i + 1));
                            i++;
                            if (i === fullCommand.length) {
                                clearInterval(typeInterval);
                                setPhase('ready');
                            }
                        }, 50); // Typing speed
                    }, 1000);
                    return () => clearTimeout(startDelay);
                }
            }, []);

            useEffect(() => {
                let interval;
                if (phase === 'focusing') {
                    interval = setInterval(() => {
                        setTimeLeft(t => {
                            if (t <= 0) {
                                clearInterval(interval);
                                setPhase('complete');
                                return 0;
                            }
                            return (t - 0.1).toFixed(1);
                        });
                    }, 100);
                }
                return () => clearInterval(interval);
            }, [phase]);

            const run = () => setPhase('focusing');

            return (
                <div className="w-full max-w-lg mx-auto mt-8 font-mono text-left">
                    <div className={`
                        relative bg-[#1e1e1e]/90 backdrop-blur-xl border border-white/10 rounded-xl overflow-hidden shadow-2xl transition-all duration-500
                        ${phase === 'focusing' ? 'shadow-[0_0_50px_rgba(220,38,38,0.3)] border-red-500/30' : 'hover:shadow-[0_0_30px_rgba(var(--brand-500),0.2)] hover:border-brand-500/30'}
                    `}>
                        {/* Header */}
                        <div className={`h-8 bg-white/5 border-b border-white/5 flex items-center px-4 justify-between ${phase === 'focusing' ? 'bg-red-500/10' : ''}`}>
                            <div className="flex gap-1.5 basic-0">
                                <div className="w-3 h-3 rounded-full bg-red-500/80"></div>
                                <div className="w-3 h-3 rounded-full bg-yellow-500/80"></div>
                                <div className="w-3 h-3 rounded-full bg-emerald-500/80"></div>
                            </div>
                            <div className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">
                                {phase === 'focusing' ? 'LOCKDOWN ACTIVE' : 'user@velosify:~'}
                            </div>
                            <div className="w-10"></div>
                        </div>

                        {/* Body */}
                        <div className="p-6 h-40 flex flex-col justify-between relative overflow-hidden">
                            {phase === 'focusing' && (
                                <div className="absolute inset-0 bg-red-500/5 animate-pulse z-0"></div>
                            )}

                            <div className="z-10 relative">
                                <div className="flex items-center gap-2 text-sm text-slate-300">
                                    <span className="text-brand-400"></span>
                                    <span className="text-emerald-400">~</span>
                                    <span>{text}{phase === 'idle' || phase === 'ready' ? (showCursor && <span className="text-slate-500 w-2 inline-block bg-slate-500 h-4 align-middle ml-1"></span>) : ''}</span>
                                </div>
                                {phase === 'ready' && (
                                    <button
                                        onClick={run}
                                        className="mt-4 px-4 py-1.5 bg-brand-600 hover:bg-brand-500 text-white text-xs font-bold uppercase tracking-widest rounded animate-fade-in flex items-center gap-2"
                                    >
                                        <Icon name="play" size={12} /> Execute
                                    </button>
                                )}
                                {phase === 'focusing' && (
                                    <div className="mt-4 animate-fade-in">
                                        <div className="text-xs text-red-500 font-bold uppercase tracking-[0.2em] mb-1">Warning: Lockdown Mode</div>
                                        <div className="text-4xl font-black text-white tracking-tighter">{timeLeft}s</div>
                                    </div>
                                )}
                                {phase === 'complete' && (
                                    <div className="mt-4 animate-fade-in pb-2">
                                        <div className="text-emerald-400 font-bold text-sm mb-1"> SESSION COMPLETE</div>
                                        <div className="text-slate-400 text-xs mb-3">+50 XP Gained.</div>
                                        <button onClick={onLogin} className="text-xs underline text-white hover:text-brand-400">Join to track stats &rarr;</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const LiveActivityTicker = () => {
            const events = [
                " Arpit just finished a 4h Deep Work session.",
                " Rahul reached Level 10 in Python.",
                " 1,240 bugs fixed globally today.",
                " Sara unlocked 'Clean Coder' badge.",
                " System optimizing 24,000+ operations.",
                " New 'System Design' protocol available."
            ];

            return (
                <div className="fixed bottom-0 w-full z-40 bg-[#05050a]/90 backdrop-blur-md border-t border-white/10 h-8 flex items-center overflow-hidden pointer-events-none select-none">
                    <div className="whitespace-nowrap animate-[marquee_40s_linear_infinite] flex items-center gap-12">
                        {[...events, ...events, ...events].map((e, i) => (
                            <span key={i} className="text-[10px] font-mono font-bold text-slate-400 flex items-center gap-2">
                                <span className={`w-1.5 h-1.5 rounded-full ${i % 2 === 0 ? 'bg-brand-500' : 'bg-emerald-500'} animate-pulse`}></span>
                                {e}
                            </span>
                        ))}
                    </div>
                </div>
            );
        };

        const SonicFocusWidget = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [isMuted, setIsMuted] = useState(false);
            const audioRef = useRef(null);

            const togglePlay = () => {
                if (!audioRef.current) return;
                if (isPlaying) {
                    audioRef.current.pause();
                } else {
                    audioRef.current.play().catch(e => console.log("Audio play failed", e));
                }
                setIsPlaying(!isPlaying);
            };

            const toggleMute = (e) => {
                e.stopPropagation();
                if (!audioRef.current) return;
                audioRef.current.muted = !isMuted;
                setIsMuted(!isMuted);
            };

            return (
                <div className="fixed bottom-12 right-6 z-50 animate-slide-up">
                    <audio
                        ref={audioRef}
                        src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112762.mp3"
                        loop
                        crossOrigin="anonymous"
                    />
                    <div className="relative group">
                        <div className={`absolute inset-0 bg-brand-500 blur-xl transition-opacity duration-1000 ${isPlaying ? 'opacity-40 animate-pulse' : 'opacity-0'}`}></div>
                        <div
                            onClick={togglePlay}
                            className="relative bg-black/90 border border-brand-500/30 backdrop-blur-xl rounded-full p-1 pr-6 flex items-center gap-4 cursor-pointer hover:border-brand-500/80 transition-all shadow-2xl h-14 w-62 overflow-hidden"
                        >
                            {/* Tape visual */}
                            <div className={`w-12 h-12 rounded-full bg-surface-800 border-2 border-brand-500/20 flex items-center justify-center relative ${isPlaying ? 'animate-spin-slow' : ''}`}>
                                <div className="w-4 h-4 rounded-full bg-brand-500/50 blur-[2px]"></div>
                                <div className="absolute inset-0 border-t-2 border-brand-500/60 rounded-full opacity-50"></div>
                            </div>

                            {/* Controls & Visualizer */}
                            <div className="flex flex-col">
                                <div className="text-[10px] font-mono text-brand-400 font-bold uppercase tracking-widest flex items-center gap-2">
                                    {isPlaying ? 'Sonic Focus' : 'Start Focus'}
                                    {isPlaying && (
                                        <div className="flex gap-0.5 items-end h-3">
                                            {[1, 2, 3, 4].map(i => (
                                                <div key={i} className="w-0.5 bg-brand-500 animate-[bounce_0.5s_infinite]" style={{ height: `${Math.random() * 100}%`, animationDelay: `${i * 0.1}s` }}></div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div className="text-[8px] text-slate-500 uppercase tracking-wider">Lofi // 90.4 MHz</div>
                            </div>

                            {/* Mute Button */}
                            <button
                                onClick={toggleMute}
                                className="absolute right-3 top-1/2 -translate-y-1/2 p-1.5 hover:bg-white/10 rounded-full text-slate-400 hover:text-white transition-colors z-20"
                            >
                                <Icon name={isMuted ? "volume-x" : "volume-2"} size={14} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const ComparisonDiff = () => {
            return (
                <section className="py-24 px-6 relative z-10 bg-[#0b0c15]">
                    <div className="max-w-6xl mx-auto">
                        <div className="text-center mb-16">
                            <h2 className="text-3xl md:text-4xl font-black mb-4 tracking-tighter">GIT <span className="text-brand-400">DIFF</span> YOUR LIFE</h2>
                            <p className="text-slate-400 font-mono text-sm">Commit the new version of you.</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-0 border border-white/10 rounded-xl overflow-hidden font-mono text-sm shadow-2xl">
                            {/* LEFT PANE: OLD WAY */}
                            <div className="bg-[#1e1e1e] p-0 relative">
                                <div className="bg-[#2d2d2d] border-b border-black/50 px-4 py-2 text-xs text-slate-500 flex justify-between">
                                    <span>a/user-v1.0.js</span>
                                    <span className="text-red-400">- 4 lines</span>
                                </div>
                                <div className="p-4 space-y-1">
                                    <div className="flex bg-red-900/10 -mx-4 px-4 border-l-2 border-red-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">1</div>
                                        <div className="text-slate-400"><span className="text-red-500 mr-2">-</span><span className="line-through decoration-red-500/50">Distracted by YouTube recommendations</span></div>
                                    </div>
                                    <div className="flex bg-red-900/10 -mx-4 px-4 border-l-2 border-red-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">2</div>
                                        <div className="text-slate-400"><span className="text-red-500 mr-2">-</span><span className="line-through decoration-red-500/50">Manual Timer setting (forgotten often)</span></div>
                                    </div>
                                    <div className="flex bg-red-900/10 -mx-4 px-4 border-l-2 border-red-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">3</div>
                                        <div className="text-slate-400"><span className="text-red-500 mr-2">-</span><span className="line-through decoration-red-500/50">Zero accountability or tracking</span></div>
                                    </div>
                                    <div className="flex bg-red-900/10 -mx-4 px-4 border-l-2 border-red-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">4</div>
                                        <div className="text-slate-400"><span className="text-red-500 mr-2">-</span><span className="line-through decoration-red-500/50">Random LeetCode solving</span></div>
                                    </div>
                                </div>
                            </div>

                            {/* RIGHT PANE: VELOSIFY WAY */}
                            <div className="bg-[#1e1e1e] p-0 relative border-l border-white/5">
                                <div className="bg-[#2d2d2d] border-b border-black/50 px-4 py-2 text-xs text-slate-500 flex justify-between">
                                    <span>b/user-v2.0.js</span>
                                    <span className="text-emerald-400">+ 4 lines</span>
                                </div>
                                <div className="p-4 space-y-1">
                                    <div className="flex bg-emerald-900/10 -mx-4 px-4 border-l-2 border-emerald-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">1</div>
                                        <div className="text-emerald-100"><span className="text-emerald-500 mr-2">+</span>Deep Work Protocols (90min blocks)</div>
                                    </div>
                                    <div className="flex bg-emerald-900/10 -mx-4 px-4 border-l-2 border-emerald-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">2</div>
                                        <div className="text-emerald-100"><span className="text-emerald-500 mr-2">+</span>Auto-Lockdown & Task forcing</div>
                                    </div>
                                    <div className="flex bg-emerald-900/10 -mx-4 px-4 border-l-2 border-emerald-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">3</div>
                                        <div className="text-emerald-100"><span className="text-emerald-500 mr-2">+</span>Gamified XP System & Leaderboards</div>
                                    </div>
                                    <div className="flex bg-emerald-900/10 -mx-4 px-4 border-l-2 border-emerald-500/50">
                                        <div className="text-slate-600 select-none w-6 text-right mr-4">4</div>
                                        <div className="text-emerald-100"><span className="text-emerald-500 mr-2">+</span>Structured DSA Sheets & Tracking</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        const FocusToggle = ({ isFocusMode, toggle }) => {
            return (
                <button
                    onClick={toggle}
                    className={`
                        relative px-3 py-1.5 rounded-full flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest transition-all
                        ${isFocusMode ? 'bg-brand-500 text-white shadow-[0_0_20px_rgba(var(--brand-500),0.6)]' : 'bg-white/10 text-slate-400 hover:bg-white/20'}
                    `}
                >
                    <div className={`w-2 h-2 rounded-full ${isFocusMode ? 'bg-white animate-pulse' : 'bg-slate-500'}`}></div>
                    {isFocusMode ? 'Focus Active' : 'Try Focus'}
                </button>
            );
        };

        const SystemArchitecture = () => {
            const { motion } = window.Motion;

            // Brand SVGs
            const icons = {
                react: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-sky-400"><circle cx="12" cy="12" r="2" /><g stroke="currentColor" strokeWidth="1.5" fill="none"><ellipse cx="12" cy="12" rx="10" ry="4" /><ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(60 12 12)" /><ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(120 12 12)" /></g></svg>,
                tailwind: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-sky-400"><path d="M12.001 4.8c-3.2 0-5.2 1.6-6 4.8 1.2-1.6 2.6-2.2 4.2-1.8.913.228 1.565.89 2.288 1.624C13.666 10.618 15.027 12 18.001 12c3.2 0 5.2-1.6 6-4.8-1.2 1.6-2.6 2.2-4.2 1.8-.913-.228-1.565-.89-2.288-1.624C16.337 6.182 14.976 4.8 12.001 4.8zm-6 7.2c-3.2 0-5.2 1.6-6 4.8 1.2-1.6 2.6-2.2 4.2-1.8.913.228 1.565.89 2.288 1.624C7.666 17.818 9.027 19.2 12.001 19.2c3.2 0 5.2-1.6 6-4.8-1.2 1.6-2.6 2.2-4.2 1.8-.913-.228-1.565-.89-2.288-1.624C10.337 13.382 8.976 12 6.001 12z" /></svg>,
                framer: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-white"><path d="M4 0h16v8h-8zM4 12h8v8zM4 8h8l8 8H4z" /></svg>,
                supabase: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-emerald-400"><path d="M11.666 10.833H2.667L13.333 0v8.333h9L11.666 19.167z" /></svg>,
                python: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-yellow-400"><path d="M14.25.75a6.25 6.25 0 00-6.25 6.25v2.5h2.5a1.25 1.25 0 110 2.5H2.385A2.385 2.385 0 010 9.615V6.75A6.75 6.75 0 016.75 0h5a2.5 2.5 0 012.5 2.5v1.875a1.875 1.875 0 01-3.75 0V2.5a1.25 1.25 0 011.25-1.25h2.5zM9.75 23.25a6.25 6.25 0 006.25-6.25v-2.5h-2.5a1.25 1.25 0 110-2.5H21.615A2.385 2.385 0 0124 14.385v2.865A6.75 6.75 0 0117.25 24h-5a2.5 2.5 0 01-2.5-2.5v-1.875a1.875 1.875 0 013.75 0v1.875a1.25 1.25 0 01-1.25 1.25h-2.5z" /></svg>,
                openai: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-white"><path d="M22.282 9.821a5.98 5.98 0 00-.516-4.91 6.046 6.046 0 00-6.51-2.9A6.065 6.065 0 004.981 4.18a5.985 5.985 0 00-3.998 2.9 6.046 6.046 0 00.743 7.097 5.98 5.98 0 00.51 4.911 6.05 6.05 0 006.515 2.9A6.05 6.05 0 0019.02 19.82a6 6 0 003.997-2.9 6.06 6.06 0 00-.735-7.1zM12 21a9 9 0 110-18 9 9 0 010 18z" /></svg>,
                vercel: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-white"><path d="M12 1L24 22H0L12 1z" /></svg>,
                git: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-orange-500"><path d="M2.6,10.6L10.6,2.6C10.9,2.3 11.5,2.3 11.9,2.6L21.4,12.1C21.7,12.5 21.7,13.1 21.4,13.5L13.5,21.4C13.1,21.7 12.5,21.7 12.1,21.4L2.6,11.9C2.3,11.5 2.3,10.9 2.6,10.6ZM13.4,7L7,13.4" stroke="currentColor" strokeWidth="2" fill="none" /></svg>,
                leetcode: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-orange-400"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" /></svg>,
                postgres: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-blue-400"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14h-4v-2h4v2zm0-4h-4V6h4v6z" /></svg>,
                edge: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-yellow-400"><path d="M7 2v11h3v9l7-12h-4l4-8z" /></svg>,
                docker: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-sky-500"><path d="M13.983 11.078h2.119c.695 0 1.259.564 1.259 1.259 0 .695-.564 1.259-1.259 1.259h-2.119a1.259 1.259 0 0 1-1.259-1.259c0-.695.564-1.259 1.259-1.259z" /></svg>,
                redis: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-red-500"><path d="M12 0L2 6v12l10 6 10-6V6L12 0zm0 2.2l8 4.8v9l-8 4.8-8-4.8v-9l8-4.8z" /></svg>,
                shield: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-emerald-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>,
                zap: <svg viewBox="0 0 24 24" className="w-6 h-6 fill-yellow-400"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" /></svg>
            };

            const modules = [
                {
                    id: 1, span: "", category: "Frontend Core", desc: "High-performance reactive UI", color: "border-sky-500/50",
                    techs: [{ n: "React 18", i: icons.react }, { n: "Tailwind", i: icons.tailwind }, { n: "Framer Motion", i: icons.framer }]
                },
                {
                    id: 2, span: "", category: "Neural Brain", desc: "AI Judgment Engine", color: "border-purple-500/50",
                    techs: [{ n: "Python", i: icons.python }, { n: "OpenAI", i: icons.openai }, { n: "LeetCode Graph", i: icons.leetcode }]
                },
                {
                    id: 3, span: "", category: "Data Backbone", desc: "Scalable Real-time DB", color: "border-emerald-500/50",
                    techs: [{ n: "Supabase", i: icons.supabase }, { n: "PostgreSQL", i: icons.postgres }, { n: "Edge Func", i: icons.edge }]
                },
                {
                    id: 4, span: "", category: "Global Infra", desc: "Edge Network Deployment", color: "border-orange-500/50",
                    techs: [{ n: "Vercel", i: icons.vercel }, { n: "Git Flow", i: icons.git }, { n: "Docker", i: icons.docker }]
                },
                {
                    id: 5, span: "", category: "Security Logic", desc: "Neural Privacy Protocol", color: "border-emerald-500/50",
                    techs: [{ n: "Shield Auth", i: icons.shield }, { n: "JWT Sync", i: icons.openai }, { n: "Data Sanitizer", i: icons.edge }]
                },
                {
                    id: 6, span: "", category: "Efficiency Core", desc: "High-Velocity Caching", color: "border-red-500/50",
                    techs: [{ n: "Redis 7.0", i: icons.redis }, { n: "Fast API", i: icons.zap }, { n: "Compression", i: icons.framer }]
                }
            ];

            return (
                <section className="py-24 px-6 relative z-10 bg-[#08080c]">
                    <div className="max-w-5xl mx-auto">
                        <div className="text-center mb-16">
                            <h2 className="text-3xl md:text-4xl font-black mb-4 tracking-tighter uppercase">System <span className="text-brand-400">Architecture</span></h2>
                            <p className="text-slate-400 font-mono text-sm max-w-xl mx-auto">
                                Built on a modern, type-safe stack designed for speed, scalability, and neural-like responsiveness.
                            </p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {modules.map((m) => (
                                <motion.div
                                    key={m.id}
                                    whileHover={{ y: -5, boxShadow: "0 10px 30px -10px rgba(0,0,0,0.5)" }}
                                    className={`${m.span} bg-black/50 backdrop-blur-xl border border-white/10 rounded-2xl p-6 relative group overflow-hidden hover:${m.color} transition-all duration-300`}
                                >
                                    {/* Circuit Background Pattern */}
                                    <div className="absolute inset-0 opacity-10 pointer-events-none group-hover:opacity-20 transition-opacity">
                                        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                                            <pattern id={`grid-${m.id}`} width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="currentColor" strokeWidth="0.5" /></pattern>
                                            <rect width="100%" height="100%" fill={`url(#grid-${m.id})`} />
                                        </svg>
                                    </div>

                                    <h3 className="text-lg font-bold text-white mb-1 relative z-10">{m.category}</h3>
                                    <p className="text-xs text-slate-400 mb-6 font-mono -mt-1 relative z-10">{m.desc}</p>

                                    <div className="flex flex-wrap gap-4 relative z-10">
                                        {m.techs.map((t, i) => (
                                            <div key={i} className="flex flex-col items-center gap-2 group/icon">
                                                <motion.div
                                                    animate={{ y: [0, -4, 0] }}
                                                    transition={{ repeat: Infinity, duration: 4, ease: "easeInOut", delay: i * 0.5 }}
                                                    className="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-hover/icon:bg-white/10 group-hover/icon:border-brand-500/30 transition-all text-white p-2"
                                                >
                                                    {t.i}
                                                </motion.div>
                                                <span className="text-[10px] uppercase font-bold text-slate-500 group-hover/icon:text-slate-300 transition-colors">{t.n}</span>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Connecting Lines Pulse */}
                                    <div className="absolute top-1/2 right-0 w-8 h-[1px] bg-white/20 group-hover:bg-brand-500/50 transition-colors"></div>
                                    <div className="absolute bottom-0 left-1/2 w-[1px] h-8 bg-white/20 group-hover:bg-brand-500/50 transition-colors"></div>
                                </motion.div>
                            ))}
                        </div>
                    </div>
                </section>
            );
        };

        const CodeReviews = () => {
            const testimonials = [
                { user: "Sarah_Dev", role: "Full Stack Engineer", impact: "Shipped MVP in 2 weeks", rating: 5 },
                { user: "Alex_Algo", role: "Competitive Coder", impact: "Solved 500+ LeetCode", rating: 5 },
                { user: "Rohan_AI", role: "ML Researcher", impact: "Focus increased by 300%", rating: 5 },
            ];

            return (
                <section className="py-24 px-6 relative z-10 bg-[#08080c]">
                    <div className="max-w-5xl mx-auto">
                        <div className="text-center mb-16">
                            <h2 className="text-3xl md:text-4xl font-black mb-4 tracking-tighter">SUCCESS <span className="text-emerald-400">LOGS</span></h2>
                            <p className="text-slate-400 font-mono text-sm">Validating user protocols...</p>
                        </div>

                        <div className="bg-[#1e1e1e] rounded-xl overflow-hidden shadow-2xl border border-white/5 font-mono text-sm max-w-3xl mx-auto transform hover:scale-[1.01] transition-transform duration-500">
                            {/* Window Header */}
                            <div className="bg-[#2d2d2d] px-4 py-2 flex items-center justify-between border-b border-black/50">
                                <div className="flex gap-2">
                                    <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                    <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                    <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                </div>
                                <div className="text-slate-400 text-xs">testimonials.json</div>
                                <div className="w-10"></div>
                            </div>

                            {/* Code Area */}
                            <div className="p-6 text-slate-300 overflow-x-auto">
                                <div className="flex">
                                    <div className="text-slate-600 select-none text-right pr-4 border-r border-white/10 mr-4">
                                        {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map(n => <div key={n}>{n}</div>)}
                                    </div>
                                    <div className="w-full">
                                        <div><span className="text-pink-400">const</span> <span className="text-blue-400">successStories</span> <span className="text-white">=</span> [</div>
                                        {testimonials.map((t, i) => (
                                            <div key={i} className="pl-4 py-0.5 group hover:bg-white/5 rounded">
                                                <span className="text-yellow-400">{`{`}</span>
                                                <div className="pl-4">
                                                    <span className="text-sky-300">user</span>: <span className="text-green-400">"{t.user}"</span>,
                                                </div>
                                                <div className="pl-4">
                                                    <span className="text-sky-300">role</span>: <span className="text-green-400">"{t.role}"</span>,
                                                </div>
                                                <div className="pl-4">
                                                    <span className="text-sky-300">impact</span>: <span className="text-green-400">"{t.impact}"</span>,
                                                </div>
                                                <div className="pl-4">
                                                    <span className="text-sky-300">rating</span>: <span className="text-purple-400">{t.rating}</span> <span className="text-slate-500">// </span>
                                                </div>
                                                <span className="text-yellow-400">{`},`}</span>
                                            </div>
                                        ))}
                                        <div>];</div>
                                        <div className="mt-2 text-slate-500">// System status: OPTIMAL</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        const FocusCalculator = () => {
            const [rate, setRate] = useState(50);
            const [hours, setHours] = useState(2);

            const loss = rate * hours * 250;
            // 250 working days approx

            return (
                <section className="py-24 px-6 relative z-10 border-t border-white/5 bg-gradient-to-b from-[#05050a] to-[#0a0a12]">
                    <div className="max-w-4xl mx-auto text-center">
                        <h2 className="text-3xl md:text-4xl font-black mb-12 tracking-tighter uppercase">Calculate <span className="text-red-500">Distraction Cost</span></h2>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                            {/* Inputs */}
                            <div className="space-y-8 text-left bg-white/5 p-8 rounded-2xl border border-white/10 backdrop-blur-sm">
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Hourly Value ($)</label>
                                    <div className="flex items-center gap-4">
                                        <input
                                            type="range" min="10" max="500" step="10"
                                            value={rate} onChange={e => setRate(Number(e.target.value))}
                                            className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-brand-500"
                                        />
                                        <span className="text-xl font-mono font-bold w-16 text-right">${rate}</span>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Distracted Hours / Day</label>
                                    <div className="flex items-center gap-4">
                                        <input
                                            type="range" min="0.5" max="8" step="0.5"
                                            value={hours} onChange={e => setHours(Number(e.target.value))}
                                            className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500"
                                        />
                                        <span className="text-xl font-mono font-bold w-16 text-right text-red-400">{hours}h</span>
                                    </div>
                                </div>
                            </div>

                            {/* Output */}
                            <div className="relative group">
                                <div className="absolute inset-0 bg-red-500/10 blur-3xl rounded-full opacity-50 group-hover:opacity-80 transition-opacity"></div>
                                <div className="relative z-10 flex flex-col items-center">
                                    <div className="text-sm font-mono text-slate-500 mb-2 uppercase tracking-tight">Annual Revenue Lost</div>
                                    <div className="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-b from-red-400 to-red-600 mb-2 font-mono">
                                        -${loss.toLocaleString()}
                                    </div>
                                    <p className="text-xs text-slate-400 max-w-xs mx-auto">
                                        Or reclaim <span className="text-emerald-400 font-bold">+${loss.toLocaleString()}</span> with Velosify protocols.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        const BiosLoader = ({ onComplete }) => {
            const [lines, setLines] = useState([]);
            const bootText = [
                "INITIALIZING VELOSIFY KERNEL...",
                "LOADING NEURAL INTERFACES...",
                "MOUNTING DOPAMINE BLOCKERS... [OK]",
                "OPTIMIZING FOCUS ALGORITHMS...",
                "ESTABLISHING SECURE CONNECTION...",
                "SYSTEM READY."
            ];

            useEffect(() => {
                let delay = 0;
                bootText.forEach((text, i) => {
                    delay += Math.random() * 500 + 200;
                    setTimeout(() => {
                        setLines(prev => [...prev, text]);
                        if (i === bootText.length - 1) {
                            setTimeout(onComplete, 800);
                        }
                    }, delay);
                });
            }, []);

            return (
                <div className="fixed inset-0 z-[100] bg-black text-brand-400 font-mono text-xs p-10 flex flex-col justify-end pointer-events-none">
                    {lines.map((line, i) => (
                        <div key={i}>{`> ${line}`}</div>
                    ))}
                    <div className="animate-pulse mt-2">_</div>
                </div>
            );
        };

        const CommandMenu = ({ isOpen, onClose }) => {
            const [query, setQuery] = useState("");
            const menuRef = useRef(null);

            useEffect(() => {
                if (isOpen) {
                    menuRef.current?.focus();
                }
            }, [isOpen]);

            const commands = [
                { id: 'pricing', label: 'Go to Pricing', icon: 'credit-card', action: () => document.getElementById('pricing')?.scrollIntoView({ behavior: 'smooth' }) },
                { id: 'roadmap', label: 'Go to Roadmap', icon: 'map', action: () => console.log('Roadmap') },
                { id: 'login', label: 'Login', icon: 'log-in', action: () => document.querySelector("button[class*='Access Terminal']").click() },
                { id: 'theme', label: 'Toggle Theme', icon: 'sun', action: () => document.documentElement.classList.toggle('light') },
                { id: 'focus', label: 'Run Focus Test', icon: 'zap', action: () => document.querySelector('.perspective-1000')?.scrollIntoView({ behavior: 'smooth' }) },
            ];

            const filtered = commands.filter(c => c.label.toLowerCase().includes(query.toLowerCase()));

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[60] bg-black/60 backdrop-blur-md flex items-start justify-center pt-[20vh]" onClick={onClose}>
                    <div
                        className="w-full max-w-lg bg-surface-900 border border-slate-700 rounded-xl shadow-2xl overflow-hidden flex flex-col"
                        onClick={e => e.stopPropagation()}
                    >
                        <div className="flex items-center gap-3 px-4 py-3 border-b border-white/10">
                            <Icon name="search" size={16} className="text-slate-500" />
                            <input
                                ref={menuRef}
                                className="flex-1 bg-transparent border-none outline-none text-white text-sm font-mono placeholder:text-slate-600"
                                placeholder="Type a command..."
                                autoFocus
                                value={query}
                                onChange={e => setQuery(e.target.value)}
                            />
                            <span className="text-[10px] bg-white/10 text-slate-400 px-1.5 py-0.5 rounded border border-white/5">ESC</span>
                        </div>
                        <div className="py-2 max-h-[300px] overflow-y-auto">
                            {filtered.length === 0 && <div className="px-4 py-2 text-slate-500 text-xs">No commands found.</div>}
                            {filtered.map((cmd, i) => (
                                <button
                                    key={cmd.id}
                                    onClick={() => { cmd.action(); onClose(); }}
                                    className="w-full text-left px-4 py-2 hover:bg-brand-500 hover:text-white text-slate-300 text-sm flex items-center gap-3 transition-colors group"
                                >
                                    <Icon name={cmd.icon} size={14} className="text-slate-500 group-hover:text-white" />
                                    {cmd.label}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const DopamineQuarantine = () => {
            const apps = [
                { name: "INSTA-DOOM", slug: "instagram", color: "from-pink-500 to-purple-500", saved: "45m" },
                { name: "TIK-TRAP", slug: "tiktok", color: "from-cyan-400 to-blue-500", saved: "60m" },
                { name: "YT-BLACKHOLES", slug: "youtube", color: "from-red-500 to-red-700", saved: "90m" },
                { name: "X-SCROLL", slug: "x", color: "from-slate-400 to-slate-600", saved: "30m" },
            ];

            return (
                <>
                    <section className="py-24 px-6 relative overflow-hidden bg-[#05050a]">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(220,38,38,0.05),transparent)] pointer-events-none"></div>

                        <div className="max-w-5xl mx-auto text-center relative z-10">
                            <div className="inline-flex items-center gap-2 mb-6 px-4 py-1.5 rounded-full border border-red-500/20 bg-red-500/5 text-red-500 text-[10px] font-mono uppercase tracking-[0.3em]">
                                <Logo className="w-3.5 h-3.5" />
                                <span className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse ml-1"></span>
                                Containment Level: Maximum
                            </div>
                            <div className="relative inline-block mb-16">
                                <Logo className="absolute -top-16 left-1/2 -translate-x-1/2 w-32 h-32 opacity-20 text-red-600 blur-[12px] animate-pulse" />
                                <h2 className="text-3xl md:text-5xl font-black text-white tracking-tighter uppercase relative z-10">Dopamine <span className="text-red-600 drop-shadow-[0_0_15px_rgba(220,38,38,0.5)]">Quarantine</span></h2>
                            </div>

                            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                                {apps.map((app, i) => (
                                    <div key={i} className="group relative">
                                        {/* Digital Containment Cell */}
                                        <div className="relative aspect-square rounded-3xl bg-white/[0.02] border border-white/5 p-6 flex flex-col items-center justify-center gap-4 transition-all duration-500 group-hover:bg-red-500/[0.03] group-hover:border-red-500/30 overflow-hidden">
                                            {/* Scanner Grid Overlay */}
                                            <div className="absolute inset-0 opacity-0 group-hover:opacity-20 transition-opacity duration-500 bg-[linear-gradient(rgba(220,38,38,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(220,38,38,0.1)_1px,transparent_1px)] bg-[size:10px_10px]"></div>

                                            <Logo className="absolute inset-0 w-full h-full p-8 opacity-[0.02] group-hover:opacity-[0.05] transition-opacity" />

                                            <div className="p-4 rounded-2xl bg-white/5 group-hover:bg-red-500/10 transition-all duration-500 relative z-10">
                                                <img
                                                    src={`https://cdn.simpleicons.org/${app.slug}/white`}
                                                    alt={app.name}
                                                    className="w-10 h-10 opacity-50 group-hover:opacity-100 transition-opacity"
                                                    onError={(e) => {
                                                        e.target.onerror = null;
                                                        e.target.src = "https://cdn.simpleicons.org/speedtest/white";
                                                    }}
                                                />
                                            </div>

                                            <div className="text-center">
                                                <div className="text-[10px] font-mono text-slate-600 mb-1 tracking-widest uppercase group-hover:text-red-400 transition-colors">{app.name}</div>
                                                <div className="text-xs font-black text-slate-400 group-hover:text-white transition-colors">PURGED: {app.saved}</div>
                                            </div>

                                            {/* Glitch Overlay Effect */}
                                            <div className="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none overflow-hidden">
                                                <div className="w-full h-full animate-glitch-active bg-red-500/5"></div>
                                            </div>
                                        </div>

                                        {/* Status Indicator */}
                                        <div className="absolute -top-2 -right-2 px-2 py-0.5 rounded-md bg-red-900/80 border border-red-500/50 text-[8px] font-mono text-red-200 opacity-0 group-hover:opacity-100 transition-opacity uppercase tracking-tighter">
                                            Offline
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>
                    <style>{`
                    @keyframes glitch-active {
                        0% { transform: translate(0); }
                        20% { transform: translate(-2px, 2px); }
                        40% { transform: translate(-2px, -2px); }
                        60% { transform: translate(2px, 2px); }
                        80% { transform: translate(2px, -2px); }
                        100% { transform: translate(0); }
                    }
                    .animate-glitch-active {
                        animation: glitch-active 0.2s infinite;
                    }
                `}</style>
                </>
            );
        };

        const ScienceSection = () => {
            const phases = [
                {
                    id: "01",
                    title: "The Purge",
                    desc: "Blocks cheap dopamine triggers (Insta/Shorts) to reset baseline focus.",
                    color: "red",
                    icon: "shield-alert",
                    tag: "DOPAMINE DETOX"
                },
                {
                    id: "02",
                    title: "The Tunnel",
                    desc: "Induces Alpha Brain Waves via 40Hz Binaural Beats.",
                    color: "brand",
                    icon: "zap",
                    tag: "FLOW STATE"
                },
                {
                    id: "03",
                    title: "The Reward",
                    desc: "High-stakes XP system replaces scrolling addiction with work addiction.",
                    color: "emerald",
                    icon: "trophy",
                    tag: "NEURAL REWARD"
                }
            ];

            return (
                <section className="py-32 px-6 relative overflow-hidden" id="science">
                    {/* Background decorative elements */}
                    <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full opacity-10 pointer-events-none">
                        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-brand-500 rounded-full blur-[120px]"></div>
                        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-red-500 rounded-full blur-[120px]"></div>
                    </div>

                    <div className="max-w-6xl mx-auto relative z-10">
                        <div className="text-center mb-24 animate-fade-in relative">
                            <Logo className="absolute -top-16 left-1/2 -translate-x-1/2 w-32 h-32 opacity-10 text-brand-500 blur-[15px] animate-pulse" />
                            <h2 className="text-sm font-mono text-brand-400 uppercase tracking-[0.5em] mb-4 relative z-10">Neural Rewiring Protocol</h2>
                            <h1 className="text-4xl md:text-6xl font-black tracking-tighter text-white relative z-10">SYSTEMATIC <span className="text-transparent bg-clip-text bg-gradient-to-r from-brand-400 to-emerald-400">EVOLUTION</span></h1>
                        </div>

                        <div className="relative">
                            {/* Connecting Line (Desktop) */}
                            <div className="hidden md:block absolute top-1/2 left-0 w-full h-px bg-gradient-to-r from-red-500/20 via-brand-500/50 to-emerald-500/20 -translate-y-1/2 z-0"></div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-12 relative z-10">
                                {phases.map((p, i) => (
                                    <div key={i} className="group relative">
                                        {/* Background large number */}
                                        <div className="absolute -top-12 -left-4 text-9xl font-black text-white/[0.03] select-none group-hover:text-white/[0.06] transition-colors duration-500">
                                            {p.id}
                                        </div>

                                        <div className="relative bg-[#0a0a12]/80 backdrop-blur-2xl rounded-3xl p-8 border border-white/5 hover:border-white/20 transition-all duration-500 shadow-2xl overflow-hidden group">
                                            {/* Glow effect on hover */}
                                            <div className={`absolute -inset-1 bg-gradient-to-br transition-opacity duration-500 opacity-0 group-hover:opacity-10 pointer-events-none ${p.color === 'red' ? 'from-red-500 to-transparent' :
                                                p.color === 'brand' ? 'from-brand-500 to-transparent' : 'from-emerald-500 to-transparent'
                                                }`}></div>

                                            {/* Scanner line animation */}
                                            <div className="absolute left-0 top-0 w-full h-[2px] bg-white/20 -translate-y-full group-hover:animate-[scan_2s_linear_infinite]"></div>

                                            <div className="absolute inset-0 z-0 pointer-events-none overflow-hidden">
                                                <Logo className={`absolute -bottom-4 -right-4 w-32 h-32 opacity-[0.03] group-hover:opacity-[0.08] transition-opacity duration-700 ${p.color === 'red' ? 'text-red-500' :
                                                    p.color === 'brand' ? 'text-brand-500' : 'text-emerald-500'
                                                    }`} />
                                            </div>

                                            <div className="relative z-10">
                                                <div className={`mb-8 p-4 rounded-2xl bg-white/5 w-fit shadow-inner ring-1 ring-white/10 ${p.color === 'red' ? 'text-red-500' :
                                                    p.color === 'brand' ? 'text-brand-500' : 'text-emerald-500'
                                                    }`}>
                                                    <Logo className="w-10 h-10" />
                                                </div>

                                                <div className="flex items-center gap-3 mb-4">
                                                    <div className={`w-1.5 h-1.5 rounded-full animate-pulse ${p.color === 'red' ? 'bg-red-500' :
                                                        p.color === 'brand' ? 'bg-brand-500' : 'bg-emerald-500'
                                                        }`}></div>
                                                    <span className="text-[10px] font-mono text-slate-500 uppercase tracking-widest font-bold">{p.tag}</span>
                                                </div>

                                                <h3 className="text-3xl font-black text-white mb-4 tracking-tight uppercase">{p.title}</h3>
                                                <p className="text-slate-400 leading-relaxed text-sm font-medium">
                                                    {p.desc}
                                                </p>
                                            </div>

                                            {/* Corner Accents */}
                                            <div className={`absolute bottom-0 right-0 w-16 h-16 opacity-20 transition-opacity group-hover:opacity-100 ${p.color === 'red' ? 'text-red-500' :
                                                p.color === 'brand' ? 'text-brand-500' : 'text-emerald-500'
                                                }`}>
                                                <svg viewBox="0 0 100 100" className="w-full h-full fill-none stroke-current" strokeWidth="2">
                                                    <path d="M 80 100 L 100 100 L 100 80" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <style>{`
                        @keyframes scan {
                            0% { transform: translateY(-100%); opacity: 0; }
                            50% { opacity: 1; }
                            100% { transform: translateY(500%); opacity: 0; }
                        }
                    `}</style>
                </section>
            );
        };



        const Integrations = () => {
            const tools = [
                { name: "GITHUB", slug: "github", color: "text-white" },
                { name: "VSCODE", slug: "visualstudiocode", color: "text-sky-400" },
                { name: "LEETCODE", slug: "leetcode", color: "text-orange-500" },
                { name: "SPOTIFY", slug: "spotify", color: "text-emerald-500" },
                { name: "CHROME", slug: "googlechrome", color: "text-blue-500" },
                { name: "SLACK", slug: "slack", color: "text-amber-400" },
                { name: "LINEAR", slug: "linear", color: "text-purple-400" },
                { name: "NOTION", slug: "notion", color: "text-slate-200" }
            ];

            return (
                <section className="py-32 px-6 relative overflow-hidden bg-[#0a0a12]">
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(var(--brand-500),0.05),transparent)] pointer-events-none"></div>

                    <div className="max-w-6xl mx-auto text-center relative z-10">
                        <h2 className="text-sm font-mono text-brand-400 uppercase tracking-[0.6em] mb-4">Neural Data Bus</h2>
                        <div className="relative inline-block mb-24">
                            <Logo className="absolute -top-20 left-1/2 -translate-x-1/2 w-40 h-40 opacity-30 text-brand-500 blur-[15px] animate-pulse" />
                            <h1 className="text-4xl md:text-6xl font-black text-white tracking-tighter uppercase leading-tight relative z-10">
                                The Central <span className="text-transparent bg-clip-text bg-gradient-to-r from-brand-400 to-brand-600">Nervous System</span> <br />
                                <span className="text-2xl text-slate-500 font-mono tracking-[0.3em] flex items-center justify-center gap-4 mt-4">
                                    <div className="h-px w-12 bg-brand-500/30"></div>
                                    Neural Connectivity Matrix
                                    <div className="h-px w-12 bg-brand-500/30"></div>
                                </span>
                            </h1>
                        </div>

                        <div className="relative inline-block px-10 py-20">
                            {/* Central Core Hub */}
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 z-20">
                                <div className="absolute inset-0 bg-brand-500 rounded-full blur-[40px] opacity-20 animate-pulse"></div>
                                <div className="relative w-full h-full rounded-full bg-black border-2 border-brand-500/50 flex items-center justify-center shadow-[0_0_30px_rgba(var(--brand-500),0.3)]">
                                    <Logo className="w-16 h-16 text-white" />
                                </div>
                                <div className="absolute -inset-4 border border-brand-500/10 rounded-full animate-[spin_10s_linear_infinite]"></div>
                                <div className="absolute -inset-8 border border-brand-500/5 rounded-full animate-[spin_15s_linear_infinite_reverse]"></div>
                            </div>

                            {/* Connection Matrix */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-x-24 gap-y-16 relative z-10">
                                {tools.map((t, i) => (
                                    <div key={i} className="group relative flex flex-col items-center">
                                        {/* Connection Line to Core */}
                                        <div className="absolute hidden md:block top-1/2 left-1/2 w-48 h-px bg-gradient-to-r from-brand-500/0 via-brand-500/20 to-brand-500/0 origin-left -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>

                                        <div className="relative w-24 h-24 rounded-2xl bg-white/[0.03] border border-white/5 flex items-center justify-center group-hover:border-brand-500/50 group-hover:bg-brand-500/5 transition-all duration-500 group-hover:-translate-y-2 group-hover:shadow-[0_0_25px_rgba(var(--brand-500),0.2)]">
                                            <Logo className="absolute inset-0 w-full h-full p-6 opacity-[0.03] group-hover:opacity-10 transition-opacity" />
                                            <div className="group-hover:scale-110 transition-transform duration-500 relative z-10">
                                                <img
                                                    src={`https://cdn.simpleicons.org/${t.slug}/white`}
                                                    alt={t.name}
                                                    className="w-9 h-9 opacity-40 group-hover:opacity-100 transition-opacity"
                                                    onError={(e) => {
                                                        e.target.onerror = null;
                                                        e.target.src = "https://cdn.simpleicons.org/codefactor/white";
                                                    }}
                                                />
                                            </div>

                                            {/* Data transmission pulse */}
                                            <div className="absolute inset-0 rounded-2xl border-2 border-brand-400 opacity-0 group-hover:animate-ping-once transition-all"></div>
                                        </div>

                                        <div className="mt-4">
                                            <div className="text-[10px] font-mono text-slate-500 font-bold uppercase tracking-widest group-hover:text-brand-400 transition-colors">{t.name}</div>
                                            <div className="text-[8px] font-mono text-slate-700 opacity-0 group-hover:opacity-100 transition-opacity">LINK: STABLE</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <style>{`
                        @keyframes ping-once {
                            0% { transform: scale(1); opacity: 0.5; }
                            100% { transform: scale(1.5); opacity: 0; }
                        }
                        .animate-ping-once {
                            animation: ping-once 0.6s cubic-bezier(0, 0, 0.2, 1) forwards;
                        }
                    `}</style>
                </section>
            );
        };

        const LandingPage = ({ onLogin }) => {
            const [isFocusMode, setIsFocusMode] = useState(false);
            const [showBios, setShowBios] = useState(!sessionStorage.getItem('velosify_booted'));
            const [showCmd, setShowCmd] = useState(false);

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.metaKey && e.key === 'k' || e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        setShowCmd(p => !p);
                    }
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

                    switch (e.key.toLowerCase()) {
                        case 's':
                            if (!showCmd) document.getElementById('features')?.scrollIntoView({ behavior: 'smooth' });
                            break;
                        case 'l':
                            if (!showCmd) onLogin();
                            break;
                        case 'd':
                            if (!showCmd) document.querySelector('.perspective-1000')?.scrollIntoView({ behavior: 'smooth' });
                            break;
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [onLogin, showCmd]);

            const handleBiosComplete = () => {
                setShowBios(false);
                sessionStorage.setItem('velosify_booted', 'true');
            };

            return (
                <div className="min-h-screen text-white font-sans selection:bg-brand-500/30 overflow-hidden relative">
                    {showBios && <BiosLoader onComplete={handleBiosComplete} />}
                    <CommandMenu isOpen={showCmd} onClose={() => setShowCmd(false)} />

                    {/* Background Ambience / Digital Rain Placeholder */}
                    <div className={`fixed inset-0 z-0 pointer-events-none transition-all duration-1000 ${isFocusMode ? 'opacity-0' : 'opacity-100'}`}>
                        <div className="scifi-grid-animated absolute inset-0"></div>
                        <div className="absolute top-0 inset-x-0 h-32 bg-gradient-to-b from-[#05050a] to-transparent z-10"></div>
                        <div className="absolute bottom-0 inset-x-0 h-32 bg-gradient-to-t from-[#05050a] to-transparent z-10"></div>
                    </div>

                    {/* Navigation */}
                    <nav className={`fixed top-0 w-full z-50 transition-all duration-1000 py-6 ${isFocusMode ? 'grayscale opacity-50 blur-[2px]' : 'bg-transparent'}`}>
                        <div className="max-w-7xl mx-auto px-6 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <Logo className="w-9 h-9" />
                                <span className="font-bold text-lg tracking-tight">VELOSIFY</span>
                            </div>
                            <div className="flex items-center gap-6">
                                <FocusToggle isFocusMode={isFocusMode} toggle={() => setIsFocusMode(!isFocusMode)} />
                                <button onClick={() => document.getElementById('features').scrollIntoView({ behavior: 'smooth' })} className="hidden md:block text-slate-400 hover:text-white text-sm font-medium transition-colors">Modules</button>
                                <button onClick={onLogin} className="px-4 py-2 bg-white text-black hover:bg-brand-500 hover:text-white font-bold rounded-lg transition-all text-[10px] uppercase tracking-widest transform hover:scale-105 active:scale-95 flex items-center gap-2">
                                    Access Terminal <span className="hidden md:inline-block border border-black/20 rounded px-1 text-[8px] font-mono opacity-50">L</span>
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* SECTION 1: HERO */}
                    <section className="relative min-h-screen flex flex-col justify-center items-center overflow-hidden">
                        <div className="z-10 text-center max-w-5xl px-6 relative">
                            {/* Focus Mode Overlay Effect */}
                            {isFocusMode && <div className="absolute inset-0 z-50 pointer-events-none bg-gradient-to-t from-[#05050a] via-transparent to-[#05050a]"></div>}

                            <div className={`mb-6 inline-flex items-center gap-2 px-3 py-1 rounded-full border border-brand-500/30 bg-brand-500/10 text-brand-400 text-xs font-mono uppercase tracking-widest animate-pulse transition-all duration-1000 ${isFocusMode ? 'opacity-0' : ''}`}>
                                <span className="w-2 h-2 rounded-full bg-brand-500"></span> Neural Link Established
                            </div>
                            <h1 className="text-6xl md:text-8xl font-black tracking-tighter mb-4 leading-none text-transparent bg-clip-text bg-gradient-to-r from-white via-brand-400 to-slate-400 drop-shadow-[0_0_30px_rgba(255,255,255,0.2)]">UPGRADE YOUR BRAIN.</h1>
                            <h1 className="text-6xl md:text-8xl font-black tracking-tighter mb-8 leading-none text-transparent bg-clip-text bg-gradient-to-r from-brand-600 via-brand-400 to-brand-600 drop-shadow-[0_0_30px_rgba(var(--brand-500),0.4)]">HACK YOUR PLACEMENT.</h1>

                            <HeroTerminal onLogin={onLogin} />
                        </div>
                    </section>

                    <ScienceSection />
                    <DopamineQuarantine />
                    <Integrations />

                    {/* SECTION 2: VISUAL SHOWCASE */}
                    <section className={`py-20 px-6 relative z-20 -mt-20 transition-all duration-1000 ${isFocusMode ? 'blur-lg opacity-20 pointer-events-none' : ''}`}>
                        <div className="max-w-6xl mx-auto">
                            <TiltContainer>
                                <div className="relative rounded-3xl border border-white/10 bg-surface-900/80 backdrop-blur-xl shadow-[0_0_100px_rgba(var(--brand-500),0.15)] overflow-hidden">
                                    <div className="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-50 pointer-events-none"></div>
                                    <div className="h-12 border-b border-white/10 flex items-center px-6 gap-4 bg-black/40">
                                        <div className="flex gap-2"><div className="w-3 h-3 rounded-full bg-red-500/50"></div><div className="w-3 h-3 rounded-full bg-yellow-500/50"></div><div className="w-3 h-3 rounded-full bg-emerald-500/50"></div></div>
                                        <div className="flex-1 text-center font-mono text-[10px] text-slate-500 uppercase tracking-widest flex items-center justify-center gap-2"><Icon name="lock" size={10} /> Velosify v2.0 // Neural Interface Active</div>
                                    </div>
                                    <div className="relative overflow-hidden">
                                        <div className="absolute inset-0 bg-brand-500/10 mix-blend-overlay z-10 pointer-events-none"></div>
                                        <img
                                            src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=3540&auto=format&fit=crop"
                                            alt="Dashboard Interface"
                                            className="w-full h-auto object-cover opacity-90"
                                        />
                                        <div className="absolute inset-0 bg-gradient-to-t from-surface-900 via-transparent to-transparent z-20"></div>

                                        {/* Floating Graphics Overlay - Advanced Metrics */}
                                        <div className="absolute bottom-8 left-8 right-8 z-30 grid grid-cols-1 md:grid-cols-3 gap-4">
                                            {/* Metric 1: CPU Intelligence */}
                                            <div className="bg-[#05050a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl relative overflow-hidden group">
                                                <div className="absolute inset-0 bg-brand-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                <div className="flex justify-between items-start mb-2 relative z-10">
                                                    <div className="flex items-center gap-2">
                                                        <div className="p-1.5 bg-brand-500/10 rounded-md text-brand-400"><Icon name="cpu" size={14} /></div>
                                                        <span className="text-[10px] font-mono text-slate-400 uppercase tracking-widest font-bold">Neural CPU</span>
                                                    </div>
                                                    <span className="text-xs font-mono font-bold text-brand-400">84%</span>
                                                </div>
                                                <div className="h-12 w-full relative z-10">
                                                    <svg className="w-full h-full" viewBox="0 0 100 40" preserveAspectRatio="none">
                                                        <path d="M0,35 L10,30 L20,38 L30,20 L40,30 L50,10 L60,25 L70,15 L80,30 L90,10 L100,25" fill="none" stroke="currentColor" className="text-brand-500" strokeWidth="1.5" vectorEffect="non-scaling-stroke" />
                                                        <path d="M0,35 L10,30 L20,38 L30,20 L40,30 L50,10 L60,25 L70,15 L80,30 L90,10 L100,25 V40 H0 Z" fill="currentColor" className="text-brand-500/10" />
                                                    </svg>
                                                </div>
                                            </div>

                                            {/* Metric 2: Network Flux */}
                                            <div className="bg-[#05050a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl relative overflow-hidden group">
                                                <div className="absolute inset-0 bg-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                <div className="flex justify-between items-start mb-2 relative z-10">
                                                    <div className="flex items-center gap-2">
                                                        <div className="p-1.5 bg-emerald-500/10 rounded-md text-emerald-400"><Icon name="activity" size={14} /></div>
                                                        <span className="text-[10px] font-mono text-slate-400 uppercase tracking-widest font-bold">Data Flux</span>
                                                    </div>
                                                    <span className="text-xs font-mono font-bold text-emerald-400">4.2 GB/s</span>
                                                </div>
                                                <div className="h-12 w-full flex items-end gap-1 relative z-10 px-1">
                                                    <div className="w-1/12 bg-emerald-500/20 h-[40%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/40 h-[70%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/30 h-[50%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/60 h-[80%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/40 h-[60%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/80 h-[90%] rounded-sm animate-pulse"></div>
                                                    <div className="w-1/12 bg-emerald-500/50 h-[50%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/30 h-[40%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/60 h-[70%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/40 h-[50%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/20 h-[30%] rounded-sm"></div>
                                                    <div className="w-1/12 bg-emerald-500/10 h-[20%] rounded-sm"></div>
                                                </div>
                                            </div>

                                            {/* Metric 3: System Stability */}
                                            <div className="bg-[#05050a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl relative overflow-hidden group">
                                                <div className="absolute inset-0 bg-pink-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                <div className="flex justify-between items-start mb-4 relative z-10">
                                                    <div className="flex items-center gap-2">
                                                        <div className="p-1.5 bg-pink-500/10 rounded-md text-pink-400"><Icon name="zap" size={14} /></div>
                                                        <span className="text-[10px] font-mono text-slate-400 uppercase tracking-widest font-bold">Core Stability</span>
                                                    </div>
                                                    <span className="text-xs font-mono font-bold text-pink-400">99.9%</span>
                                                </div>
                                                <div className="h-2 w-full bg-slate-800 rounded-full overflow-hidden relative z-10">
                                                    <div className="h-full w-[99.9%] bg-gradient-to-r from-pink-600 to-pink-400 shadow-[0_0_15px_rgba(236,72,153,0.5)]"></div>
                                                </div>
                                                <div className="mt-2 flex justify-between text-[8px] font-mono text-slate-500 uppercase tracking-widest">
                                                    <span>Lat: 12ms</span>
                                                    <span>Uptime: 42d</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </TiltContainer>
                        </div>
                    </section>

                    <ComparisonDiff />
                    <SystemArchitecture />

                    {/* NEW CONVERSION SECTIONS */}
                    <CodeReviews />
                    <FocusCalculator />

                    <SonicFocusWidget />
                    <LiveActivityTicker />

                    {/* SECTION 4: FOOTER */}
                    <footer className="border-t border-white/5 bg-[#030305] relative z-10">
                        <div className="overflow-hidden py-3 bg-brand-900/10 border-b border-white/5">
                            <div className="whitespace-nowrap animate-[marquee_20s_linear_infinite] text-[10px] font-mono text-brand-400 font-bold uppercase tracking-[0.3em] flex gap-12">
                                <span>SYSTEM STATUS: ONLINE</span><span>USERS: ACTIVE</span><span>VERSION: 2.0.4</span><span>LATENCY: 12ms</span><span>ENCRYPTION: AES-256</span>
                                <span>SYSTEM STATUS: ONLINE</span><span>USERS: ACTIVE</span><span>VERSION: 2.0.4</span><span>LATENCY: 12ms</span><span>ENCRYPTION: AES-256</span>
                            </div>
                        </div>
                        <div className="max-w-7xl mx-auto px-6 py-12 flex flex-col md:flex-row justify-between items-center gap-8">
                            <div className="flex items-center gap-3">
                                <Logo className="w-9 h-9" />
                                <div>
                                    <div className="font-bold text-white tracking-tight uppercase">Velosify</div>
                                    <div className="text-[10px] text-slate-500 font-mono uppercase tracking-widest">Neural Study OS</div>
                                </div>
                            </div>
                            <div className="flex gap-6 grayscale opacity-50 hover:grayscale-0 hover:opacity-100 transition-all duration-500">
                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400"><Icon name="globe" size={14} /> React</div>
                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400"><Icon name="database" size={14} /> Firebase</div>
                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400"><Icon name="layers" size={14} /> Tailwind</div>
                            </div>
                            <div className="text-xs text-slate-600 font-mono">Built by <span className="text-white">Arpit Namdeo</span></div>
                        </div>
                    </footer>
                </div>
            );
        };

        /* --- DASHBOARD COMPONENTS --- */
        const ProgressBar = ({ value, max, color = "bg-brand-500" }) => {
            const p = Math.min(100, Math.max(0, (value / max) * 100));
            return (<div className="w-full bg-black/40 rounded-full h-1.5 overflow-hidden border border-white/5"><div className={cn("h-full rounded-full transition-all duration-1000 shadow-[0_0_10px_currentColor]", color)} style={{ width: `${p}%` }}></div></div>);
        };

        // NEW: RADAR / SPIDER CHART FOR PERFORMANCE METRICS
        const RadarChart = ({ data }) => {
            // data: [{ label, value (0-100) }]
            const size = 300;
            const center = size / 2;
            const radius = 100;
            const angleSlice = (Math.PI * 2) / data.length;

            // Helper to get coordinates
            const getCoords = (val, i) => {
                const angle = i * angleSlice - Math.PI / 2;
                const r = (val / 100) * radius;
                return { x: center + r * Math.cos(angle), y: center + r * Math.sin(angle) };
            };

            // Generate Path for Data Area
            const pathData = data.map((d, i) => {
                const { x, y } = getCoords(d.value, i);
                return `${x},${y}`;
            }).join(' ');

            return (
                <div className="flex items-center justify-center p-4 h-full relative">
                    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className="overflow-visible">
                        {/* Background Grid (Concentric Polygons) */}
                        {[20, 40, 60, 80, 100].map((level, idx) => (
                            <polygon
                                key={idx}
                                points={data.map((_, i) => {
                                    const { x, y } = getCoords(level, i);
                                    return `${x},${y}`;
                                }).join(' ')}
                                fill="none"
                                stroke="#334155"
                                strokeWidth="0.5"
                                strokeDasharray="4 4"
                                className="opacity-30"
                            />
                        ))}

                        {/* Axes Lines */}
                        {data.map((_, i) => {
                            const { x, y } = getCoords(100, i);
                            return <line key={i} x1={center} y1={center} x2={x} y2={y} stroke="#334155" strokeWidth="0.5" className="opacity-30" />;
                        })}

                        {/* The Data Polygon */}
                        <polygon
                            points={pathData}
                            fill="rgba(14, 165, 233, 0.2)"
                            stroke="#0ea5e9"
                            strokeWidth="2"
                            className="drop-shadow-[0_0_10px_rgba(14,165,233,0.5)] animate-pulse"
                        />

                        {/* Data Points */}
                        {data.map((d, i) => {
                            const { x, y } = getCoords(d.value, i);
                            return (
                                <g key={i}>
                                    <circle cx={x} cy={y} r="3" className="fill-brand-400" />
                                    {/* Labels located outside the polygon */}
                                    <text
                                        x={center + (radius + 25) * Math.cos(i * angleSlice - Math.PI / 2)}
                                        y={center + (radius + 25) * Math.sin(i * angleSlice - Math.PI / 2)}
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        className="text-[10px] fill-slate-400 font-mono uppercase font-bold tracking-wider"
                                    >
                                        {d.label}
                                    </text>
                                </g>
                            );
                        })}
                    </svg>
                </div>
            );
        };

        const StatCard = ({ label, value, sub, icon, color }) => (
            <Card className={cn("border-t-2 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300", color)}>
                <div className="absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                    <Icon name={icon} size={60} />
                </div>
                <div className="flex justify-between items-start mb-4 relative z-10">
                    <div className="text-xs font-bold dark:text-slate-400 text-slate-500 uppercase tracking-widest">{label}</div>
                    <div className="p-2 rounded-lg dark:bg-white/5 bg-slate-100 dark:text-slate-300 text-slate-600 group-hover:bg-white/10 transition-colors"><Icon name={icon} size={18} /></div>
                </div>
                <div className="text-4xl font-black dark:text-white text-slate-900 tracking-tighter relative z-10">{value}</div>
                {sub && <div className="text-xs dark:text-slate-500 text-slate-400 mt-2 font-mono uppercase tracking-wide relative z-10">{sub}</div>}
            </Card>
        );

        /* --- FEATURE MODULES --- */
        const Dashboard = ({ user, setTab }) => {
            const stats = useMemo(() => {
                // Approximate Total Modules derived from templates
                // g1-g9 (GATE) have roughly ~35-40 topics total.
                // Using a rough estimate for visualization if user.syllabusTracker is sparse.

                const tracker = user.syllabusTracker || {};
                let comp = 0;

                Object.values(tracker).forEach(subject => {
                    Object.values(subject).forEach(status => {
                        if (status === 'done') comp++;
                    });
                });

                // Prepare Data for Radar Chart derived from known Subject IDs
                const getSubjectProgress = (ids) => {
                    let total = 0;
                    let done = 0;
                    const subjectList = Array.isArray(ids) ? ids : [ids];

                    subjectList.forEach(sid => {
                        const sData = tracker[sid] || {};
                        // Mocking total subtopics per subject as average 5 for calculation
                        // Since we don't have the full template here, we estimate "mastery" based on done count vs expected ~5
                        const sKeys = Object.keys(sData);
                        done += Object.values(sData).filter(v => v === 'done').length;
                        // Determine progress: If tracked items exist, use them, else 0. 
                        // To make the graph look active, we normalize 'done' against a standard denominator.
                        total += 5;
                    });

                    return Math.min(100, Math.round((done / total) * 100));
                };

                const graphData = [
                    { label: 'Calculus', value: getSubjectProgress(['g1']) }, // Math
                    { label: 'Logic', value: getSubjectProgress(['g2', 'g5']) }, // Logic + TOC
                    { label: 'Systems', value: getSubjectProgress(['g3', 'g7']) }, // CO + OS
                    { label: 'Software', value: getSubjectProgress(['g6', 'g8']) }, // Compiler + DBMS
                    { label: 'Network', value: getSubjectProgress(['g9']) }, // CN
                    { label: 'Code', value: getSubjectProgress(['g4']) }, // DSA
                ];

                const compliance = user.verifiedSOPs ? Math.round((user.verifiedSOPs.length / 8) * 100) : 0;

                return { comp, tot: 45, doing: user.kanban?.doing?.length || 0, done: user.kanban?.done?.length || 0, graphData, compliance };
            }, [user]);

            const nextExam = new Date(user.examDate || '2026-02-01');
            const daysLeft = Math.ceil((nextExam - new Date()) / (1000 * 60 * 60 * 24));

            // NEW: Badge Logic
            const badges = [
                { id: 'sql_master', icon: 'database', label: 'SQL Master', color: 'text-blue-400', bg: 'bg-blue-500/20', border: 'border-blue-500/30' },
                { id: 'dsa_expert', icon: 'code', label: 'DSA Expert', color: 'text-purple-400', bg: 'bg-purple-500/20', border: 'border-purple-500/30' },
                { id: 'sys_architect', icon: 'server', label: 'Sys Architect', color: 'text-emerald-400', bg: 'bg-emerald-500/20', border: 'border-emerald-500/30' }
            ];

            return (
                <div className="space-y-8 animate-fade-in pb-12">
                    {/* HERO HEADER */}
                    <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 pb-8 border-b border-white/5">
                        <div>
                            <div className="flex items-center gap-3 mb-3">
                                <span className="px-3 py-1 rounded bg-brand-500/20 text-brand-400 text-xs font-bold uppercase tracking-widest border border-brand-500/30 flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-brand-500 animate-pulse"></div>
                                    Lvl 1  Initiate
                                </span>
                            </div>
                            <h2 className="text-5xl font-black dark:text-white text-slate-900 tracking-tighter flex items-center gap-4">
                                <Logo className="w-12 h-12 text-brand-400" />
                                COMMAND CENTER
                            </h2>
                        </div>
                        <div className="text-right hidden md:block">
                            <div className="text-6xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-500 tracking-tighter">{daysLeft}</div>
                            <div className="text-xs text-brand-400 uppercase tracking-[0.3em] font-bold mt-1 opacity-70">Days to Launch</div>
                        </div>
                    </div>

                    {/* STATS GRID */}
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-6">
                        <StatCard label="Syllabus" value={`${Math.round((stats.comp / stats.tot) * 100) || 0}%`} sub={`${stats.comp}/${stats.tot} Modules`} icon="book-open" color="border-emerald-500" />
                        <StatCard label="Projects" value={stats.doing} sub={`${stats.done} Completed`} icon="trello" color="border-brand-500" />
                        <StatCard label="Focus Time" value={`${Math.floor((user.totalTime || 0) / 60)}h`} sub="Total Elapsed" icon="clock" color="border-purple-500" />
                        <StatCard label="Review" value={(user.flashcards || []).length} sub="Cards in Deck" icon="zap" color="border-pink-500" />
                        <StatCard label="Compliance" value={`${stats.compliance}%`} sub="SOPs Verified" icon="shield" color="border-blue-500" />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* LEFT COLUMN: VISUALIZATIONS */}
                        <div className="lg:col-span-2 space-y-8">
                            {/* SKILL MAP */}
                            <Card className="min-h-[450px] flex flex-col relative overflow-hidden group">
                                <div className="absolute inset-0 bg-brand-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"></div>
                                <div className="flex justify-between items-center mb-8 border-b border-white/5 pb-4 relative z-10">
                                    <h3 className="text-xl font-bold dark:text-white text-slate-900 flex gap-3 items-center tracking-tight">
                                        <div className="p-2 rounded bg-brand-500/10 text-brand-400 border border-brand-500/20"><Icon name="hexagon" size={20} /></div>
                                        NEURAL SKILL MAP
                                    </h3>
                                    <button onClick={() => setTab('dsa')} className="px-4 py-2 rounded bg-white/5 hover:bg-white/10 text-xs font-bold uppercase tracking-widest text-slate-400 hover:text-white transition-all flex items-center gap-2 border border-white/5 hover:border-white/20">
                                        Open Graph View <Icon name="external-link" size={12} />
                                    </button>
                                </div>
                                <div className="flex-1 w-full dark:bg-[#05050a] bg-slate-50 rounded-2xl border border-white/5 shadow-inner relative z-10">
                                    <RadarChart data={stats.graphData} />
                                </div>
                            </Card>

                            {/* CERTIFICATION TRACK */}
                            <Card className="flex flex-col relative overflow-hidden">
                                <div className="flex justify-between items-center mb-6 border-b border-white/5 pb-4">
                                    <h3 className="text-xl font-bold dark:text-white text-slate-900 flex gap-3 items-center tracking-tight">
                                        <div className="p-2 rounded bg-amber-500/10 text-amber-400 border border-amber-500/20"><Icon name="award" size={20} /></div>
                                        CERTIFICATION TRACK
                                    </h3>
                                    <span className="text-[10px] font-mono text-slate-500 uppercase tracking-widest">Premium Access</span>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {badges.map(b => (
                                        <div key={b.id} className={`p-4 rounded-xl border ${b.border} ${b.bg} flex items-center gap-4 transition-transform hover:scale-105 cursor-pointer group`}>
                                            <div className={`p-3 rounded-full bg-black/20 ${b.color} group-hover:scale-110 transition-transform`}>
                                                <Icon name={b.icon} size={24} />
                                            </div>
                                            <div>
                                                <div className={`font-bold ${b.color} text-sm`}>{b.label}</div>
                                                <div className="text-[10px] text-white/60 font-mono uppercase tracking-wider mt-1">
                                                    {user.certifications && user.certifications.includes(b.id) ? 'VERIFIED' : 'LOCKED'}
                                                </div>
                                            </div>
                                            {user.certifications && user.certifications.includes(b.id) && (
                                                <div className="ml-auto text-emerald-400"><Icon name="check-circle" size={16} /></div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                {!user.isPremium && (
                                    <div className="mt-6 p-4 rounded-xl bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 flex items-center justify-between">
                                        <div className="flex items-center gap-4">
                                            <div className="p-3 bg-amber-500/20 text-amber-400 rounded-lg"><Icon name="crown" size={24} /></div>
                                            <div>
                                                <div className="font-bold text-amber-400 text-sm uppercase tracking-wide">Unlock Premium Certification</div>
                                                <div className="text-[10px] text-slate-400 mt-1">Get verified badges, advanced analytics, and mock interviews.</div>
                                            </div>
                                        </div>
                                        <button className="px-6 py-2 bg-amber-500 text-black font-bold text-xs uppercase tracking-widest rounded-lg hover:bg-amber-400 transition-colors shadow-lg shadow-amber-500/20">
                                            UPGRADE
                                        </button>
                                    </div>
                                )}
                            </Card>
                        </div>

                        {/* RIGHT COLUMN: ACTIONS */}
                        <div className="space-y-6">
                            <Card className="flex flex-col items-center justify-center text-center !bg-brand-900/10 border-brand-500/20 relative group cursor-pointer lg:h-64" onClick={() => setTab('focus')}>
                                <div className="absolute inset-0 bg-brand-500/5 group-hover:bg-brand-500/10 transition-colors"></div>
                                <div className="w-24 h-24 rounded-full dark:bg-black bg-white border border-brand-500/50 flex items-center justify-center mb-6 shadow-[0_0_40px_rgba(var(--brand-500),0.3)] group-hover:scale-110 transition-transform"><Icon name="play" size={40} className="dark:text-white text-brand-600 ml-1" /></div>
                                <h3 className="text-2xl font-black dark:text-white text-slate-900 z-10 tracking-tight">ENGAGE FOCUS</h3>
                                <p className="text-brand-300 text-xs mt-2 z-10 opacity-70 px-6 font-mono uppercase tracking-widest">Enter Deep Work State</p>
                            </Card>

                            <Card className="flex flex-col group cursor-pointer hover:border-purple-500/50 transition-all" onClick={() => setTab('dsa')}>
                                <div className="flex items-center gap-4 mb-4">
                                    <div className="p-3 rounded bg-purple-500/20 text-purple-400"><Icon name="code" size={20} /></div>
                                    <div>
                                        <h4 className="font-bold text-lg text-white">DSA Tracker</h4>
                                        <p className="text-[10px] text-purple-400 uppercase tracking-widest">Daily Streak: {user.streak || 0}</p>
                                    </div>
                                </div>
                                <div className="w-full h-1 bg-white/10 rounded-full overflow-hidden">
                                    <div className="h-full bg-purple-500 w-[65%]"></div>
                                </div>
                            </Card>

                            <Card className="flex flex-col group cursor-pointer hover:border-emerald-500/50 transition-all" onClick={() => setTab('roadmaps')}>
                                <div className="flex items-center gap-4 mb-4">
                                    <div className="p-3 rounded bg-emerald-500/20 text-emerald-400"><Icon name="map" size={20} /></div>
                                    <div>
                                        <h4 className="font-bold text-lg text-white">Roadmaps</h4>
                                        <p className="text-[10px] text-emerald-400 uppercase tracking-widest">3 Active Paths</p>
                                    </div>
                                </div>
                                <div className="w-full h-1 bg-white/10 rounded-full overflow-hidden">
                                    <div className="h-full bg-emerald-500 w-[40%]"></div>
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        };

        const FocusEngine = ({ focus, setFocus, setTab }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [strict, setStrict] = useState(false);
            const [dCount, setDCount] = useState(0);
            const [streak, setStreak] = useState(0);
            const [intent, setIntent] = useState("");
            const [isIntentLocked, setIsIntentLocked] = useState(false);
            const [audioMode, setAudioMode] = useState("mute");
            const [volume, setVolume] = useState(0.5);
            const [showMissionComplete, setShowMissionComplete] = useState(false);
            const [isEditingTime, setIsEditingTime] = useState(false);
            const [tempTime, setTempTime] = useState("");

            const audioRef = useRef(null);

            // Technical Fix: Proctor Logic with useRef to avoid stale closure
            const isRunningRef = useRef(focus.isActive);
            useEffect(() => { isRunningRef.current = focus.isActive; }, [focus.isActive]);

            // Audio Sources
            const AUDIO_SRCS = {
                rain: "https://cdn.pixabay.com/audio/2022/03/24/audio_3398939626.mp3",
                white_noise: "https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3"
            };

            // Audio Logic
            useEffect(() => {
                if (!audioRef.current) audioRef.current = new Audio();
                const audio = audioRef.current;

                if (audioMode === 'mute' || !focus.isActive) {
                    audio.pause();
                } else {
                    audio.src = AUDIO_SRCS[audioMode];
                    audio.loop = true;
                    audio.volume = volume;
                    audio.play().catch(e => console.log("Audio autoplay blocked", e));
                }

                return () => audio.pause();
            }, [audioMode, focus.isActive]);

            // Completion Logic
            useEffect(() => {
                if (focus.isActive && focus.timeLeft === 0) {
                    setFocus(p => ({ ...p, isActive: false }));
                    setStreak(s => s + 1);
                    setShowMissionComplete(true);
                    setIsIntentLocked(false);
                }
            }, [focus.timeLeft, focus.isActive]);

            // Proctor Mode Fix
            useEffect(() => {
                const handleVisibilityChange = () => {
                    if (document.hidden && isRunningRef.current && strict) {
                        setFocus(p => ({ ...p, isActive: false }));
                        setDCount(c => c + 1);
                        setStreak(0); // Penalty

                        // Play Alarm
                        const ctx = new (window.AudioContext || window.webkitAudioContext)();
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(440, ctx.currentTime);
                        gain.gain.setValueAtTime(0.5, ctx.currentTime);
                        osc.start();
                        osc.stop(ctx.currentTime + 1);
                    }
                };
                document.addEventListener("visibilitychange", handleVisibilityChange);
                return () => document.removeEventListener("visibilitychange", handleVisibilityChange);
            }, [strict]);

            const fmt = s => `${Math.floor(s / 60)}:${String(s % 60).padStart(2, '0')}`;

            const toggle = () => {
                if (!intent.trim()) {
                    alert("PROTOCOL ERROR: Define mission objective before engagement.");
                    return;
                }
                setIsIntentLocked(true);
                setFocus(p => ({ ...p, isActive: !p.isActive }));
            };

            const reset = () => {
                setFocus(p => ({ ...p, isActive: false, timeLeft: p.initialTime }));
                setDCount(0);
                setIsIntentLocked(false);
                setIntent("");
            };

            const setTime = (m) => {
                const mins = parseInt(m);
                if (isNaN(mins) || mins <= 0) return;
                setFocus({ timeLeft: mins * 60, initialTime: mins * 60, isActive: false });
                setIsEditingTime(false);
            };

            const toggleTheme = () => {
                document.documentElement.classList.toggle('dark');
            };

            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(() => { });
                } else {
                    document.exitFullscreen();
                }
            };

            // Circular Progress Math
            const radius = 120;
            const circumference = 2 * Math.PI * radius;
            const progress = focus.initialTime > 0 ? (focus.timeLeft / focus.initialTime) : 0;
            const dashOffset = circumference * (1 - progress);
            const progressColor = progress > 0.5 ? '#22d3ee' : progress > 0.1 ? '#a855f7' : '#ef4444';

            return (
                <div className="min-h-screen relative transition-colors duration-300 dark:bg-black bg-white flex flex-col items-center justify-center overflow-hidden">
                    {/* Header: Exit Button (Left), Controls (Right) */}
                    <button
                        onClick={() => setTab('dashboard')}
                        className="absolute top-6 left-6 p-4 bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white border border-red-500/30 rounded-2xl transition-all flex items-center gap-3 font-bold text-xs uppercase tracking-widest z-50 group"
                    >
                        <Icon name="log-out" size={18} className="group-hover:-translate-x-1 transition-transform" />
                        EXIT ZONE
                    </button>

                    <div className="absolute top-6 right-6 flex gap-3 z-50">
                        <button
                            onClick={toggleFullscreen}
                            title="Toggle Fullscreen"
                            className="p-4 bg-slate-100 dark:bg-white/5 text-slate-900 dark:text-white rounded-2xl border border-slate-200 dark:border-white/10 hover:border-brand-500 transition-all flex items-center gap-2 group"
                        >
                            <Icon name="maximize" size={18} />
                            <span className="text-[10px] font-bold uppercase tracking-widest hidden group-hover:block transition-all">Fullscreen</span>
                        </button>
                    </div>

                    {/* Main Reactor: SVG Circle Progress + Time Display */}
                    <div className="relative group mb-12 flex items-center justify-center scale-110 md:scale-125">
                        {/* Breathing Core Effect when !isActive */}
                        {/* Breathing Core Effect when !isActive */}
                        {!focus.isActive && (
                            <motion.div
                                animate={{ scale: [1, 1.05, 1], opacity: [0.5, 1, 0.5] }}
                                transition={{ repeat: Infinity, duration: 3, ease: "easeInOut" }}
                                className="absolute w-[400px] h-[400px] bg-brand-500/20 dark:bg-brand-500/20 bg-blue-400/30 rounded-full blur-[80px]"
                            />
                        )}

                        <div className="relative w-80 h-80 flex items-center justify-center">
                            <svg className="w-full h-full transform -rotate-90" viewBox="0 0 260 260">
                                <circle cx="130" cy="130" r={radius} fill="none" stroke="currentColor" className="text-slate-100 dark:text-slate-900" strokeWidth="8" />
                                <motion.circle
                                    cx="130" cy="130" r={radius} fill="none" stroke={progressColor} strokeWidth="8" strokeLinecap="round"
                                    strokeDasharray={circumference}
                                    animate={{ strokeDashoffset: dashOffset }}
                                    transition={{ duration: 1, ease: "linear" }}
                                    className="drop-shadow-[0_0_15px_currentColor]"
                                />
                            </svg>

                            {/* Inner Content */}
                            <div className="absolute inset-0 flex flex-col items-center justify-center z-10">
                                {isEditingTime ? (
                                    <div className="flex flex-col items-center">
                                        <input
                                            autoFocus
                                            value={tempTime}
                                            onChange={e => setTempTime(e.target.value)}
                                            onBlur={() => setTime(tempTime)}
                                            onKeyDown={e => e.key === 'Enter' && setTime(tempTime)}
                                            className="text-6xl font-black font-mono bg-transparent text-center text-brand-500 outline-none w-48 border-b-2 border-brand-500 mb-2"
                                            placeholder="MINS"
                                        />
                                        <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Set Minutes</div>
                                    </div>
                                ) : (
                                    <>
                                        <div
                                            onClick={() => { setIsEditingTime(true); setTempTime(Math.floor(focus.timeLeft / 60).toString()); }}
                                            className={`text-7xl font-black font-mono tracking-tighter cursor-pointer transition-all hover:scale-110 active:scale-95 ${focus.isActive ? 'text-slate-900 dark:text-white' : 'text-slate-400 hover:text-brand-500'}`}
                                        >
                                            {fmt(focus.timeLeft)}
                                        </div>
                                        <div className={`mt-2 text-xs font-bold uppercase tracking-[0.3em] ${focus.isActive ? 'text-brand-500 animate-pulse' : 'text-slate-500'}`}>
                                            {focus.isActive ? 'SYSTEM ENGAGED' : 'SYSTEM STANDBY'}
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Control Deck: Start/Pause, Custom Time, Sound Controls */}
                    <div className="w-full max-w-lg space-y-8 px-8 relative z-10">
                        {/* Intent Input */}
                        <div className="relative">
                            <input
                                value={intent}
                                onChange={e => setIntent(e.target.value)}
                                placeholder="INITIALIZE MISSION OBJECTIVE..."
                                disabled={isIntentLocked}
                                className={`w-full bg-slate-50 dark:bg-white/5 border-2 p-5 rounded-2xl text-center font-bold outline-none transition-all uppercase tracking-widest text-sm ${isIntentLocked ? 'border-brand-500 text-brand-500 dark:text-brand-400 bg-brand-500/5' : 'border-slate-200 dark:border-white/10 dark:text-white text-slate-900 focus:border-brand-500'}`}
                            />
                            {isIntentLocked && <Icon name="lock" size={16} className="absolute right-6 top-1/2 -translate-y-1/2 text-brand-500" />}
                        </div>

                        {/* Control Buttons */}
                        <div className="flex gap-4">
                            <button
                                onClick={toggle}
                                className={`flex-1 py-5 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-[0_15px_30px_-10px_rgba(0,0,0,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-3 ${focus.isActive ? 'bg-amber-400 text-black shadow-amber-400/20' : 'bg-brand-600 text-white shadow-brand-600/30'}`}
                            >
                                <Icon name={focus.isActive ? "pause" : "play"} size={20} />
                                {focus.isActive ? "HALT SYSTEM" : "ENGAGE FOCUS"}
                            </button>

                            <div className="flex flex-col items-center">
                                <button
                                    onClick={reset}
                                    className="p-5 rounded-2xl bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-white/10 hover:text-red-500 hover:border-red-500/50 transition-all group"
                                >
                                    <Icon name="rotate-ccw" className="group-hover:rotate-180 transition-transform duration-500" />
                                </button>
                                <span className="text-[10px] font-bold text-slate-400 mt-2 uppercase tracking-widest">RESET</span>
                            </div>
                        </div>

                        {/* Sound & Proctor Controls */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-200 dark:border-white/10 flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <Icon name="shield" size={16} className={strict ? "text-red-500" : "text-slate-400"} />
                                    <span className="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest">Proctor</span>
                                </div>
                                <button
                                    onClick={() => setStrict(!strict)}
                                    className={`w-12 h-6 rounded-full transition-all relative ${strict ? 'bg-red-500' : 'bg-slate-300 dark:bg-slate-800'}`}
                                >
                                    <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-all shadow-sm ${strict ? 'right-1' : 'left-1'}`} />
                                </button>
                            </div>

                            <div className="bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-200 dark:border-white/10 flex items-center gap-3">
                                <Icon name="volume-2" size={16} className="text-slate-400" />
                                <select
                                    value={audioMode}
                                    onChange={e => setAudioMode(e.target.value)}
                                    className="bg-transparent text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase outline-none flex-1 cursor-pointer"
                                >
                                    <option value="mute">SOUND MIXER</option>
                                    <option value="rain">RAIN AMBIENCE</option>
                                    <option value="white_noise">DEEP WAVES</option>
                                </select>
                            </div>
                        </div>

                        {/* Time Presets */}
                        <div className="flex justify-center gap-4">
                            {[25, 45, 60, 90].map(m => (
                                <button
                                    key={m}
                                    onClick={() => setTime(m)}
                                    className="w-14 h-14 rounded-2xl border border-slate-200 dark:border-white/10 flex flex-col items-center justify-center hover:border-brand-500 hover:text-brand-500 transition-all bg-slate-50 dark:bg-white/5 active:scale-95"
                                >
                                    <span className="text-sm font-mono font-bold text-slate-900 dark:text-white">{m}</span>
                                    <span className="text-[8px] font-bold text-slate-400 uppercase">min</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Proctor Warning Overlay */}
                    <AnimatePresence>
                        {dCount > 0 && strict && (
                            <motion.div
                                initial={{ opacity: 0, scale: 0.9, y: 50 }} animate={{ opacity: 1, scale: 1, y: 0 }} exit={{ opacity: 0, scale: 0.9, y: 50 }}
                                className="fixed bottom-12 px-8 py-4 bg-red-600 text-white rounded-2xl font-black uppercase tracking-[0.2em] shadow-[0_20px_50px_rgba(220,38,38,0.5)] flex items-center gap-4 z-[60] border-4 border-white/20"
                            >
                                <Icon name="alert-triangle" size={24} />
                                <span className="text-sm">FOCUS BREACH DETECTED: x{dCount}</span>
                                <button onClick={() => setDCount(0)} className="ml-4 p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors">
                                    <Icon name="x" size={16} />
                                </button>
                            </motion.div>
                        )}
                    </AnimatePresence>

                    {/* Mission Complete Modal */}
                    <AnimatePresence>
                        {showMissionComplete && (
                            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[100] bg-black/95 backdrop-blur-2xl flex items-center justify-center p-6">
                                <motion.div initial={{ scale: 0.8, y: 20 }} animate={{ scale: 1, y: 0 }} className="max-w-md w-full text-center">
                                    <div className="w-24 h-24 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-8 border border-emerald-500/30 text-emerald-500">
                                        <Icon name="award" size={48} />
                                    </div>
                                    <h2 className="text-4xl font-black text-white mb-4 tracking-tighter uppercase">Mission Success</h2>
                                    <p className="text-slate-400 font-mono text-sm mb-12 uppercase tracking-[0.2em] border-y border-white/10 py-4">{intent}</p>
                                    <button
                                        onClick={() => setShowMissionComplete(false)}
                                        className="w-full py-5 bg-emerald-600 hover:bg-emerald-500 text-white font-black rounded-2xl uppercase tracking-[0.2em] shadow-lg shadow-emerald-600/20 transition-all active:scale-95"
                                    >
                                        Return to Base
                                    </button>
                                </motion.div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        /* --- SYLLABUS & TRACKER COMPONENT (UPDATED V2) --- */
        const Syllabus = ({ user, update, log }) => {
            const { motion, AnimatePresence } = window.Motion;

            const defaultProtocols = ['GATE', 'PLACEMENT', 'INTERVIEW'];
            const [exams, setExams] = useState(() => {
                try {
                    const saved = localStorage.getItem('velosify_exams');
                    return saved ? JSON.parse(saved) : defaultProtocols;
                } catch (e) { return defaultProtocols; }
            });

            // Ensure mode is valid or default to first available
            const [mode, setMode] = useState(() => {
                // If we have exams, default to the first one. 
                // We can't easily access the result of the exams useState initializer here directly in a clean way 
                // without duplicating logic or relying on the exams variable which works in React.
                // However, let's just default to 'GATE' or exams[0] safely.
                return 'GATE';
            });

            // Sync exams to local storage
            useEffect(() => {
                localStorage.setItem('velosify_exams', JSON.stringify(exams));
            }, [exams]);

            // Create/Delete Handlers
            const [showExamModal, setShowExamModal] = useState(false);
            const [newExamName, setNewExamName] = useState("");

            const handleCreateExam = (e) => {
                e.preventDefault();
                if (!newExamName.trim()) return;
                const name = newExamName.trim().toUpperCase();
                if (!exams.includes(name)) {
                    setExams(prev => [...prev, name]);
                    setMode(name);
                } else {
                    setMode(name);
                }
                setNewExamName("");
                setShowExamModal(false);
            };

            const handleDeleteExam = (examToDelete, e) => {
                e.stopPropagation();
                if (defaultProtocols.includes(examToDelete)) return;
                if (confirm(`Delete protocol ${examToDelete}? This cannot be undone.`)) {
                    const newExams = exams.filter(e => e !== examToDelete);
                    setExams(newExams);
                    if (mode === examToDelete) setMode(newExams[0] || 'GATE');
                }
            };

            const [expandedSubjectId, setExpandedSubjectId] = useState(null);
            const [customTopic, setCustomTopic] = useState({ subject: '', topic: '' });

            // INITIAL TEMPLATE DATA GENERATOR
            const getTemplateData = () => ({
                GATE: [
                    { id: 'g1', name: 'Engineering Mathematics', topics: ['Linear Algebra', 'Calculus', 'Probability', 'Discrete Mathematics'] },
                    { id: 'g2', name: 'Digital Logic', topics: ['Boolean Algebra', 'Combinational Circuits', 'Sequential Circuits', 'Number Systems'] },
                    { id: 'g3', name: 'Computer Organization', topics: ['Machine Instructions', 'Pipelining', 'Memory Hierarchy', 'I/O Organization'] },
                    { id: 'g4', name: 'Data Structures & Algorithms', topics: ['Arrays', 'Linked Lists', 'Stacks & Queues', 'Trees & Graphs', 'Sorting & Searching'] },
                    { id: 'g5', name: 'Theory of Computation', topics: ['Regular Expressions', 'Context-Free Grammars', 'Turing Machines', 'Undecidability'] },
                    { id: 'g6', name: 'Compiler Design', topics: ['Lexical Analysis', 'Parsing', 'Syntax Directed Translation', 'Code Optimization'] },
                    { id: 'g7', name: 'Operating Systems', topics: ['Processes & Threads', 'CPU Scheduling', 'Deadlocks', 'Memory Management'] },
                    { id: 'g8', name: 'Database Management', topics: ['ER-Model', 'SQL', 'Normalization', 'Transactions', 'Indexing'] },
                    { id: 'g9', name: 'Computer Networks', topics: ['OSI Model', 'TCP/IP', 'Subnetting', 'Routing Algorithms', 'Application Layer'] }
                ],
                PLACEMENT: [
                    { id: 'p1', name: 'Data Structures (Coding)', topics: ['Arrays & Strings', 'Linked List Manipulation', 'Tree Traversals', 'Graph BFS/DFS'] },
                    { id: 'p2', name: 'Algorithms', topics: ['Dynamic Programming (DP)', 'Greedy Algorithms', 'Backtracking', 'Bit Manipulation'] },
                    { id: 'p3', name: 'Aptitude & Logic', topics: ['Time & Work', 'Profit & Loss', 'Permutations & Combinations', 'Data Interpretation'] },
                    { id: 'p4', name: 'CS Fundamentals', topics: ['OS Concepts', 'DBMS SQL Queries', 'CN Basics', 'OOPs Concepts'] }
                ],
                INTERVIEW: [
                    { id: 'i1', name: 'HR Round Prep', topics: ['Tell me about yourself', 'Strengths & Weaknesses', 'Where do you see yourself in 5 years?', 'Why should we hire you?'] },
                    { id: 'i2', name: 'Behavioral Questions', topics: ['Handling Conflict', 'Leadership Experience', 'Failure & Learning', 'Teamwork Situations'] },
                    { id: 'i3', name: 'Project Discussions', topics: ['Project Architecture', 'Challenges Faced', 'Tech Stack Justification', 'Future Improvements'] }
                ]
            });

            // Initialize or Hydrate State from User Data
            // We use 'syllabusTracker' in user object to store the status of all topics.
            // Structure: { [subjectId]: { [topicName]: 'not-started' | 'in-progress' | 'done' } }

            const [syllabusState, setSyllabusState] = useState(user.syllabusTracker || {});

            // Update user persistence whenever local state changes
            useEffect(() => {
                if (JSON.stringify(user.syllabusTracker) !== JSON.stringify(syllabusState)) {
                    update({ ...user, syllabusTracker: syllabusState });
                }
            }, [syllabusState]);

            // Construct the Display Data dynamically
            const displayData = useMemo(() => {
                const templates = getTemplateData()[mode] || [];
                const custom = (user.customSyllabus || []).filter(item => item.mode === mode);

                // Combine and hydrate with status
                return [...templates, ...custom].map(subject => {
                    // Normalize topics to object structure if they are strings (template) or objects (custom)
                    // For standard template, topics are strings. For custom, they might be objects, but let's standardize.

                    const trackedSubject = syllabusState[subject.id] || {};

                    const hydratedTopics = subject.topics.map((t, idx) => {
                        const tTitle = typeof t === 'string' ? t : t.title || t.name;
                        const tId = typeof t === 'object' && t.id ? t.id : `${subject.id}_t${idx}`;
                        // Use topic title as key for persistence in standard data to avoid index issues if order changes, 
                        // but sticking to provided structure logic

                        return {
                            id: tId,
                            title: tTitle,
                            status: trackedSubject[tId] || 'not-started'
                        };
                    });

                    // Calculate Progress
                    const total = hydratedTopics.length;
                    const done = hydratedTopics.filter(t => t.status === 'done').length;
                    const progress = total === 0 ? 0 : Math.round((done / total) * 100);

                    return { ...subject, progress, topics: hydratedTopics };
                });
            }, [mode, syllabusState, user.customSyllabus]);

            const handleStatusChange = (subjectId, topicId, newStatus) => {
                setSyllabusState(prev => ({
                    ...prev,
                    [subjectId]: {
                        ...(prev[subjectId] || {}),
                        [topicId]: newStatus
                    }
                }));
                if (newStatus === 'done') log();
            };

            const handleAddTopic = (e) => {
                e.preventDefault();
                if (!customTopic.subject) return;

                const newSubject = {
                    id: `custom_${Date.now()}`,
                    name: customTopic.subject,
                    topics: customTopic.topic ? [{ id: `ct_${Date.now()}`, title: customTopic.topic }] : [],
                    mode: mode
                };

                update({ ...user, customSyllabus: [...(user.customSyllabus || []), newSubject] });
                setCustomTopic({ subject: '', topic: '' });
            };

            const handleDeleteModule = (id, e) => {
                e.stopPropagation();
                if (confirm("Delete this module and all its contents?")) {
                    const newCustom = (user.customSyllabus || []).filter(s => s.id !== id);
                    update({ ...user, customSyllabus: newCustom });
                }
            };

            const toggleAccordion = (id) => {
                setExpandedSubjectId(expandedSubjectId === id ? null : id);
            };

            const statusColors = {
                'not-started': 'bg-slate-700/50 text-slate-400 border-slate-600/50',
                'in-progress': 'bg-amber-500/20 text-amber-400 border-amber-500/50 shadow-[0_0_10px_rgba(245,158,11,0.2)]',
                'done': 'bg-emerald-500/20 text-emerald-400 border-emerald-500/50 shadow-[0_0_10px_rgba(16,185,129,0.2)]'
            };

            return (
                <div className="space-y-8 animate-fade-in pb-12 w-full max-w-5xl mx-auto">
                    <div className="flex flex-col md:flex-row justify-between items-end gap-6 border-b border-white/5 pb-6">
                        <div>
                            <div className="flex items-center gap-3 mb-2">
                                <Logo className="w-10 h-10 text-white" />
                                <h1 className="text-4xl font-black tracking-tighter text-white">
                                    System Syllabus
                                </h1>
                            </div>
                            <p className="text-slate-400 mt-2 font-mono text-xs">KNOWLEDGE GRAPH // {mode} PROTOCOL</p>
                        </div>

                        {/* MODE SWITCHER */}
                        {/* MODE SWITCHER - DYNAMIC & SCROLLABLE */}
                        <div className="flex items-center gap-2 max-w-full overflow-hidden">
                            <div className="flex-1 overflow-x-auto flex gap-2 pb-2 scrollbar-thin scrollbar-thumb-brand-500/20 scrollbar-track-transparent px-1">
                                {exams.map(m => (
                                    <div
                                        key={m}
                                        onClick={() => setMode(m)}
                                        className={`px-5 py-2.5 rounded-lg text-xs font-bold transition-all uppercase tracking-wider whitespace-nowrap flex items-center gap-3 flex-shrink-0 cursor-pointer border ${mode === m ? 'bg-brand-500 text-white border-brand-500 shadow-lg' : 'bg-surface-900/60 border-white/5 text-slate-400 hover:text-white hover:border-brand-500/50'}`}
                                    >
                                        <span>{m}</span>
                                        {!defaultProtocols.includes(m) && (
                                            <button
                                                onClick={(e) => handleDeleteExam(m, e)}
                                                className="p-1.5 rounded-md text-red-500 hover:bg-red-500 hover:text-white transition-all opacity-70 hover:opacity-100"
                                                title="Delete Protocol"
                                            >
                                                <Icon name="trash" size={14} />
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </div>
                            <button
                                onClick={() => setShowExamModal(true)}
                                className="px-4 py-2.5 rounded-lg bg-white/5 border border-white/10 text-slate-400 hover:text-brand-400 hover:border-brand-500/50 transition-all flex-shrink-0 flex items-center gap-2 text-xs font-bold uppercase tracking-wider"
                                title="Create New Protocol"
                            >
                                <Icon name="plus" size={14} /> <span>Create</span>
                            </button>
                        </div>
                    </div>

                    {/* LINEAR PERFORMANCE TRACKER */}
                    <div className="space-y-3">
                        {displayData.map((item) => (
                            <div key={item.id} className="group overflow-hidden bg-surface-900/60 backdrop-blur-md border border-white/5 hover:border-brand-500/30 rounded-xl transition-all duration-300">
                                {/* MAIN ROW */}
                                <div className="p-4 relative">
                                    <div className="absolute inset-0 bg-gradient-to-r from-brand-500/0 via-brand-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                                    <div className="flex flex-col md:flex-row items-center gap-6 relative z-10">
                                        {/* Left: Subject Name */}
                                        <div className="w-full md:w-1/4">
                                            <h3 className="font-bold text-white text-sm truncate">{item.name}</h3>
                                            <p className="text-[10px] text-slate-500 font-mono truncate">{item.topics.length} SUB-MODULES</p>
                                        </div>

                                        {/* Middle: Progress Bar */}
                                        <div className="flex-1 w-full flex items-center gap-4">
                                            <div className="h-2 w-full bg-black/50 rounded-full overflow-hidden border border-white/5 relative">
                                                <div className="absolute inset-0 z-10 opacity-20" style={{ backgroundImage: 'linear-gradient(to right, transparent 2px, #000 2px)', backgroundSize: '10px 100%' }}></div>
                                                <div
                                                    className="h-full bg-gradient-to-r from-brand-600 to-cyan-400 relative transition-all duration-1000 ease-out"
                                                    style={{ width: `${item.progress}%` }}
                                                >
                                                    <div className="absolute top-0 right-0 bottom-0 w-1 bg-white/50 animate-pulse"></div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Right: Stats & Action */}
                                        <div className="w-full md:w-auto flex items-center justify-between gap-4">
                                            <span className="font-mono font-bold text-brand-400 text-sm w-12 text-right">{item.progress}%</span>

                                            <div className="flex items-center gap-2">
                                                {item.id.toString().startsWith('custom_') && (
                                                    <button
                                                        onClick={(e) => handleDeleteModule(item.id, e)}
                                                        className="p-2 rounded-lg text-red-500 bg-red-500/10 hover:bg-red-500 hover:text-white transition-all border border-transparent hover:border-red-500/20"
                                                        title="Delete Section"
                                                    >
                                                        <Icon name="trash" size={16} />
                                                    </button>
                                                )}
                                                <button
                                                    onClick={() => toggleAccordion(item.id)}
                                                    className={`px-4 py-2 border rounded-lg text-[10px] font-bold uppercase tracking-widest transition-all flex items-center gap-2 group-hover:shadow-[0_0_15px_rgba(var(--brand-500),0.3)]
                                                        ${expandedSubjectId === item.id ? 'bg-brand-500 text-white border-brand-500' : 'bg-white/5 hover:bg-brand-500 hover:text-white border-white/10'}
                                                    `}
                                                >
                                                    {expandedSubjectId === item.id ? 'CLOSE' : 'ACCESS'} <Icon name={expandedSubjectId === item.id ? "chevron-up" : "chevron-right"} size={12} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* ACCORDION CONTENT */}
                                <AnimatePresence>
                                    {expandedSubjectId === item.id && (
                                        <motion.div
                                            initial={{ height: 0, opacity: 0 }}
                                            animate={{ height: "auto", opacity: 1 }}
                                            exit={{ height: 0, opacity: 0 }}
                                            transition={{ duration: 0.3, ease: "easeInOut" }}
                                            className="overflow-hidden bg-black/40 border-t border-white/5"
                                        >
                                            <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                                                {item.topics.map((t) => (
                                                    <div key={t.id} className="flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/5 hover:border-white/10 transition-colors">
                                                        <span className="text-xs font-medium text-slate-300">{t.title}</span>
                                                        <div className="flex gap-1 bg-black/50 rounded-lg p-1">
                                                            {[
                                                                { v: 'not-started', l: '' },
                                                                { v: 'in-progress', l: '' },
                                                                { v: 'done', l: '' }
                                                            ].map(opt => (
                                                                <button
                                                                    key={opt.v}
                                                                    onClick={() => handleStatusChange(item.id, t.id, opt.v)}
                                                                    className={`w-6 h-6 flex items-center justify-center rounded transition-all hover:bg-white/10 ${t.status === opt.v ? 'bg-white/10 scale-110' : 'opacity-40 grayscale'}`}
                                                                    title={opt.v.replace('-', ' ')}
                                                                >
                                                                    <span className="text-xs">{opt.l}</span>
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                ))}
                                                {item.topics.length === 0 && (
                                                    <div className="col-span-2 text-center py-4 text-xs text-slate-500 font-mono">NO SUB-MODULES DETECTED</div>
                                                )}
                                            </div>
                                        </motion.div>
                                    )}
                                </AnimatePresence>
                            </div>
                        ))}
                    </div>

                    {/* ADD TOPIC SECTION */}
                    <div className="mt-8 border-t border-white/5 pt-8">
                        <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Extend Knowledge Base</h3>
                        <form onSubmit={handleAddTopic} className="bg-white/5 border border-white/10 rounded-xl p-2 flex flex-col md:flex-row gap-2">
                            <input
                                value={customTopic.subject}
                                onChange={e => setCustomTopic({ ...customTopic, subject: e.target.value })}
                                placeholder="Subject Name"
                                className="bg-transparent px-4 py-2 text-sm text-white outline-none flex-1 placeholder:text-slate-600"
                            />
                            <div className="w-px bg-white/10 hidden md:block"></div>
                            <input
                                value={customTopic.topic}
                                onChange={e => setCustomTopic({ ...customTopic, topic: e.target.value })}
                                placeholder="Sub-topic (Optional)"
                                className="bg-transparent px-4 py-2 text-sm text-white outline-none flex-1 placeholder:text-slate-600"
                            />
                            <button type="submit" className="px-6 py-2 bg-brand-500/20 text-brand-400 border border-brand-500/30 rounded-lg text-xs font-bold uppercase hover:bg-brand-500 hover:text-white transition-all">
                                + Add Module
                            </button>
                        </form>
                    </div>
                    {/* NEW EXAM MODAL */}
                    <AnimatePresence>
                        {showExamModal && (
                            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                                <motion.div
                                    initial={{ scale: 0.9, opacity: 0 }}
                                    animate={{ scale: 1, opacity: 1 }}
                                    exit={{ scale: 0.9, opacity: 0 }}
                                    className="bg-[#0c0c12] border border-white/10 p-6 rounded-2xl w-full max-w-sm shadow-2xl relative"
                                >
                                    <button onClick={() => setShowExamModal(false)} className="absolute top-4 right-4 text-slate-500 hover:text-white"><Icon name="x" size={18} /></button>
                                    <h3 className="text-lg font-bold text-white mb-1">Initialize Protocol</h3>
                                    <p className="text-xs text-slate-500 mb-6">Create a new container for logic modules.</p>
                                    <form onSubmit={handleCreateExam}>
                                        <input
                                            autoFocus
                                            value={newExamName}
                                            onChange={e => setNewExamName(e.target.value)}
                                            className="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-sm text-white mb-4 outline-none focus:border-brand-500 transition-colors placeholder:text-slate-600 font-mono uppercase"
                                            placeholder="PROTOCOL NAME (E.G. UPSC)"
                                        />
                                        <div className="flex justify-end gap-3">
                                            <button
                                                type="button"
                                                onClick={() => setShowExamModal(false)}
                                                className="px-4 py-2 text-slate-400 text-xs font-bold hover:text-white transition-colors"
                                            >
                                                CANCEL
                                            </button>
                                            <button
                                                type="submit"
                                                disabled={!newExamName.trim()}
                                                className="px-6 py-2 bg-brand-600 hover:bg-brand-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-all uppercase text-xs tracking-widest"
                                            >
                                                Create
                                            </button>
                                        </div>
                                    </form>
                                </motion.div>
                            </div>
                        )}
                    </AnimatePresence>
                </div >
            )
        };
        const Kanban = ({ user, update, log }) => {
            const [txt, setTxt] = useState("");
            const [filter, setFilter] = useState("ALL");

            const move = (id, f, t) => { const task = user.kanban[f].find(i => i.id === id); update({ ...user, kanban: { ...user.kanban, [f]: user.kanban[f].filter(i => i.id !== id), [t]: [task, ...user.kanban[t]] } }); if (t === 'done') log(); };
            const add = (e) => { e.preventDefault(); if (!txt) return; update({ ...user, kanban: { ...user.kanban, todo: [{ id: Date.now(), title: txt }, ...user.kanban.todo] } }); setTxt(""); };
            const del = (id, c) => update({ ...user, kanban: { ...user.kanban, [c]: user.kanban[c].filter(i => i.id !== id) } });

            // Helper to render a task card
            const TaskCard = ({ t, category }) => (
                <div key={t.id} className="group flex items-center gap-3 p-4 dark:bg-white/5 bg-white border dark:border-white/10 border-slate-200 rounded-xl hover:border-brand-500/30 transition-all backdrop-blur-sm active:scale-[0.98] light:shadow-sm">
                    {/* Checkbox (Left) */}
                    <button
                        onClick={() => category !== 'done' ? move(t.id, category, 'done') : move(t.id, category, 'todo')}
                        className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all flex-shrink-0 ${category === 'done' ? 'bg-emerald-500 border-emerald-500' : 'dark:border-slate-500 border-slate-300 hover:border-brand-400'}`}
                    >
                        {category === 'done' && <Icon name="check" size={14} className="text-black" />}
                    </button>

                    {/* Text (Middle) */}
                    <div className={`flex-1 text-sm font-medium ${category === 'done' ? 'text-slate-400 line-through' : 'dark:text-slate-200 text-slate-700'}`}>
                        {t.title}
                    </div>

                    {/* Actions / Priority (Right) */}
                    <div className="flex items-center gap-2">
                        <div className={`w-2 h-2 rounded-full ${t.id % 2 === 0 ? 'bg-red-500 shadow-[0_0_5px_rgba(239,68,68,0.5)]' : 'bg-blue-500 shadow-[0_0_5px_rgba(59,130,246,0.5)]'}`}></div>
                        <button onClick={() => del(t.id, category)} className="dark:text-slate-400 text-slate-500 hover:text-red-500 dark:hover:text-red-400 transition-colors p-2 hover:bg-red-500/10 rounded-lg" title="Delete Task">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></svg>
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="h-full relative flex flex-col max-w-2xl mx-auto animate-fade-in">
                    {/* Header with Title & Pills */}
                    <div className="flex flex-col gap-4 mb-4 pt-2">
                        <div className="flex justify-between items-end px-1">
                            <div>
                                <h2 className="text-3xl font-bold dark:text-white text-slate-900 tracking-tight">Task Manager</h2>
                                <p className="dark:text-slate-400 text-slate-500 text-xs font-mono uppercase tracking-widest">{user.kanban.todo.length} PENDING // {user.kanban.doing.length} IN PROGRESS</p>
                            </div>
                        </div>

                        {/* Pills */}
                        <div className="flex gap-2 overflow-x-auto pb-2 custom-scrollbar no-scrollbar">
                            {['ALL', 'WORK', 'DSA', 'PERSONAL'].map(f => (
                                <button
                                    key={f}
                                    onClick={() => setFilter(f)}
                                    className={`px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-wider white-space-nowrap transition-all border ${filter === f ? 'bg-brand-500 text-white border-brand-500 shadow-lg' : 'dark:bg-white/5 bg-white dark:border-white/10 border-slate-200 dark:text-slate-400 text-slate-600 hover:dark:text-white hover:text-slate-900'}`}
                                >
                                    {f}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Task List Container */}
                    <div className="flex-1 overflow-y-auto pb-32 space-y-3 custom-scrollbar px-1">
                        {/* IN PROGRESS */}
                        {user.kanban.doing.length > 0 && (
                            <div className="space-y-2 mb-4">
                                <h3 className="text-xs font-bold text-brand-400 uppercase tracking-widest ml-1 opacity-70">In Focus</h3>
                                {user.kanban.doing.map(t => <TaskCard key={t.id} t={t} category="doing" />)}
                            </div>
                        )}

                        {/* TODO */}
                        <div className="space-y-2">
                            <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1 opacity-70">Backlog</h3>
                            {user.kanban.todo.map(t => <TaskCard key={t.id} t={t} category="todo" />)}
                            {user.kanban.todo.length === 0 && user.kanban.doing.length === 0 && (
                                <div className="text-center py-12 border border-dashed border-white/10 rounded-2xl">
                                    <p className="text-slate-500 text-sm">No active tasks. System idle.</p>
                                </div>
                            )}
                        </div>

                        {/* COMPLETED */}
                        {user.kanban.done.length > 0 && (
                            <div className="space-y-2 mt-8 opacity-60">
                                <h3 className="text-xs font-bold text-emerald-500/70 uppercase tracking-widest ml-1">Completed</h3>
                                {user.kanban.done.map(t => <TaskCard key={t.id} t={t} category="done" />)}
                            </div>
                        )}
                    </div>

                    {/* Floating Input (Glass Bar) */}
                    <div className="absolute bottom-0 left-0 right-0 p-4 pb-6 bg-gradient-to-t dark:from-[#05050a] from-slate-100 via-[#05050a]/90 light:via-slate-100/90 to-transparent z-20">
                        <form onSubmit={add} className="dark:bg-white/10 bg-white backdrop-blur-xl border dark:border-white/10 border-slate-300 p-2 rounded-full flex items-center gap-2 shadow-[0_0_30px_rgba(0,0,0,0.5)] ring-1 dark:ring-white/5 ring-slate-200">
                            <div className="w-8 h-8 rounded-full bg-brand-500/20 text-brand-400 flex items-center justify-center border border-brand-500/30">
                                <Icon name="plus" size={16} />
                            </div>
                            <input
                                value={txt}
                                onChange={e => setTxt(e.target.value)}
                                placeholder="Add new neutral task..."
                                className="flex-1 bg-transparent border-none outline-none dark:text-white text-slate-900 text-sm placeholder:text-slate-500 h-10"
                            />
                            <button
                                type="submit"
                                disabled={!txt}
                                className="px-5 py-2 bg-brand-500 hover:bg-brand-400 text-black font-bold text-xs rounded-full uppercase tracking-wider transition-all disabled:opacity-0 disabled:scale-90 shadow-[0_0_15px_rgba(var(--brand-500),0.4)]"
                            >
                                Add
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Flashcards = ({ user, update, log }) => {
            const { motion, AnimatePresence, useMotionValue, useSpring, useTransform } = window.Motion;
            const [add, setAdd] = useState(false);
            const [nC, setNC] = useState({ f: '', b: '' });

            const today = new Date().toISOString().split('T')[0];
            const due = (user.flashcards || []).filter(c => !c.next || c.next <= today);

            const rate = (d) => {
                const c = due[0];
                let n = new Date();
                n.setDate(n.getDate() + d);
                update({ ...user, flashcards: [...user.flashcards.filter(x => x.id !== c.id), { ...c, next: n.toISOString().split('T')[0] }] });
                if (due.length === 1) log();
            };

            const create = (e) => {
                e.preventDefault();
                update({ ...user, flashcards: [...(user.flashcards || []), { id: Date.now(), f: nC.f, b: nC.b, next: today }] });
                setAdd(false);
                setNC({ f: '', b: '' });
            };

            const NeuralFlashcard = ({ front, back, onRate }) => {
                const x = useMotionValue(0);
                const y = useMotionValue(0);
                const mouseX = useSpring(x, { stiffness: 150, damping: 15 });
                const mouseY = useSpring(y, { stiffness: 150, damping: 15 });
                const [isFlipped, setIsFlipped] = useState(false);

                function handleMouseMove({ currentTarget, clientX, clientY }) {
                    const { left, top, width, height } = currentTarget.getBoundingClientRect();
                    x.set(clientX - left - width / 2);
                    y.set(clientY - top - height / 2);
                }

                function handleMouseLeave() {
                    x.set(0);
                    y.set(0);
                }

                return (
                    <motion.div
                        onMouseMove={handleMouseMove}
                        onMouseLeave={handleMouseLeave}
                        style={{
                            rotateX: useTransform(mouseY, [-100, 100], [10, -10]),
                            rotateY: useTransform(mouseX, [-100, 100], [-10, 10]),
                            transformStyle: "preserve-3d",
                        }}
                        className="w-full h-96 cursor-pointer relative perspective-1000"
                        onClick={() => setIsFlipped(!isFlipped)}
                    >
                        <motion.div
                            animate={{ rotateY: isFlipped ? 180 : 0 }}
                            transition={{ duration: 0.6 }}
                            style={{ transformStyle: "preserve-3d" }}
                            className="w-full h-full relative"
                        >
                            <div className="absolute inset-0 backface-hidden holo-card rounded-3xl flex flex-col items-center justify-center p-12 text-center border-t border-white/20 bg-[#05050a]" style={{ backfaceVisibility: 'hidden' }}>
                                <div className="text-xs font-mono text-slate-500 uppercase tracking-widest mb-6">Question</div>
                                <div className="text-3xl font-bold text-white">{front}</div>
                                <div className="absolute bottom-6 text-brand-400 text-xs animate-pulse">Click to Reveal</div>
                            </div>

                            <div className="absolute inset-0 backface-hidden holo-card rounded-3xl flex flex-col items-center justify-center p-12 text-center bg-brand-900/20 border-brand-500/30"
                                style={{ backfaceVisibility: 'hidden', transform: 'rotateY(180deg)' }}>
                                <div className="text-xs font-mono text-brand-400 uppercase tracking-widest mb-6">Answer</div>
                                <div className="text-2xl font-medium text-white mb-10">{back}</div>
                                <div className="absolute bottom-6 w-full px-8 pb-4" onClick={e => e.stopPropagation()}>
                                    <div className="flex gap-4 justify-center mb-3">
                                        <button onClick={() => onRate(1)} className="px-6 py-2 rounded-lg bg-red-500/20 text-red-300 border border-red-500/30 hover:bg-red-500 hover:text-white font-bold text-xs uppercase transition-colors">
                                            Again (1d)
                                        </button>
                                        <button onClick={() => onRate(3)} className="px-6 py-2 rounded-lg bg-emerald-500/20 text-emerald-300 border border-emerald-500/30 hover:bg-emerald-500 hover:text-white font-bold text-xs uppercase transition-colors">
                                            Good (3d)
                                        </button>
                                    </div>
                                    <p className="text-[10px] text-slate-500 uppercase tracking-wider font-mono opacity-80">
                                        Spaced Repetition: Scheduling next review.
                                    </p>
                                </div>
                            </div>
                        </motion.div>
                    </motion.div>
                );
            };

            return (
                <div className="max-w-2xl mx-auto space-y-8 animate-fade-in">
                    <div className="flex justify-between items-center"><h2 className="text-3xl font-bold text-white">Neural Recall</h2><Button onClick={() => setAdd(!add)} icon="plus">Create</Button></div>
                    {add && <Card className="border-brand-500/30"><form onSubmit={create} className="space-y-4"><input value={nC.f} onChange={e => setNC({ ...nC, f: e.target.value })} placeholder="Front (Question)" className="w-full bg-black/50 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-brand-500" /><input value={nC.b} onChange={e => setNC({ ...nC, b: e.target.value })} placeholder="Back (Answer)" className="w-full bg-black/50 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-brand-500" /><Button type="submit" className="w-full">Save to Deck</Button></form></Card>}
                    {due.length > 0 ? (
                        <NeuralFlashcard key={due[0].id} front={due[0].f} back={due[0].b} onRate={rate} />
                    ) : (
                        <div className="text-center py-20 holo-card rounded-3xl border-dashed border-slate-700"><div className="w-16 h-16 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-400"><Icon name="check" size={32} /></div><h3 className="text-xl font-bold text-white">Review Complete</h3><p className="text-slate-400 mt-2">Neural pathways reinforced.</p></div>
                    )}
                </div>
            )
        };


























        /* --- DATA & CONTENT --- */
        const DSA_MASTER_DATA = [
            {
                id: "arrays",
                label: "Arrays & RAM",
                position: { x: 150, y: 100 },
                status: "unlocked",
                learningContent: {
                    title: "Arrays & Memory Architecture",
                    summary: "The fundamental building block of data storage. Elements stored in contiguous memory.",
                    deepDive: `### Internal Memory Layout
        When you declare \`int arr[5]\`, the OS allocates a *continuous* block of memory. 
        If the base address is 1000 and integer size is 4 bytes, the elements are at:
        - \`arr[0]\`: 1000
        - \`arr[1]\`: 1004
        - \`arr[2]\`: 1008
        ...
        This allows the CPU to fetch data using the formula: 
        > \`Address = Base + (Index * Size)\`
        
        **Why is this important?**
        1. **O(1) Random Access:** No iteration needed.
        2. **Spatial Locality:** CPU caches load chunks of memory. Arrays are cache-friendly.`,
                    complexityAnalysis: {
                        access: "O(1) - The fastest possible look-up.",
                        search: "O(n) - Must scan one by one (if unsorted).",
                        insertion: "O(n) - Must shift subsequent elements.",
                        deletion: "O(n) - Must shift to fill the gap.",
                        space: "O(n) - Strictly linear."
                    },
                    realWorldApplications: [
                        "Basis for Hash Tables (Buckets).",
                        "Image Buffers (Pixels stored linearly).",
                        "Matrix Operations in Machine Learning."
                    ],
                    pitfalls: [
                        "Index Out Of Bounds (#1 Error).",
                        "Memory Fragmentation (Large arrays need contiguous blocks).",
                        "Fixed size limits (in low-level languages)."
                    ],
                    codeSnippets: {
                        python: `# Dynamic Array (List)
        import sys
        arr = [1, 2, 3]
        # Python lists store POINTERS to objects, not raw values.
        # This adds overhead but allows mixed types.`,
                        java: `// Static Array
        int[] arr = new int[5]; // Fast, stack-allocated references.
        
        // Dynamic Array
        ArrayList<Integer> list = new ArrayList<>(); // Resizes by 1.5x`,
                        cpp: `// Raw Array
        int arr[5]; 
        
        // Vector (Dynamic)
        std::vector<int> v; 
        // Uses doubling strategy when capacity is reached.`
                    }
                },
                questions: [
                    { id: "arr_1", title: "Two Sum", link: "https://leetcode.com/problems/two-sum/", difficulty: "Easy", xp: 10 },
                    { id: "arr_2", title: "Best Time to Buy and Sell Stock", link: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", difficulty: "Easy", xp: 10 },
                    { id: "arr_3", title: "Contains Duplicate", link: "https://leetcode.com/problems/contains-duplicate/", difficulty: "Easy", xp: 10 },
                    { id: "arr_4", title: "Product of Array Except Self", link: "https://leetcode.com/problems/product-of-array-except-self/", difficulty: "Medium", xp: 20 },
                    { id: "arr_5", title: "Maximum Subarray", link: "https://leetcode.com/problems/maximum-subarray/", difficulty: "Medium", xp: 20 },
                    { id: "arr_6", title: "Maximum Product Subarray", link: "https://leetcode.com/problems/maximum-product-subarray/", difficulty: "Medium", xp: 20 },
                    { id: "arr_7", title: "Find Minimum in Rotated Sorted Array", link: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                    { id: "arr_8", title: "Search in Rotated Sorted Array", link: "https://leetcode.com/problems/search-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                    { id: "arr_9", title: "3Sum", link: "https://leetcode.com/problems/3sum/", difficulty: "Medium", xp: 20 },
                    { id: "arr_10", title: "Container With Most Water", link: "https://leetcode.com/problems/container-with-most-water/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "linkedlist",
                label: "Linked Lists",
                position: { x: 300, y: 300 },
                dependencies: ["arrays"],
                status: "unlocked",
                learningContent: {
                    title: "Linked Lists & Pointers",
                    summary: "Nodes scattered in memory, connected by references (pointers). Dynamic and flexible.",
                    deepDive: `### The Pointer Chain
        Unlike arrays, Linked Lists do strictly **NOT** require contiguous memory. Each node contains:
        1. \`Data\`: The value.
        2. \`Next\`: Address of the next node.
        
        **Visualizing structure:**
        \`[Head: 1000] -> [Data: 5 | Next: 5020] -> [Data: 8 | Next: 200] -> NULL\`
        
        **Why use them?**
        - **Dynamic Size:** No pre-allocation needed.
        - **Efficient Insertions:** \`O(1)\` if you have the pointer (no shifting).`,
                    complexityAnalysis: {
                        access: "O(n) - Must traverse from Head.",
                        search: "O(n) - Linearly follow pointers.",
                        insertion: "O(1) - Just rewire pointers (at head/known location).",
                        deletion: "O(1) - Rewire pointers.",
                        space: "O(n) - Extra memory for pointers."
                    },
                    realWorldApplications: [
                        "Browser History (Back/Forward).",
                        "Undo/Redo Functionality (Stacks).",
                        "Blockchains (Hash Pointers link blocks)."
                    ],
                    pitfalls: [
                        "Losing the Head reference (Memory Leak).",
                        "Null Pointer Exceptions (Segfaults).",
                        "Poor Cache Locality (Scanning is slow)."
                    ],
                    codeSnippets: {
                        python: `class ListNode:
            def __init__(self, val=0, next=None):
                self.val = val
                self.next = next
        
        head = ListNode(1)
        head.next = ListNode(2)`,
                        java: `class Node {
            int data;
            Node next;
        }
        // Java's Garbage Collector handles deleted nodes automatically.`,
                        cpp: `struct Node {
            int data;
            Node* next;
        };
        // Manual memory management required (delete node).`
                    }
                },
                questions: [
                    { id: "ll_1", title: "Reverse Linked List", link: "https://leetcode.com/problems/reverse-linked-list/", difficulty: "Easy", xp: 10 },
                    { id: "ll_2", title: "Merge Two Sorted Lists", link: "https://leetcode.com/problems/merge-two-sorted-lists/", difficulty: "Easy", xp: 10 },
                    { id: "ll_3", title: "Reorder List", link: "https://leetcode.com/problems/reorder-list/", difficulty: "Medium", xp: 20 },
                    { id: "ll_4", title: "Remove Nth Node From End of List", link: "https://leetcode.com/problems/remove-nth-node-from-end-of-list/", difficulty: "Medium", xp: 20 },
                    { id: "ll_5", title: "Copy List with Random Pointer", link: "https://leetcode.com/problems/copy-list-with-random-pointer/", difficulty: "Medium", xp: 20 },
                    { id: "ll_6", title: "Add Two Numbers", link: "https://leetcode.com/problems/add-two-numbers/", difficulty: "Medium", xp: 20 },
                    { id: "ll_7", title: "Linked List Cycle", link: "https://leetcode.com/problems/linked-list-cycle/", difficulty: "Easy", xp: 10 },
                    { id: "ll_8", title: "Find the Duplicate Number", link: "https://leetcode.com/problems/find-the-duplicate-number/", difficulty: "Medium", xp: 20 },
                    { id: "ll_9", title: "LRU Cache", link: "https://leetcode.com/problems/lru-cache/", difficulty: "Medium", xp: 20 },
                    { id: "ll_10", title: "Merge K Sorted Lists", link: "https://leetcode.com/problems/merge-k-sorted-lists/", difficulty: "Hard", xp: 50 }
                ]
            },
            {
                id: "recursion",
                label: "Recursion",
                position: { x: 450, y: 100 },
                status: "unlocked",
                learningContent: {
                    title: "Recursion & The Stack",
                    summary: "Solving problems by breaking them into smaller, self-similar sub-problems.",
                    deepDive: `### The Call Stack Visualization
        Every recursive call pushes a new **Stack Frame** onto memory.
        Frame contains:
            - Local variables
            - Return address
            - Parameters
        
        **Example: Factorial(3)**
        1. \`fact(3)\` -> pushes to stack. Calls \`fact(2)\`.
        2. \`fact(2)\` -> pushes. Calls \`fact(1)\`.
        3. \`fact(1)\` -> Base case! Returns 1.
        4. \`fact(2)\` resumes. Returns 2 * 1.
        5. \`fact(3)\` resumes. Returns 3 * 2.
        
        **Key Rule:**
        Always define a **Base Case** to stop the recursion, otherwise: \`StackOverflowError\`.`,
                    complexityAnalysis: {
                        access: "N/A - It's a method.",
                        search: "O(n) - Depth of recursion tree.",
                        insertion: "N/A",
                        deletion: "N/A",
                        space: "O(h) - Height of the recursion tree (Stack depth)."
                    },
                    realWorldApplications: [
                        "DOM Tree Traversal (HTML Parsing).",
                        "JSON Serialization/Deserialization.",
                        "Divide & Conquer Algorithms (Merge Sort, Quick Sort)."
                    ],
                    pitfalls: [
                        "Stack Overflow (Infinite Recursion).",
                        "Re-calculating same states (Fix with Memoization/DP).",
                        "High memory overhead compared to Iteration."
                    ],
                    codeSnippets: {
                        python: `def factorial(n):
            if n <= 1: return 1 # Base Case
            return n * factorial(n-1) # Recursive Case`,
                        java: `public int fib(int n) {
            if (n <= 1) return n;
            return fib(n-1) + fib(n-2);
        }`,
                        cpp: `int dfs(Node* root) {
            if (!root) return 0;
            return 1 + max(dfs(root->left), dfs(root->right));
        }`
                    }
                },
                questions: [
                    { id: "rec_1", title: "Climbing Stairs", link: "https://leetcode.com/problems/climbing-stairs/", difficulty: "Easy", xp: 10 },
                    { id: "rec_2", title: "Fibonacci Number", link: "https://leetcode.com/problems/fibonacci-number/", difficulty: "Easy", xp: 10 },
                    { id: "rec_3", title: "Reverse String", link: "https://leetcode.com/problems/reverse-string/", difficulty: "Easy", xp: 10 },
                    { id: "rec_4", title: "Power of Two", link: "https://leetcode.com/problems/power-of-two/", difficulty: "Easy", xp: 10 },
                    { id: "rec_5", title: "Power of Three", link: "https://leetcode.com/problems/power-of-three/", difficulty: "Easy", xp: 10 },
                    { id: "rec_6", title: "Power of Four", link: "https://leetcode.com/problems/power-of-four/", difficulty: "Easy", xp: 10 },
                    { id: "rec_7", title: "Merge Two Sorted Lists", link: "https://leetcode.com/problems/merge-two-sorted-lists/", difficulty: "Easy", xp: 10 },
                    { id: "rec_8", title: "Swap Nodes in Pairs", link: "https://leetcode.com/problems/swap-nodes-in-pairs/", difficulty: "Medium", xp: 20 },
                    { id: "rec_9", title: "Pascals Triangle", link: "https://leetcode.com/problems/pascals-triangle/", difficulty: "Easy", xp: 10 },
                    { id: "rec_10", title: "Pow(x, n)", link: "https://leetcode.com/problems/powx-n/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "strings",
                label: "String Ops",
                status: "unlocked",
                learningContent: {
                    title: "Strings & Manipulation",
                    summary: "Strings are sequences of characters. Mastering them requires understanding immutability and memory/ASCII layouts.",
                    deepDive: `### String Internals
In many languages (Java, Python, C#), strings are **Immutable**. 
This means simplifying iterating \`s += 'a'\` creates a NEW string every time, leading to \`O(n^2)\` complexity.

**Key Techniques:**
1. **Two Pointers:** Process from both ends (Palindromes).
2. **Sliding Window:** Find substrings satisfying conditions.
3. **Hashing:** Count characters (Anagrams).

**StringBuilder / StringBuffer:**
Always use a mutable buffer for building strings in loops to keep operations \`O(n)\`.`,
                    complexityAnalysis: {
                        access: "O(1) - Index access.",
                        search: "O(n) - Scan for character.",
                        concatenation: "O(n) - Copying characters (if immutable).",
                        space: "O(n) - Storage."
                    },
                    realWorldApplications: [
                        "Text Processing & Editors.",
                        "URL Handling & Routing.",
                        "Bioinformatics (DNA Sequences)."
                    ],
                    pitfalls: [
                        "String Concatenation in Loops (Performance killer).",
                        "Ignoring Unicode/Multi-byte characters.",
                        "Off-by-one errors in substrings."
                    ],
                    codeSnippets: {
                        python: `# Checking Palindrome efficiently
def isPalindrome(s):
    l, r = 0, len(s) - 1
    while l < r:
        if s[l] != s[r]: return False
        l += 1; r -= 1
    return True`,
                        java: `// Efficient concatenation
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 100; i++) {
    sb.append(i);
}
String res = sb.toString();`,
                        cpp: `// std::string is mutable
string s = "Hello";
s += " World"; // Efficient append
sort(s.begin(), s.end());`
                    }
                },
                questions: [
                    { id: "str_1", title: "Valid Palindrome", link: "https://leetcode.com/problems/valid-palindrome/", difficulty: "Easy", xp: 10 },
                    { id: "str_2", title: "Valid Anagram", link: "https://leetcode.com/problems/valid-anagram/", difficulty: "Easy", xp: 10 },
                    { id: "str_3", title: "Longest Substring Without Repeating Characters", link: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", difficulty: "Medium", xp: 20 },
                    { id: "str_4", title: "Longest Repeating Character Replacement", link: "https://leetcode.com/problems/longest-repeating-character-replacement/", difficulty: "Medium", xp: 20 },
                    { id: "str_5", title: "Group Anagrams", link: "https://leetcode.com/problems/group-anagrams/", difficulty: "Medium", xp: 20 },
                    { id: "str_6", title: "Valid Parentheses", link: "https://leetcode.com/problems/valid-parentheses/", difficulty: "Easy", xp: 10 },
                    { id: "str_7", title: "Longest Palindromic Substring", link: "https://leetcode.com/problems/longest-palindromic-substring/", difficulty: "Medium", xp: 20 },
                    { id: "str_8", title: "Palindromic Substrings", link: "https://leetcode.com/problems/palindromic-substrings/", difficulty: "Medium", xp: 20 },
                    { id: "str_9", title: "Encode and Decode Strings", link: "https://leetcode.com/problems/encode-and-decode-strings/", difficulty: "Medium", xp: 20 },
                    { id: "str_10", title: "Minimum Window Substring", link: "https://leetcode.com/problems/minimum-window-substring/", difficulty: "Hard", xp: 50 }
                ]
            },
            {
                id: "trees",
                label: "Trees & BST",
                status: "unlocked",
                learningContent: {
                    title: "Binary Trees & BSTs",
                    summary: "Hierarchical structures ideal for sorting and searching. Recursive by nature.",
                    deepDive: `### Tree Anatomy
- **Root:** The top node.
- **Leaf:** Node with no children.
- **Height:** Max depth from root to leaf.

**Binary Search Tree (BST):**
Left child < Parent < Right child.
This property enables \`O(log n)\` search, similar to Binary Search on arrays, but with dynamic structure.

**Traversals:**
1. **In-Order:** Left -> Root -> Right (Sorted order in BST).
2. **Pre-Order:** Root -> Left -> Right (Cloning).
3. **Post-Order:** Left -> Right -> Root (Deletion/Math eval).`,
                    complexityAnalysis: {
                        access: "O(log n) - Balanced BST.",
                        search: "O(log n) - Balanced BST.",
                        insertion: "O(log n) - Balanced BST.",
                        deletion: "O(log n) - Balanced BST."
                    },
                    realWorldApplications: [
                        "File Systems (Folders/Files).",
                        "Database Indexing (B-Trees).",
                        "HTML DOM Structure."
                    ],
                    pitfalls: [
                        "Unbalanced Trees (Degenerate to Linked List O(n)).",
                        "Recursion Depth causing Stack Overflow.",
                        "Modifying a BST while iterating."
                    ],
                    codeSnippets: {
                        python: `# Definition for a binary tree node.
class TreeNode:
    def __init__(self, val=0, left=None, right=None):
        self.val = val
        self.left = left
        self.right = right`,
                        java: `// In-order Traversal
void printInOrder(Node node) {
    if (node == null) return;
    printInOrder(node.left);
    System.out.print(node.val + " ");
    printInOrder(node.right);
}`,
                        cpp: `// BST Insert
Node* insert(Node* node, int data) {
    if (!node) return new Node(data);
    if (data < node->data) node->left = insert(node->left, data);
    else if (data > node->data) node->right = insert(node->right, data);
    return node;
}`
                    }
                },
                questions: [
                    { id: "tr_1", title: "Invert Binary Tree", link: "https://leetcode.com/problems/invert-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_2", title: "Maximum Depth of Binary Tree", link: "https://leetcode.com/problems/maximum-depth-of-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_3", title: "Diameter of Binary Tree", link: "https://leetcode.com/problems/diameter-of-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_4", title: "Balanced Binary Tree", link: "https://leetcode.com/problems/balanced-binary-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_5", title: "Same Tree", link: "https://leetcode.com/problems/same-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_6", title: "Subtree of Another Tree", link: "https://leetcode.com/problems/subtree-of-another-tree/", difficulty: "Easy", xp: 10 },
                    { id: "tr_7", title: "Lowest Common Ancestor of a BST", link: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-search-tree/", difficulty: "Medium", xp: 20 },
                    { id: "tr_8", title: "Binary Tree Level Order Traversal", link: "https://leetcode.com/problems/binary-tree-level-order-traversal/", difficulty: "Medium", xp: 20 },
                    { id: "tr_9", title: "Validate Binary Search Tree", link: "https://leetcode.com/problems/validate-binary-search-tree/", difficulty: "Medium", xp: 20 },
                    { id: "tr_10", title: "Kth Smallest Element in a BST", link: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "graphs",
                label: "Graphs",
                status: "unlocked",
                position: { x: 450, y: 500 },
                dependencies: ["trees"],
                learningContent: {
                    title: "Graph Theory & Topology",
                    summary: "Networks of nodes and edges. Modeling complex relationships like social networks and maps.",
                    deepDive: `### Graph Representations
1. **Adjacency Matrix:** 2D array. Fast lookups \`O(1)\`, high space \`O(V^2)\`.
2. **Adjacency List:** Array of Lists. Space efficient \`O(V+E)\`.

**Core Algorithms:**
- **BFS (Breadth-First Search):** Shortest path in unweighted graphs. Uses a **Queue**.
- **DFS (Depth-First Search):** Exploring paths, cycles, mazes. Uses a **Stack** (or Recursion).

**Directed vs Undirected:**
If \`A -> B\`, can you go back? Directed = One way streets.`,
                    complexityAnalysis: {
                        access: "O(1) - Matrix, O(degree) - List.",
                        search: "O(V+E) - BFS/DFS.",
                        insertion: "O(1) - Adding edge.",
                        deletion: "O(V+E) - Removing node."
                    },
                    realWorldApplications: [
                        "Social Networks (Friends of Friends).",
                        "GPS Navigation (Shortest Path).",
                        "Dependency Resolution (npm install)."
                    ],
                    pitfalls: [
                        "Infinite loops in Cyclic Graphs (Use 'visited' set).",
                        "Disconnected components (Graph might not be fully reachable).",
                        "Selecting wrong representation (Matrix for sparse graph)."
                    ],
                    codeSnippets: {
                        python: `# BFS Implementation
def bfs(graph, start):
    visited = set()
    queue = [start]
    while queue:
        vertex = queue.pop(0)
        if vertex not in visited:
            visited.add(vertex)
            queue.extend(set(graph[vertex]) - visited)`,
                        java: `// Graph Node
class Graph {
    private int V;
    private LinkedList<Integer> adj[];
    // ...
}`,
                        cpp: `// Adjacency List
vector<vector<int>> adj;
// Add Edge
void addEdge(int u, int v) {
    adj[u].push_back(v);
}`
                    }
                },
                questions: [
                    { id: "gr_1", title: "Number of Islands", link: "https://leetcode.com/problems/number-of-islands/", difficulty: "Medium", xp: 20 },
                    { id: "gr_2", title: "Clone Graph", link: "https://leetcode.com/problems/clone-graph/", difficulty: "Medium", xp: 20 },
                    { id: "gr_4", title: "Pacific Atlantic Water Flow", link: "https://leetcode.com/problems/pacific-atlantic-water-flow/", difficulty: "Medium", xp: 20 },
                    { id: "gr_8", title: "Course Schedule", link: "https://leetcode.com/problems/course-schedule/", difficulty: "Medium", xp: 20 },
                    { id: "gr_10", title: "Graph Valid Tree", link: "https://leetcode.com/problems/graph-valid-tree/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "dp",
                label: "Dynamic Programming",
                status: "locked",
                position: { x: 300, y: 700 },
                dependencies: ["recursion", "trees"],
                learningContent: {
                    title: "Dynamic Programming: The Art of Storing State",
                    summary: "Optimization over plain recursion. Trading space for time by caching subproblem results.",
                    deepDive: `### The DP Framework
DP is just **Recursion + Memoization** (Top-Down) or **Iteration + Tabulation** (Bottom-Up).

**The 3 Components of every DP Problem:**
1. **State:** What variables uniquely identify a subproblem? (e.g. \`dp[index][remaining_capacity]\`)
2. **Transition:** How do you get to the current state from previous ones? (\`dp[i] = dp[i-1] + dp[i-2]\`)
3. **Base Case:** Where does the calculation begin? (\`dp[0] = 1\`)

**When to use DP?**
- **Overlapping Subproblems:** You solve the same thing multiple times.
- **Optimal Substructure:** The global best can be built from local bests.`,
                    complexityAnalysis: {
                        search: "O(n*m) - Typically product of state dimensions.",
                        space: "O(n*m) - For table (can often be optimized to O(n))."
                    },
                    realWorldApplications: [
                        "Diff algorithms (Git).",
                        "DNA Sequence Alignment.",
                        "Resource Allocation (Knapsack Problem)."
                    ],
                    pitfalls: [
                        "Incorrect State definition.",
                        "Memory limits (Stack overflow in recursion or large 2D tables).",
                        "Thinking everything is DP (Greedy might be faster)."
                    ],
                    codeSnippets: {
                        python: `# 0/1 Knapsack (Classic)
def knapsack(weights, values, W):
    dp = [0] * (W + 1)
    for i in range(len(weights)):
        for w in range(W, weights[i] - 1, -1):
            dp[w] = max(dp[w], dp[w - weights[i]] + values[i])
    return dp[W]`,
                        cpp: `// Bottom-up LIS
int lengthOfLIS(vector<int>& nums) {
    vector<int> dp(nums.size(), 1);
    for (int i = 0; i < nums.size(); ++i) {
        for (int j = 0; j < i; ++j) {
            if (nums[i] > nums[j]) dp[i] = max(dp[i], dp[j] + 1);
        }
    }
    return *max_element(dp.begin(), dp.end());
}`
                    }
                },
                questions: [
                    { id: "dp_1", title: "Climbing Stairs", link: "https://leetcode.com/problems/climbing-stairs/", difficulty: "Easy", xp: 10 },
                    { id: "dp_3", title: "House Robber", link: "https://leetcode.com/problems/house-robber/", difficulty: "Medium", xp: 20 },
                    { id: "dp_8", title: "Coin Change", link: "https://leetcode.com/problems/coin-change/", difficulty: "Medium", xp: 20 },
                    { id: "dp_11", title: "Longest Increasing Subsequence", link: "https://leetcode.com/problems/longest-increasing-subsequence/", difficulty: "Medium", xp: 20 },
                    { id: "dp_12", title: "Edit Distance", link: "https://leetcode.com/problems/edit-distance/", difficulty: "Hard", xp: 50 }
                ]
            },
            {
                id: "bit-manip",
                label: "Bit Alchemy",
                status: "unlocked",
                position: { x: 300, y: -50 },
                learningContent: {
                    title: "Bit Manipulation & Low-Level Wizardry",
                    summary: "Operating directly on binary digits. The ultimate optimization for space and speed.",
                    deepDive: `### Truth Tables & Operators
- **AND (&):** \`1 & 1 = 1\`, else \`0\`. (Masking)
- **OR (|):** \`0 | 0 = 0\`, else \`1\`. (Merging)
- **XOR (^):** \`1 ^ 0 = 1, 0 ^ 1 = 1\`. (The Magic Operator: \`a ^ a = 0\`)
- **NOT (~):** Flip all bits.

**Key Hacks:**
1. **Check Power of 2:** \`n & (n-1) == 0\`
2. **Clear k-th bit:** \`n & ~(1 << k)\`
3. **Get rightmost set bit:** \`n & -n\``,
                    complexityAnalysis: {
                        operation: "O(1) - Constant time on CPU.",
                        space: "O(1) - Minimal storage."
                    },
                    realWorldApplications: [
                        "Cryptography (XOR ciphers).",
                        "Compression (Huffman coding).",
                        "Embedded Systems memory mapping."
                    ],
                    pitfalls: [
                        "Signed vs Unsigned shifts (Language dependent).",
                        "Operator precedence (\`n & 1 == 0\` is WRONG, use \`(n & 1) == 0\`).",
                        "Overflow errors."
                    ],
                    codeSnippets: {
                        python: `# Count set bits (Hamming Weight)
def countBits(n):
    count = 0
    while n:
        n &= (n - 1)
        count += 1
    return count`,
                        cpp: `#include <iostream>
// Swap without temporary
void swap(int &a, int &b) {
    a ^= b;
    b ^= a;
    a ^= b;
}`
                    }
                },
                questions: [
                    { id: "bit_1", title: "Number of 1 Bits", link: "https://leetcode.com/problems/number-of-1-bits/", difficulty: "Easy", xp: 10 },
                    { id: "bit_2", title: "Counting Bits", link: "https://leetcode.com/problems/counting-bits/", difficulty: "Easy", xp: 10 },
                    { id: "bit_3", title: "Reverse Bits", link: "https://leetcode.com/problems/reverse-bits/", difficulty: "Easy", xp: 10 },
                    { id: "bit_4", title: "Missing Number", link: "https://leetcode.com/problems/missing-number/", difficulty: "Easy", xp: 10 },
                    { id: "bit_5", title: "Sum of Two Integers", link: "https://leetcode.com/problems/sum-of-two-integers/", difficulty: "Medium", xp: 20 }
                ]
            },
            {
                id: "backtracking",
                label: "Backtracking",
                status: "locked",
                position: { x: 600, y: 300 },
                dependencies: ["recursion"],
                learningContent: {
                    title: "Backtracking: The Systematic Search",
                    summary: "Exploring all possibilities and cutting off dead-ends. The foundation of AI and game solvers.",
                    deepDive: `### The Backtracking Template
Backtracking is depth-first search on a **Decision Space**.

\`\`\`python
def backtrack(state):
    if is_goal(state):
        return True
    for choice in possible_choices:
        if is_valid(choice):
            make_choice(choice)
            if backtrack(state): 
                return True
            undo_choice(choice) # THE CORE STEP
    return False
\`\`\`

**Key concepts:**
- **State Space Tree:** Visualizing choices.
- **Pruning:** Abandoning a path early if it can't lead to a solution (e.g. Sudoku).`,
                    complexityAnalysis: {
                        search: "O(k^n) - Often exponential.",
                        space: "O(n) - Stack depth."
                    },
                    realWorldApplications: [
                        "Crossword/Sudoku solvers.",
                        "Regex engines.",
                        "Shortest path in robot navigation."
                    ],
                    pitfalls: [
                        "Forgetting to 'Undo' the choice (Corrupting state).",
                        "Inefficient Pruning.",
                        "Creating copies of state in every call (Memory hog)."
                    ],
                    codeSnippets: {
                        python: `# Subsets problem
def subsets(nums):
    res = []
    def dfs(i, cur):
        if i == len(nums):
            res.append(cur[:])
            return
        cur.append(nums[i])
        dfs(i + 1, cur)
        cur.pop()
        dfs(i + 1, cur)
    dfs(0, [])
    return res`
                    }
                },
                questions: [
                    { id: "bt_1", title: "Subsets", link: "https://leetcode.com/problems/subsets/", difficulty: "Medium", xp: 20 },
                    { id: "bt_2", title: "Combination Sum", link: "https://leetcode.com/problems/combination-sum/", difficulty: "Medium", xp: 20 },
                    { id: "bt_3", title: "Permutations", link: "https://leetcode.com/problems/permutations/", difficulty: "Medium", xp: 20 },
                    { id: "bt_4", title: "Word Search", link: "https://leetcode.com/problems/word-search/", difficulty: "Medium", xp: 20 },
                    { id: "bt_5", title: "N-Queens", link: "https://leetcode.com/problems/n-queens/", difficulty: "Hard", xp: 50 }
                ]
            }
        ];

        /* --- TOPIC DEEP DIVE COMPONENT (SLIDE-OVER) --- */
        const TopicDeepDive = ({ node, onClose, completedQuestions = [], toggleQuestion }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [activeSection, setActiveSection] = useState('theory');

            // Legacy Data Adapter
            const content = useMemo(() => {
                if (!node?.learningContent) return null;
                if (node.learningContent.deepDive) return node.learningContent;
                // Adapter
                return {
                    title: node.learningContent.title || node.label,
                    summary: node.learningContent.definition,
                    deepDive: `### Key Concepts\n${node.learningContent.keyConcepts?.map(c => `- ${c}`).join('\n') || ''}\n\n### Explanation\n${node.learningContent.explanation}`,
                    complexityAnalysis: { Note: "Detailed analysis coming in v2 update." },
                    realWorldApplications: ["General Computing"],
                    pitfalls: ["Standard programming pitfalls."],
                    codeSnippets: {} // Empty to hide section
                };
            }, [node]);

            const sections = [
                { id: 'theory', label: 'Theory' },
                { id: 'complexity', label: 'Complexity' },
                { id: 'code', label: 'Polyglot Code' },
                { id: 'pitfalls', label: 'Pitfalls' },
                { id: 'practice', label: 'Practice Deck' }
            ].filter(s => {
                if (!content) return false;
                if (s.id === 'code' && (!content.codeSnippets || Object.keys(content.codeSnippets).length === 0)) return false;
                return true;
            });

            // Markdown Parser
            const renderMarkdown = (text) => {
                if (!text) return { __html: '' };
                return { __html: window.marked ? window.marked.parse(text) : text };
            };

            // Syntax Highlight Trigger
            useEffect(() => {
                if (window.Prism) window.Prism.highlightAll();
            }, [activeSection, node, content]);

            // ESCAPE KEY LISTENER
            useEffect(() => {
                const handleEsc = (e) => {
                    if (e.key === 'Escape') onClose();
                };
                window.addEventListener('keydown', handleEsc);
                return () => window.removeEventListener('keydown', handleEsc);
            }, [onClose]);

            if (!content) return null;

            const scrollTo = (id) => {
                setActiveSection(id);
                document.getElementById(`sec-${id}`)?.scrollIntoView({ behavior: 'smooth' });
            };

            return (
                <motion.div
                    initial={{ opacity: 0, scale: 0.98 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.98 }}
                    transition={{ duration: 0.2 }}
                    className="fixed inset-0 z-[100] bg-[#05050a] flex flex-col overflow-hidden"
                    onClick={(e) => { if (e.target === e.currentTarget) onClose(); }}
                >
                    {/* Header */}
                    <div className="w-full border-b border-white/5 bg-[#05050a]/90 backdrop-blur-md z-10 shrink-0">
                        <div className="max-w-screen-2xl mx-auto h-20 flex items-center justify-between px-6 lg:px-8">
                            <div className="flex items-center gap-4">
                                <div className="w-10 h-10 rounded-lg bg-brand-500/20 text-brand-400 flex items-center justify-center font-bold border border-brand-500/30">
                                    <Icon name="book-open" size={20} />
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-white tracking-tight">{content.title}</h2>
                                    <p className="text-xs text-slate-500 font-mono uppercase tracking-widest">{node.label} MODULE</p>
                                </div>
                            </div>
                            <button
                                onClick={onClose}
                                className="group flex items-center gap-2 px-4 py-2 rounded-full bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 hover:border-red-500/50 transition-all"
                            >
                                <span className="text-xs font-bold text-red-400 group-hover:text-red-300 uppercase tracking-widest hidden sm:inline-block">Close Protocol</span>
                                <div className="w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center text-red-400 group-hover:text-white">
                                    <Icon name="x" size={16} />
                                </div>
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 overflow-hidden w-full max-w-screen-2xl mx-auto flex relative">
                        {/* Content Area */}
                        <div className="flex-1 overflow-y-auto custom-scrollbar p-6 md:p-12 pb-32 space-y-16 scroll-smooth">
                            {/* 1. Theory */}
                            <section id="sec-theory" className="space-y-6">
                                <div className="flex items-center gap-3 text-brand-400 border-b border-brand-500/20 pb-2 mb-6">
                                    <Icon name="book" size={20} />
                                    <h3 className="text-sm font-bold uppercase tracking-widest">Deep Theory</h3>
                                </div>
                                <p className="text-lg text-slate-300 leading-relaxed font-light">{content.summary}</p>
                                <div className="prose prose-invert prose-lg prose-p:text-slate-300 prose-headings:text-white prose-strong:text-brand-400 prose-pre:bg-[#0a0a0f] prose-pre:border prose-pre:border-white/10 prose-pre:max-w-full max-w-none break-words">
                                    <div dangerouslySetInnerHTML={renderMarkdown(content.deepDive)} />
                                </div>
                            </section>

                            {/* 2. Complexity */}
                            <section id="sec-complexity" className="space-y-6">
                                <div className="flex items-center gap-3 text-purple-400 border-b border-purple-500/20 pb-2 mb-6">
                                    <Icon name="activity" size={20} />
                                    <h3 className="text-sm font-bold uppercase tracking-widest">Complexity Analysis</h3>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {Object.entries(content.complexityAnalysis).map(([key, val]) => (
                                        <div key={key} className="bg-white/5 border border-white/5 p-4 rounded-xl flex flex-col hover:border-purple-500/30 transition-colors">
                                            <span className="text-xs text-slate-500 font-mono uppercase tracking-wider mb-2">{key}</span>
                                            <span className="text-sm font-bold text-white">{val}</span>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            {/* 3. Code Implementation */}
                            {content.codeSnippets && Object.keys(content.codeSnippets).length > 0 && (
                                <section id="sec-code" className="space-y-6">
                                    <div className="flex items-center gap-3 text-emerald-400 border-b border-emerald-500/20 pb-2 mb-6">
                                        <Icon name="code" size={20} />
                                        <h3 className="text-sm font-bold uppercase tracking-widest">Polyglot Implementation</h3>
                                    </div>
                                    <div className="space-y-8">
                                        {Object.entries(content.codeSnippets).map(([lang, code]) => (
                                            <div key={lang} className="rounded-xl overflow-hidden border border-white/10 bg-[#0d0d12]">
                                                <div className="px-4 py-2 bg-white/5 border-b border-white/5 flex justify-between items-center">
                                                    <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">{lang}</span>
                                                    <button className="text-xs text-brand-400 hover:text-white transition-colors" onClick={() => navigator.clipboard.writeText(code)}>COPY</button>
                                                </div>
                                                <pre className={`language-${lang} !m-0 !bg-transparent text-xs md:text-sm custom-scrollbar`}>
                                                    <code>{code}</code>
                                                </pre>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            )}

                            {/* 4. Pitfalls & Apps */}
                            <section id="sec-pitfalls" className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <div className="flex items-center gap-3 text-red-400 border-b border-red-500/20 pb-2 mb-6">
                                            <Icon name="alert-triangle" size={20} />
                                            <h3 className="text-sm font-bold uppercase tracking-widest">Common Pitfalls</h3>
                                        </div>
                                        <ul className="space-y-3">
                                            {content.pitfalls.map((p, i) => (
                                                <li key={i} className="flex items-start gap-3 text-sm text-slate-400">
                                                    <span className="text-red-500 mt-1"></span> {p}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                    <div>
                                        <div className="flex items-center gap-3 text-blue-400 border-b border-blue-500/20 pb-2 mb-6">
                                            <Icon name="globe" size={20} />
                                            <h3 className="text-sm font-bold uppercase tracking-widest">Industry Use</h3>
                                        </div>
                                        <ul className="space-y-3">
                                            {content.realWorldApplications.map((app, i) => (
                                                <li key={i} className="flex items-start gap-3 text-sm text-slate-400">
                                                    <span className="text-blue-500 mt-1"></span> {app}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </section>

                            {/* 5. Practice Deck */}
                            <section id="sec-practice" className="space-y-6">
                                <div className="flex items-center gap-3 text-cyan-400 border-b border-cyan-500/20 pb-2 mb-6">
                                    <Icon name="crosshair" size={20} />
                                    <h3 className="text-sm font-bold uppercase tracking-widest">Simulation Deck</h3>
                                </div>
                                <div className="space-y-3">
                                    {node.questions.map((q) => (
                                        <div key={q.id} className={`flex items-center justify-between p-4 rounded-xl border transition-all ${completedQuestions.includes(q.id) ? 'bg-emerald-500/5 border-emerald-500/30' : 'bg-white/5 border-white/5 hover:border-purple-500/30'}`}>
                                            <div className="flex items-center gap-4">
                                                <button
                                                    onClick={() => toggleQuestion && toggleQuestion(q)}
                                                    className={`w-6 h-6 rounded border flex items-center justify-center transition-all ${completedQuestions.includes(q.id) ? 'bg-emerald-500 border-emerald-500 text-black' : 'border-slate-500 hover:border-white'}`}
                                                >
                                                    {completedQuestions.includes(q.id) && <Icon name="check" size={14} />}
                                                </button>
                                                <div className="flex flex-col">
                                                    <span className={`text-sm font-medium transition-colors ${completedQuestions.includes(q.id) ? 'text-emerald-400 line-through opacity-70' : 'text-slate-200'}`}>
                                                        {q.title}
                                                    </span>
                                                    <div className="flex gap-2 items-center mt-1">
                                                        <span className={`text-[10px] font-bold uppercase tracking-wider ${q.difficulty === 'Easy' ? 'text-emerald-500' :
                                                            q.difficulty === 'Medium' ? 'text-amber-500' : 'text-red-500'
                                                            }`}>{q.difficulty}</span>
                                                        <span className="text-[10px] text-slate-500 font-mono">+{q.xp} XP</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <a
                                                href={q.link}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="flex items-center gap-2 px-4 py-2 bg-transparent text-purple-400 border border-purple-500/50 font-bold text-xs rounded-lg hover:bg-purple-500 hover:text-black transition-all"
                                            >
                                                SOLVE <Icon name="external-link" size={12} />
                                            </a>
                                        </div>
                                    ))}
                                </div>
                            </section>

                            <div className="h-32 text-center flex flex-col items-center justify-center text-slate-600 space-y-4">
                                <Icon name="check-circle" size={40} className="opacity-20" />
                                <p className="text-xs uppercase tracking-[0.3em]">Module Review Complete</p>
                            </div>
                        </div>

                        {/* Sidebar TOC */}
                        <div className="hidden lg:block w-64 bg-black/20 border-l border-white/5 p-6 space-y-2 sticky top-0 shrink-0">
                            <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6">Table of Contents</p>
                            {sections.map(s => (
                                <button
                                    key={s.id}
                                    onClick={() => scrollTo(s.id)}
                                    className={`w-full text-left px-4 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-between group ${activeSection === s.id ? 'bg-brand-500/10 text-brand-400 border border-brand-500/20' : 'text-slate-500 hover:text-white hover:bg-white/5'}`}
                                >
                                    {s.label}
                                    {activeSection === s.id && <motion.div layoutId="toc-active" className="w-1.5 h-1.5 rounded-full bg-brand-400" />}
                                </button>
                            ))}
                        </div>
                    </div>
                </motion.div>
            );
        };

        /* --- SKILL TREE COMPONENT --- */
        const SkillTree = ({ user, update, log }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [selectedNode, setSelectedNode] = useState(null);

            // -------------------------------------------------------------------------
            // PHASE 1: THE DATA CORE (MASSIVE JSON)
            // -------------------------------------------------------------------------
            const legacyData = useMemo(() => [
                // --- MODULE 1: ARRAYS & STRINGS (The Foundation) ---
                {
                    id: "arrays",
                    label: "Arrays & Hashing",
                    position: { x: 150, y: 100 },
                    status: "unlocked",
                    learningContent: {
                        definition: "An array is a collection of items stored at contiguous memory locations.",
                        keyConcepts: ["0-based Indexing", "Contiguous Memory", "O(1) Access Time", "Hash Maps for O(1) Lookup"],
                        explanation: "Arrays allow random access but have expensive insertion/deletion (O(n)). Hashing maps keys to values for efficient retrieval."
                    },
                    questions: [
                        { id: "arr_1", title: "Two Sum", link: "https://leetcode.com/problems/two-sum/", difficulty: "Easy", xp: 10 },
                        { id: "arr_2", title: "Best Time to Buy and Sell Stock", link: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", difficulty: "Easy", xp: 10 },
                        { id: "arr_3", title: "Contains Duplicate", link: "https://leetcode.com/problems/contains-duplicate/", difficulty: "Easy", xp: 10 },
                        { id: "arr_4", title: "Product of Array Except Self", link: "https://leetcode.com/problems/product-of-array-except-self/", difficulty: "Medium", xp: 20 },
                        { id: "arr_5", title: "Maximum Subarray", link: "https://leetcode.com/problems/maximum-subarray/", difficulty: "Medium", xp: 20 },
                        { id: "arr_6", title: "Maximum Product Subarray", link: "https://leetcode.com/problems/maximum-product-subarray/", difficulty: "Medium", xp: 20 },
                        { id: "arr_7", title: "Find Minimum in Rotated Sorted Array", link: "https://leetcode.com/problems/find-minimum-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                        { id: "arr_8", title: "Search in Rotated Sorted Array", link: "https://leetcode.com/problems/search-in-rotated-sorted-array/", difficulty: "Medium", xp: 20 },
                        { id: "arr_9", title: "3Sum", link: "https://leetcode.com/problems/3sum/", difficulty: "Medium", xp: 20 },
                        { id: "arr_10", title: "Container With Most Water", link: "https://leetcode.com/problems/container-with-most-water/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "strings",
                    label: "String Ops",
                    position: { x: 450, y: 100 },
                    status: "unlocked",
                    learningContent: {
                        definition: "Strings are immutable sequences of characters.",
                        keyConcepts: ["Immutability", "ASCII/Unicode", "Two Pointers", "Sliding Window"],
                        explanation: "String manipulation often involves traversing the string to find patterns, substrings, or palindromes efficiently."
                    },
                    questions: [
                        { id: "str_1", title: "Valid Palindrome", link: "https://leetcode.com/problems/valid-palindrome/", difficulty: "Easy", xp: 10 },
                        { id: "str_2", title: "Valid Anagram", link: "https://leetcode.com/problems/valid-anagram/", difficulty: "Easy", xp: 10 },
                        { id: "str_3", title: "Longest Substring Without Repeating Characters", link: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", difficulty: "Medium", xp: 20 },
                        { id: "str_4", title: "Longest Repeating Character Replacement", link: "https://leetcode.com/problems/longest-repeating-character-replacement/", difficulty: "Medium", xp: 20 },
                        { id: "str_5", title: "Group Anagrams", link: "https://leetcode.com/problems/group-anagrams/", difficulty: "Medium", xp: 20 },
                        { id: "str_6", title: "Valid Parentheses", link: "https://leetcode.com/problems/valid-parentheses/", difficulty: "Easy", xp: 10 },
                        { id: "str_7", title: "Longest Palindromic Substring", link: "https://leetcode.com/problems/longest-palindromic-substring/", difficulty: "Medium", xp: 20 },
                        { id: "str_8", title: "Palindromic Substrings", link: "https://leetcode.com/problems/palindromic-substrings/", difficulty: "Medium", xp: 20 },
                        { id: "str_9", title: "Encode and Decode Strings", link: "https://leetcode.com/problems/encode-and-decode-strings/", difficulty: "Medium", xp: 20 },
                        { id: "str_10", title: "Minimum Window Substring", link: "https://leetcode.com/problems/minimum-window-substring/", difficulty: "Hard", xp: 50 }
                    ]
                },

                // --- MODULE 2: LINKED LISTS & POINTERS ---
                {
                    id: "linkedlist",
                    label: "Linked Lists",
                    position: { x: 300, y: 300 },
                    dependencies: ["arrays"],
                    learningContent: {
                        definition: "A linear data structure where elements are not stored in contiguous locations.",
                        keyConcepts: ["Nodes & Pointers", "Singly vs Doubly Linked", "Fast & Slow Pointers", "Cycle Detection"],
                        explanation: "Linked Lists allow dynamic memory allocation and efficient insertion/deletion but have slow random access (O(n))."
                    },
                    questions: [
                        { id: "ll_1", title: "Reverse Linked List", link: "https://leetcode.com/problems/reverse-linked-list/", difficulty: "Easy", xp: 10 },
                        { id: "ll_2", title: "Merge Two Sorted Lists", link: "https://leetcode.com/problems/merge-two-sorted-lists/", difficulty: "Easy", xp: 10 },
                        { id: "ll_3", title: "Reorder List", link: "https://leetcode.com/problems/reorder-list/", difficulty: "Medium", xp: 20 },
                        { id: "ll_4", title: "Remove Nth Node From End of List", link: "https://leetcode.com/problems/remove-nth-node-from-end-of-list/", difficulty: "Medium", xp: 20 },
                        { id: "ll_5", title: "Copy List with Random Pointer", link: "https://leetcode.com/problems/copy-list-with-random-pointer/", difficulty: "Medium", xp: 20 },
                        { id: "ll_6", title: "Add Two Numbers", link: "https://leetcode.com/problems/add-two-numbers/", difficulty: "Medium", xp: 20 },
                        { id: "ll_7", title: "Linked List Cycle", link: "https://leetcode.com/problems/linked-list-cycle/", difficulty: "Easy", xp: 10 },
                        { id: "ll_8", title: "Find the Duplicate Number", link: "https://leetcode.com/problems/find-the-duplicate-number/", difficulty: "Medium", xp: 20 },
                        { id: "ll_9", title: "LRU Cache", link: "https://leetcode.com/problems/lru-cache/", difficulty: "Medium", xp: 20 },
                        { id: "ll_10", title: "Merge K Sorted Lists", link: "https://leetcode.com/problems/merge-k-sorted-lists/", difficulty: "Hard", xp: 50 }
                    ]
                },

                // --- MODULE 3: TREES & GRAPHS ---
                {
                    id: "trees",
                    label: "Trees & BST",
                    position: { x: 150, y: 500 },
                    dependencies: ["linkedlist"],
                    learningContent: {
                        definition: "A hierarchical data structure consisting of nodes with parent-child relationships.",
                        keyConcepts: ["Root & Leaves", "Binary Search Trees (BST)", "DFS vs BFS", "Recursion"],
                        explanation: "Trees are used for hierarchical data (like file systems). BSTs enable fast search, insertion, and deletion (O(log n))."
                    },
                    questions: [
                        { id: "tr_1", title: "Invert Binary Tree", link: "https://leetcode.com/problems/invert-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_2", title: "Maximum Depth of Binary Tree", link: "https://leetcode.com/problems/maximum-depth-of-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_3", title: "Diameter of Binary Tree", link: "https://leetcode.com/problems/diameter-of-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_4", title: "Balanced Binary Tree", link: "https://leetcode.com/problems/balanced-binary-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_5", title: "Same Tree", link: "https://leetcode.com/problems/same-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_6", title: "Subtree of Another Tree", link: "https://leetcode.com/problems/subtree-of-another-tree/", difficulty: "Easy", xp: 10 },
                        { id: "tr_7", title: "Lowest Common Ancestor of a BST", link: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-search-tree/", difficulty: "Medium", xp: 20 },
                        { id: "tr_8", title: "Binary Tree Level Order Traversal", link: "https://leetcode.com/problems/binary-tree-level-order-traversal/", difficulty: "Medium", xp: 20 },
                        { id: "tr_9", title: "Validate Binary Search Tree", link: "https://leetcode.com/problems/validate-binary-search-tree/", difficulty: "Medium", xp: 20 },
                        { id: "tr_10", title: "Kth Smallest Element in a BST", link: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "graphs",
                    label: "Graphs",
                    position: { x: 450, y: 500 },
                    dependencies: ["trees"],
                    learningContent: {
                        definition: "A collection of nodes (vertices) and edges connecting them.",
                        keyConcepts: ["Adjacency Matrix/List", "Directed vs Undirected", "Topological Sort", "Shortest Path (Dijkstra)"],
                        explanation: "Graphs model networks. Traversals like BFS (shortest path) and DFS (path existence) are fundamental algorithms."
                    },
                    questions: [
                        { id: "gr_1", title: "Number of Islands", link: "https://leetcode.com/problems/number-of-islands/", difficulty: "Medium", xp: 20 },
                        { id: "gr_2", title: "Clone Graph", link: "https://leetcode.com/problems/clone-graph/", difficulty: "Medium", xp: 20 },
                        { id: "gr_3", title: "Max Area of Island", link: "https://leetcode.com/problems/max-area-of-island/", difficulty: "Medium", xp: 20 },
                        { id: "gr_4", title: "Pacific Atlantic Water Flow", link: "https://leetcode.com/problems/pacific-atlantic-water-flow/", difficulty: "Medium", xp: 20 },
                        { id: "gr_5", title: "Surrounded Regions", link: "https://leetcode.com/problems/surrounded-regions/", difficulty: "Medium", xp: 20 },
                        { id: "gr_6", title: "Rotting Oranges", link: "https://leetcode.com/problems/rotting-oranges/", difficulty: "Medium", xp: 20 },
                        { id: "gr_7", title: "Walls and Gates", link: "https://leetcode.com/problems/walls-and-gates/", difficulty: "Medium", xp: 20 },
                        { id: "gr_8", title: "Course Schedule", link: "https://leetcode.com/problems/course-schedule/", difficulty: "Medium", xp: 20 },
                        { id: "gr_9", title: "Course Schedule II", link: "https://leetcode.com/problems/course-schedule-ii/", difficulty: "Medium", xp: 20 },
                        { id: "gr_10", title: "Graph Valid Tree", link: "https://leetcode.com/problems/graph-valid-tree/", difficulty: "Medium", xp: 20 }
                    ]
                },

                // --- MODULE 4: ADVANCED ALGORITHMS ---
                {
                    id: "dp",
                    label: "Dynamic Programming",
                    position: { x: 300, y: 700 },
                    dependencies: ["trees"],
                    learningContent: {
                        definition: "An optimization technique that solves problems by breaking them into overlapping subproblems.",
                        keyConcepts: ["Memoization (Top-Down)", "Tabulation (Bottom-Up)", "State Transition", "Optimal Substructure"],
                        explanation: "DP is used when a problem has overlapping subproblems. We store results of subproblems to avoid redundant re-computation."
                    },
                    questions: [
                        { id: "dp_1", title: "Climbing Stairs", link: "https://leetcode.com/problems/climbing-stairs/", difficulty: "Easy", xp: 10 },
                        { id: "dp_2", title: "Min Cost Climbing Stairs", link: "https://leetcode.com/problems/min-cost-climbing-stairs/", difficulty: "Easy", xp: 10 },
                        { id: "dp_3", title: "House Robber", link: "https://leetcode.com/problems/house-robber/", difficulty: "Medium", xp: 20 },
                        { id: "dp_4", title: "House Robber II", link: "https://leetcode.com/problems/house-robber-ii/", difficulty: "Medium", xp: 20 },
                        { id: "dp_5", title: "Longest Palindromic Substring", link: "https://leetcode.com/problems/longest-palindromic-substring/", difficulty: "Medium", xp: 20 },
                        { id: "dp_6", title: "Palindromic Substrings", link: "https://leetcode.com/problems/palindromic-substrings/", difficulty: "Medium", xp: 20 },
                        { id: "dp_7", title: "Decode Ways", link: "https://leetcode.com/problems/decode-ways/", difficulty: "Medium", xp: 20 },
                        { id: "dp_8", title: "Coin Change", link: "https://leetcode.com/problems/coin-change/", difficulty: "Medium", xp: 20 },
                        { id: "dp_9", title: "Maximum Product Subarray", link: "https://leetcode.com/problems/maximum-product-subarray/", difficulty: "Medium", xp: 20 },
                        { id: "dp_10", title: "Word Break", link: "https://leetcode.com/problems/word-break/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "heaps",
                    label: "Heaps & PQ",
                    position: { x: 150, y: 900 },
                    dependencies: ["trees"],
                    learningContent: {
                        definition: "A specialized tree-based data structure that satisfies the heap property.",
                        keyConcepts: ["Min-Heap vs Max-Heap", "Priority Queue", "Heapify", "O(log n) Insert/Extract"],
                        explanation: "Heaps allows fast access to the max or min element. Useful for priority queues, scheduling, and finding 'K-th largest' elements."
                    },
                    questions: [
                        { id: "h_1", title: "Kth Largest Element in a Stream", link: "https://leetcode.com/problems/kth-largest-element-in-a-stream/", difficulty: "Easy", xp: 10 },
                        { id: "h_2", title: "Last Stone Weight", link: "https://leetcode.com/problems/last-stone-weight/", difficulty: "Easy", xp: 10 },
                        { id: "h_3", title: "K Closest Points to Origin", link: "https://leetcode.com/problems/k-closest-points-to-origin/", difficulty: "Medium", xp: 20 },
                        { id: "h_4", title: "Kth Largest Element in an Array", link: "https://leetcode.com/problems/kth-largest-element-in-an-array/", difficulty: "Medium", xp: 20 },
                        { id: "h_5", title: "Task Scheduler", link: "https://leetcode.com/problems/task-scheduler/", difficulty: "Medium", xp: 20 },
                        { id: "h_6", title: "Design Twitter", link: "https://leetcode.com/problems/design-twitter/", difficulty: "Medium", xp: 20 },
                        { id: "h_7", title: "Find Median from Data Stream", link: "https://leetcode.com/problems/find-median-from-data-stream/", difficulty: "Hard", xp: 50 },
                        { id: "h_8", title: "Merge K Sorted Lists", link: "https://leetcode.com/problems/merge-k-sorted-lists/", difficulty: "Hard", xp: 50 },
                        { id: "h_9", title: "IPO", link: "https://leetcode.com/problems/ipo/", difficulty: "Hard", xp: 50 },
                        { id: "h_10", title: "Find K Pairs with Smallest Sums", link: "https://leetcode.com/problems/find-k-pairs-with-smallest-sums/", difficulty: "Medium", xp: 20 }
                    ]
                },
                {
                    id: "greedy",
                    label: "Greedy",
                    position: { x: 450, y: 900 },
                    dependencies: ["arrays"],
                    learningContent: {
                        definition: "An algorithmic paradigm that builds a solution piece by piece.",
                        keyConcepts: ["Local Optimal Choice", "Global Optimum", "Interval Problems", "Proof of Correctness"],
                        explanation: "Greedy algorithms make the locally optimal choice at each step. Efficient but doesn't always guarantee the global best (unlike DP)."
                    },
                    questions: [
                        { id: "gd_1", title: "Maximum Subarray", link: "https://leetcode.com/problems/maximum-subarray/", difficulty: "Easy", xp: 10 },
                        { id: "gd_2", title: "Jump Game", link: "https://leetcode.com/problems/jump-game/", difficulty: "Medium", xp: 20 },
                        { id: "gd_3", title: "Jump Game II", link: "https://leetcode.com/problems/jump-game-ii/", difficulty: "Medium", xp: 20 },
                        { id: "gd_4", title: "Gas Station", link: "https://leetcode.com/problems/gas-station/", difficulty: "Medium", xp: 20 },
                        { id: "gd_5", title: "Hand of Straights", link: "https://leetcode.com/problems/hand-of-straights/", difficulty: "Medium", xp: 20 },
                        { id: "gd_6", title: "Merge Triplets to Form Target Triplet", link: "https://leetcode.com/problems/merge-triplets-to-form-target-triplet/", difficulty: "Medium", xp: 20 },
                        { id: "gd_7", title: "Partition Labels", link: "https://leetcode.com/problems/partition-labels/", difficulty: "Medium", xp: 20 },
                        { id: "gd_8", title: "Valid Parenthesis String", link: "https://leetcode.com/problems/valid-parenthesis-string/", difficulty: "Medium", xp: 20 },
                        { id: "gd_9", title: "Reconstruct Queue by Height", link: "https://leetcode.com/problems/reconstruct-queue-by-height/", difficulty: "Medium", xp: 20 },
                        { id: "gd_10", title: "Non-overlapping Intervals", link: "https://leetcode.com/problems/non-overlapping-intervals/", difficulty: "Medium", xp: 20 }
                    ]
                }
            ], []);

            // Merge Legacy with Deep Dive Data
            const dsaMasterData = useMemo(() => {
                const legacy = legacyData;
                // Overlay Global Data
                const merged = legacy.map(node => {
                    const upgrade = DSA_MASTER_DATA.find(n => n.id === node.id);
                    return upgrade ? { ...node, ...upgrade } : node;
                });
                // Add new Global Data (Recursion) - ENSURE IT HAS POSITION
                const attempts = DSA_MASTER_DATA
                    .filter(n => !legacy.find(l => l.id === n.id))
                    .map(n => ({
                        ...n,
                        position: n.position || { x: 50, y: 50 }, // Fallback to avoid crash
                        learningContent: n.learningContent || {}
                    }));

                return [...merged, ...attempts];
            }, [legacyData]);

            // -------------------------------------------------------------------------
            // PHASE 2: GAMIFICATION & LOGIC
            // -------------------------------------------------------------------------

            // -------------------------------------------------------------------------
            // PHASE 2: GAMIFICATION & LOGIC
            // -------------------------------------------------------------------------

            // State: Modes, Progress, & Visuals
            const [dsaMode, setDsaMode] = useState(user.dsaMode || 'learning'); // 'learning' | 'practice'
            const [completedQuestions, setCompletedQuestions] = useState(user.solvedQuestions || []);
            const [totalXP, setTotalXP] = useState(user.totalXP || 0);
            const [shakingNode, setShakingNode] = useState(null);
            const [modalTab, setModalTab] = useState('theory'); // 'theory' | 'practice'

            // Sync with User Object
            useEffect(() => {
                if (
                    JSON.stringify(user.solvedQuestions) !== JSON.stringify(completedQuestions) ||
                    user.totalXP !== totalXP ||
                    user.dsaMode !== dsaMode
                ) {
                    update({ ...user, solvedQuestions: completedQuestions, totalXP: totalXP, dsaMode: dsaMode });
                }
            }, [completedQuestions, totalXP, dsaMode]);

            // Calculate Node Statuses dynamically
            const nodes = useMemo(() => {
                return dsaMasterData.map(node => {
                    // PRACTICE MODE: EVERYTHING UNLOCKED
                    if (dsaMode === 'practice') {
                        const mySolved = node.questions.filter(q => completedQuestions.includes(q.id)).length;
                        return { ...node, status: mySolved === node.questions.length && node.questions.length > 0 ? 'mastered' : 'unlocked' };
                    }

                    // LEARNING MODE: STRICT LOCKING
                    let isLocked = false;
                    if (node.dependencies) {
                        node.dependencies.forEach(depId => {
                            const depNode = dsaMasterData.find(d => d.id === depId);
                            if (depNode) {
                                // Count solved in depNode
                                const solvedCount = depNode.questions.filter(q => completedQuestions.includes(q.id)).length;
                                if (solvedCount < 5) isLocked = true; // REQUIRE 5 QUESTIONS TO UNLOCK NEXT
                            }
                        });
                    }

                    // Override: Root nodes always unlocked
                    if (node.status === "unlocked") isLocked = false;

                    // Check Mastery
                    const mySolved = node.questions.filter(q => completedQuestions.includes(q.id)).length;
                    let status = isLocked ? 'locked' : 'unlocked';
                    if (mySolved === node.questions.length && node.questions.length > 0) status = 'mastered';

                    return { ...node, status };
                });
            }, [dsaMasterData, completedQuestions, dsaMode]);

            // Helper to get connection lines
            const lines = useMemo(() => {
                const l = [];
                nodes.forEach(n => {
                    (n.dependencies || []).forEach(dId => {
                        const parent = nodes.find(x => x.id === dId);
                        if (parent) l.push({ from: parent.position, to: n.position, id: `${parent.id}-${n.id}`, status: n.status });
                    });
                });
                return l;
            }, [nodes]);

            const handleNodeClick = (node) => {
                if (node.status === 'locked') {
                    setShakingNode(node.id);
                    setTimeout(() => setShakingNode(null), 500);
                    return;
                }
                setModalTab(dsaMode === 'learning' ? 'theory' : 'practice');
                setSelectedNode(node);
            };

            const toggleQuestion = (q) => {
                const isSolved = completedQuestions.includes(q.id);
                if (isSolved) {
                    setCompletedQuestions(prev => prev.filter(id => id !== q.id));
                    setTotalXP(prev => Math.max(0, prev - q.xp));
                } else {
                    setCompletedQuestions(prev => [...prev, q.id]);
                    setTotalXP(prev => prev + q.xp);
                }
            };



            // Global Stats
            const totalQuestions = dsaMasterData.reduce((acc, n) => acc + n.questions.length, 0);
            const totalSolved = completedQuestions.length;
            const progressPercent = Math.min(100, (totalSolved / totalQuestions) * 100);

            const getRank = () => {
                if (progressPercent >= 90) return "Grandmaster";
                if (progressPercent >= 60) return "Master";
                if (progressPercent >= 30) return "Adept";
                if (progressPercent >= 10) return "Apprentice";
                return "Novice";
            };

            return (
                <div className="relative w-full h-[800px] dark:bg-[#080910] bg-slate-100 rounded-3xl border dark:border-white/10 border-slate-300 overflow-hidden shadow-2xl group flex flex-col font-sans">
                    {/* OVERLAY: MODE TOGGLE (LEFT) */}
                    <div className="absolute top-4 left-4 z-20 flex flex-col gap-2">
                        <div className="flex dark:bg-black/60 bg-white/60 backdrop-blur-md p-1 rounded-xl border dark:border-white/10 border-slate-300">
                            <button
                                onClick={() => setDsaMode('learning')}
                                className={`px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all ${dsaMode === 'learning' ? 'bg-cyan-500/20 text-cyan-600 dark:text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(34,211,238,0.3)]' : 'dark:text-slate-500 text-slate-400 hover:dark:text-white hover:text-slate-900'}`}
                            >
                                <Icon name="book-open" size={14} /> Learning
                            </button>
                            <button
                                onClick={() => setDsaMode('practice')}
                                className={`px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all ${dsaMode === 'practice' ? 'bg-purple-500/20 text-purple-600 dark:text-purple-400 border border-purple-500/50 shadow-[0_0_15px_rgba(168,85,247,0.3)]' : 'dark:text-slate-500 text-slate-400 hover:dark:text-white hover:text-slate-900'}`}
                            >
                                <Icon name="crosshair" size={14} /> Practice
                            </button>
                        </div>
                        <div className="dark:bg-black/40 bg-white/90 backdrop-blur px-3 py-1.5 rounded-lg border dark:border-white/5 border-slate-300 text-[10px] dark:text-slate-400 text-slate-700 font-bold font-mono shadow-sm flex items-center gap-2">
                            {dsaMode === 'learning' ? <><span className="text-orange-500"></span> Strict progression enabled.</> : <><span className="text-emerald-500"></span> Sandbox access unlocked.</>}
                        </div>
                    </div>

                    {/* OVERLAY: MASTERY BAR (RIGHT) */}
                    <div className="absolute top-4 right-4 z-20 w-64 dark:bg-black/80 bg-white/90 backdrop-blur-md p-4 rounded-xl border dark:border-white/10 border-slate-300 shadow-2xl flex flex-col gap-3">
                        <div className="flex justify-between items-end">
                            <div className="flex flex-col">
                                <span className="text-[10px] font-bold uppercase tracking-widest text-slate-500">Current Rank</span>
                                <span className="text-xl font-black dark:text-white text-slate-900">{getRank()}</span>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-mono font-bold text-cyan-400">{completedQuestions.length}</span>
                                <span className="text-xs text-slate-500">/{totalQuestions} Solved</span>
                            </div>
                        </div>
                        <div className="w-full h-2 bg-white/10 rounded-full overflow-hidden relative">
                            <div className="absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-500 transition-all duration-1000" style={{ width: `${progressPercent}%` }}></div>
                        </div>
                        <div className="flex justify-between text-[10px] font-mono text-slate-500">
                            <span>{Math.round(progressPercent)}% COMPLETE</span>
                            <span>{totalXP} XP</span>
                        </div>
                    </div>

                    {/* SCROLLABLE CANVAS CONTAINER */}
                    <div className="overflow-auto w-full h-full relative custom-scrollbar">
                        <div className="relative w-[1600px] h-[1600px]">
                            {/* Background Grid */}
                            <div className="absolute inset-0 opacity-20 pointer-events-none"
                                style={{ backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px)', backgroundSize: '30px 30px' }}>
                            </div>

                            {/* SVG Connections */}
                            <svg className="absolute inset-0 w-full h-full pointer-events-none z-0">
                                {lines.map(line => (
                                    <motion.line
                                        key={line.id}
                                        x1={line.from.x + 206} y1={line.from.y + 206}
                                        x2={line.to.x + 206} y2={line.to.y + 206}
                                        stroke={line.status === 'locked' ? '#334155' : dsaMode === 'practice' ? '#a855f7' : '#22d3ee'}
                                        strokeWidth="2"
                                        strokeDasharray={line.status === 'locked' ? "5,5" : "0"}
                                        initial={{ pathLength: 0, opacity: 0 }}
                                        animate={{ pathLength: 1, opacity: 1 }}
                                        transition={{ duration: 1.5, ease: "easeInOut" }}
                                    />
                                ))}
                            </svg>

                            {/* Nodes */}
                            <div className="relative z-10 w-full h-full">
                                {nodes.map(node => (
                                    <motion.div
                                        key={node.id}
                                        className={`absolute w-28 h-28 rounded-full flex flex-col items-center justify-center text-center p-2 border-2 cursor-pointer transition-all duration-300 backdrop-blur-md shadow-[0_0_30px_rgba(0,0,0,0.5)] z-10
                                            ${node.status === 'mastered' ? 'bg-emerald-500/20 border-emerald-500 dark:text-white text-emerald-900 shadow-[0_0_20px_rgba(16,185,129,0.4)]' :
                                                node.status === 'unlocked' ? (dsaMode === 'practice' ? 'bg-purple-500/10 border-purple-400 dark:text-purple-300 text-purple-900 shadow-[0_0_15px_rgba(168,85,247,0.3)]' : 'bg-cyan-500/10 border-cyan-400 dark:text-cyan-300 text-cyan-900 shadow-[0_0_15px_rgba(34,211,238,0.3)]') :
                                                    'bg-slate-800/50 dark:bg-slate-800/50 bg-slate-200 border-slate-700 dark:text-slate-600 text-slate-500 grayscale brightness-75'}`}
                                        style={{ left: node.position.x + 150, top: node.position.y + 150 }}
                                        onClick={() => handleNodeClick(node)}
                                        animate={shakingNode === node.id ? { x: [0, -5, 5, -5, 5, 0] } : {}}
                                        whileHover={node.status !== 'locked' ? { scale: 1.15, zIndex: 50 } : {}}
                                        whileTap={node.status !== 'locked' ? { scale: 0.95 } : {}}
                                    >
                                        <Icon name={node.status === 'locked' ? "lock" : node.status === 'mastered' ? "check-circle" : dsaMode === 'practice' ? "crosshair" : "book"}
                                            size={20}
                                            className={`mb-1 ${node.status === 'mastered' ? 'dark:text-emerald-400 text-emerald-700' : node.status === 'unlocked' ? (dsaMode === 'practice' ? 'dark:text-purple-400 text-purple-700' : 'dark:text-cyan-400 text-cyan-700') : 'dark:text-slate-600 text-slate-500'}`}
                                        />
                                        <span className="text-[10px] font-bold uppercase tracking-wider leading-tight line-clamp-2">{node.label}</span>
                                        {node.status !== 'locked' && (
                                            <div className="mt-1 text-[8px] font-mono dark:text-slate-400 text-slate-600">
                                                {node.questions.filter(q => completedQuestions.includes(q.id)).length}/{node.questions.length}
                                            </div>
                                        )}

                                        {/* Locked Tooltip */}
                                        {node.status === 'locked' && shakingNode === node.id && (
                                            <div className="absolute top-full mt-2 bg-red-500/90 text-white text-[10px] px-2 py-1 rounded w-32 font-bold animate-bounce z-50 pointer-events-none">
                                                LOCKED: Complete dependencies first!
                                            </div>
                                        )}
                                    </motion.div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* TOPIC DEEP DIVE (NEW UI) */}
                    <AnimatePresence>
                        {selectedNode && (
                            <TopicDeepDive
                                node={selectedNode}
                                onClose={() => setSelectedNode(null)}
                                completedQuestions={completedQuestions}
                                toggleQuestion={toggleQuestion}
                            />
                        )}
                    </AnimatePresence>
                </div>
            );
        };



        /* --- DSA TRACKER COMPONENT --- */
        const DSATracker = ({ user, update, log }) => {
            // Calculate real progress
            const totalQuestions = [...DSA_MASTER_DATA].reduce((acc, n) => acc + (n.questions?.length || 0), 0);
            const solvedCount = (user.solvedQuestions || []).length;
            const progress = totalQuestions > 0 ? Math.round((solvedCount / totalQuestions) * 100) : 0;

            return (
                <div className="space-y-8 animate-fade-in pb-12">
                    <div className="flex flex-col md:flex-row justify-between items-end gap-6 mb-8 border-b border-white/5 pb-6">
                        <div>
                            <h2 className="text-4xl font-bold text-white tracking-tight">DSA Hypergraph</h2>
                            <p className="text-slate-400 mt-2 font-mono text-xs">NEURAL SKILL TREE // VISUALIZATION MODE</p>
                        </div>
                        <div className="w-full md:w-64">
                            <div className="flex justify-between text-xs font-bold uppercase tracking-widest mb-2 text-slate-400">
                                <span>Mastery Level</span>
                                <span className="text-brand-400">{solvedCount} / {totalQuestions} Solved</span>
                            </div>
                            <ProgressBar value={progress} max={100} color="bg-cyan-500" />
                        </div>
                    </div>

                    <SkillTree user={user} update={update} log={log} />
                </div>
            )
        };

        const Settings = ({ user, update, reset }) => {
            const themes = { violet: 'Violet', cyan: 'Cyber', emerald: 'Matrix', rose: 'Neon' };
            const isDark = !document.documentElement.classList.contains('light');

            const toggleTheme = () => {
                const html = document.documentElement;
                if (html.classList.contains('light')) {
                    html.classList.remove('light');
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                    html.classList.add('light');
                }
            };

            return (
                <div className="max-w-xl mx-auto space-y-8 animate-fade-in pb-20">
                    <div className="space-y-2">
                        <h2 className="text-4xl font-bold dark:text-white text-slate-900 tracking-tight">System Configuration</h2>
                        <p className="text-slate-500 font-mono text-xs uppercase tracking-widest">Global Protocol Management</p>
                    </div>

                    <Card className="space-y-8 !bg-surface-900/40 border-white/5">
                        {/* THEME MODE */}
                        <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/5 hover:border-brand-500/30 transition-all">
                            <div>
                                <h4 className="dark:text-white text-slate-900 font-bold">Luminescence Mode</h4>
                                <p className="text-[10px] text-slate-500 uppercase tracking-widest font-mono mt-1">Dark / Light Interface</p>
                            </div>
                            <button
                                onClick={toggleTheme}
                                className="flex items-center gap-3 px-6 py-3 rounded-xl bg-brand-500 text-white font-black text-[10px] uppercase tracking-[0.2em] shadow-lg shadow-brand-500/20 hover:scale-105 active:scale-95 transition-all"
                            >
                                <Icon name={isDark ? "moon" : "sun"} size={16} />
                                {isDark ? "Override to Light" : "Switch to Dark"}
                            </button>
                        </div>

                        {/* ACCENT COLOR */}
                        <div>
                            <label className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em] block mb-4 ml-1">Accent Protocol</label>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                {Object.entries(themes).map(([k, n]) => (
                                    <button
                                        key={k}
                                        onClick={() => update({ ...user, themeColor: k })}
                                        className={`py-3 rounded-xl border font-bold text-[10px] uppercase tracking-widest transition-all ${user.themeColor === k ? 'border-brand-500 bg-brand-500/20 text-white whitespace-nowrap' : 'border-white/5 text-slate-500 hover:bg-white/5'}`}
                                    >
                                        {n}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* INPUTS */}
                        <div className="space-y-4">
                            <div>
                                <label className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em] block mb-2 ml-1">Primary Objective</label>
                                <input
                                    value={user.goalName || ''}
                                    onChange={e => update({ ...user, goalName: e.target.value })}
                                    placeholder="Enter your main mission..."
                                    className="w-full bg-black/50 light:bg-white light:text-slate-900 border border-white/10 p-4 rounded-xl dark:text-white text-slate-900 outline-none focus:border-brand-500 transition-all font-medium"
                                />
                            </div>
                            <div>
                                <label className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em] block mb-2 ml-1">Target Deadline</label>
                                <input
                                    type="date"
                                    value={user.examDate || ''}
                                    onChange={e => update({ ...user, examDate: e.target.value })}
                                    className="w-full bg-black/50 border border-white/10 p-4 rounded-xl text-white outline-none focus:border-brand-500 transition-all font-mono"
                                />
                            </div>
                        </div>
                    </Card>

                    {/* DANGER ZONE */}
                    <div className="border border-red-500/20 bg-red-500/5 rounded-2xl p-6 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 rounded-xl bg-red-500/10 flex items-center justify-center text-red-500 border border-red-500/20">
                                <Icon name="alert-octagon" size={24} />
                            </div>
                            <div>
                                <div className="text-red-400 font-black text-[10px] uppercase tracking-[0.2em]">Destructive Action</div>
                                <div className="text-white font-bold">Wipe System Memory</div>
                            </div>
                        </div>
                        <button
                            onClick={reset}
                            className="w-full md:w-auto px-8 py-3 bg-red-600/10 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/30 rounded-xl transition-all font-black text-[10px] uppercase tracking-[0.2em]"
                        >
                            Factory Reset
                        </button>
                    </div>
                </div>
            )
        };

        /* --- ROADMAP ENGINE (NEW MODULE) --- */
        /* --- ROADMAP ENGINE (SCALABLE & HIGH QUALITY) --- */
        const ROADMAP_MASTER_DATA = {
            "frontend": {
                id: "frontend",
                image: "https://images.unsplash.com/photo-1587620962725-abab7fe55159?auto=format&fit=crop&q=80&w=150",
                title: "Frontend Developer",
                description: "Master the art of building beautiful, interactive user interfaces for the web.",
                nodes: [
                    {
                        id: "internet",
                        label: "Internet",
                        type: "root",
                        status: 'unlocked',
                        description: "The underlying network of networks that powers the web. Understanding DNS, HTTP, and how browsers work is non-negotiable.",
                        whyMatters: "You can't build on top of a system you don't understand. Debugging requires network knowledge.",
                        timeEstimate: "1-2 Days",
                        keyConcepts: ["DNS", "HTTP/HTTPS", "Browsers", "Domain Names", "Hosting"],
                        resources: [
                            { title: "How the Internet Works (MDN)", link: "https://developer.mozilla.org/en-US/docs/Learn/Common_questions/Web_mechanics/How_does_the_Internet_work", type: "read" },
                            { title: "DNS in 100 Seconds", link: "https://www.youtube.com/watch?v=27r4B6uy54y", type: "watch" },
                            { title: "HTTP Crash Course", link: "https://www.youtube.com/watch?v=iYM2zFP3Zn0", type: "watch" }
                        ]
                    },
                    {
                        id: "html",
                        label: "HTML5",
                        parentId: "internet",
                        status: 'locked',
                        description: "The skeleton of the web. Learn Semantic HTML, Accessibility (A11y), and SEO basics. Do not just learn tags; learn structure.",
                        whyMatters: "Bad HTML leads to inaccessible sites and poor SEO rankings.",
                        timeEstimate: "3-5 Days",
                        keyConcepts: ["Semantic Tags", "Accessibility", "Forms", "SEO", "DOM Structure"],
                        resources: [
                            { title: "HTML Full Course (FreeCodeCamp)", link: "https://www.youtube.com/watch?v=kUMe1FH4CHE", type: "watch" },
                            { title: "Semantic HTML Guide", link: "https://www.w3schools.com/html/html5_semantic_elements.asp", type: "read" }
                        ]
                    },
                    {
                        id: "css",
                        label: "CSS3 & Layouts",
                        parentId: "internet",
                        status: 'locked',
                        description: "Styling the web. Mastery involves Flexbox, Grid, Responsive Design (Media Queries), and the Box Model.",
                        whyMatters: "If it looks broken, users leave. CSS is the difference between a toy and a product.",
                        timeEstimate: "7-10 Days",
                        keyConcepts: ["Box Model", "Flexbox", "Grid", "Media Queries", "Psuedo-classes"],
                        resources: [
                            { title: "Flexbox Froggy (Game)", link: "https://flexboxfroggy.com/", type: "practice" },
                            { title: "CSS Grid Garden", link: "https://cssgridgarden.com/", type: "practice" },
                            { title: "Kevin Powell CSS Course", link: "https://www.youtube.com/user/KepowOb", type: "watch" }
                        ]
                    },
                    {
                        id: "js",
                        label: "JavaScript",
                        parentId: "html",
                        status: 'locked',
                        description: "The brain of the browser. Focus on ES6+, DOM Manipulation, Fetch API, and Asynchronous JS (Promises/Async-Await).",
                        whyMatters: "It's the only language that runs in the browser. It enables all interactivity.",
                        timeEstimate: "14-21 Days",
                        keyConcepts: ["ES6+", "DOM", "Fetch API", "Promises", "Async/Await", "Event Loop"],
                        resources: [
                            { title: "Namaste JavaScript (Akshay Saini)", link: "https://www.youtube.com/watch?v=pN6jk0uapqY", type: "watch" },
                            { title: "You Don't Know JS (Book)", link: "https://github.com/getify/You-Dont-Know-JS", type: "read" },
                            { title: "JavaScript.info", link: "https://javascript.info/", type: "read" }
                        ]
                    },
                    {
                        id: "react",
                        label: "React.js",
                        parentId: "js",
                        status: 'locked',
                        description: "The most popular UI library. Learn Hooks (useState, useEffect), Virtual DOM, and State Management (Redux/Zustand).",
                        whyMatters: "Industry standard for building complex, scalable user interfaces.",
                        timeEstimate: "14-20 Days",
                        keyConcepts: ["Components", "Hooks", "Virtual DOM", "State Mgmt", "Props"],
                        resources: [
                            { title: "React Docs (Beta)", link: "https://react.dev/", type: "read" },
                            { title: "React Course (Chai aur Code)", link: "https://www.youtube.com/watch?v=0f7_f5gS8gs&list=PLu71SKxNbfoDqgPchsyal38CAy2f11rK_", type: "watch" }
                        ]
                    },
                    {
                        id: "git",
                        label: "Git & GitHub",
                        parentId: "react",
                        status: 'locked',
                        description: "Version control is mandatory for teams. Learn branching, merging, pull requests, and resolving conflicts.",
                        whyMatters: "Safety net for your code. collaborative work is impossible without it.",
                        timeEstimate: "2-3 Days",
                        keyConcepts: ["Commit", "Branch", "Merge", "Pull Request", "Revert"],
                        resources: [{ title: "Git & GitHub Crash Course", link: "https://www.youtube.com/watch?v=RGOj5yH7evk", type: "watch" }]
                    },
                    {
                        id: "tailwind",
                        label: "Tailwind CSS",
                        parentId: "react",
                        status: 'locked',
                        description: "A utility-first CSS framework for rapid UI development. Learn the class-based styling approach.",
                        whyMatters: "Speed. Once you know it, you can build UIs faster than with any other tool.",
                        timeEstimate: "3-5 Days",
                        keyConcepts: ["Utility Classes", "Config", "Responsive Prefixes", "Dark Mode"],
                        resources: [{ title: "Tailwind Labs", link: "https://www.youtube.com/c/TailwindLabs", type: "watch" }]
                    }
                ]
            },
            "backend": {
                id: "backend",
                image: "https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&q=80&w=150",
                title: "Backend Architect",
                description: "Design robust server-side systems, APIs, and database architectures.",
                nodes: [
                    {
                        id: "os",
                        label: "OS & Terminal",
                        type: "root",
                        status: 'unlocked',
                        description: "Linux is the backbone of the internet. Learn file systems, permissions, SSH, and Bash scripting.",
                        resources: [
                            { title: "Linux Command Line", link: "https://ubuntu.com/tutorials/command-line-for-beginners", type: "read" },
                            { title: "The Missing Semester (MIT)", link: "https://missing.csail.mit.edu/", type: "watch" },
                            { title: "Command Line Power User", link: "https://commandlinepoweruser.com/", type: "watch" }
                        ]
                    },
                    {
                        id: "lang",
                        label: "Node/Go/Python",
                        parentId: "os",
                        status: 'locked',
                        description: "Pick a server-side language. Node.js for JS devs, Go for performance, Python for Data/AI.",
                        resources: [
                            { title: "Node.js Design Patterns", link: "https://www.nodejsdesignpatterns.com/", type: "read" },
                            { title: "Go Programming Language", link: "https://go.dev/doc/", type: "read" },
                            { title: "Node.js Crash Course", link: "https://www.youtube.com/watch?v=fBNz5xF-Kx4", type: "watch" }
                        ]
                    },
                    {
                        id: "db",
                        label: "DB (Postgres)",
                        parentId: "lang",
                        status: 'locked',
                        description: "Relational databases are critical. Understand ACID, Normalization, Indexes, and SQL.",
                        resources: [
                            { title: "PostgreSQL Tutorial", link: "https://www.postgresqltutorial.com/", type: "read" },
                            { title: "SQL Bolt", link: "https://sqlbolt.com/", type: "practice" },
                            { title: "Learn SQL in 1 Hour", link: "https://www.youtube.com/watch?v=HXV3zeQKqGY", type: "watch" }
                        ]
                    },
                    {
                        id: "redis",
                        label: "Redis (Caching)",
                        parentId: "db",
                        status: 'locked',
                        description: "Redis is an in-memory key-value store used for caching, queues, and pub/sub.",
                        resources: [
                            { title: "Redis Crash Course", link: "https://www.youtube.com/watch?v=XCsS_NVAa1g", type: "watch" },
                            { title: "Redis Docs", link: "https://redis.io/docs/", type: "read" }
                        ]
                    },
                    {
                        id: "docker",
                        label: "Docker",
                        parentId: "lang",
                        status: 'locked',
                        description: "Containerization ensures your app runs the same everywhere. Learn Dockerfiles and Compose.",
                        resources: [
                            { title: "Docker for Beginners", link: "https://docker-curriculum.com/", type: "read" },
                            { title: "Nana's Docker Course", link: "https://www.youtube.com/watch?v=3c-iBn73dDE", type: "watch" },
                            { title: "Play with Docker", link: "https://labs.play-with-docker.com/", type: "practice" }
                        ]
                    }
                ]
            },
            "ai-engineer": {
                id: "ai-engineer",
                image: "https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&q=80&w=150",
                title: "AI Engineer",
                description: "Build intelligent systems using Machine Learning and Large Language Models.",
                nodes: [
                    { id: "math", label: "Math Foundations", type: "root", status: 'unlocked', description: "Linear Algebra, Calculus, and Probability are the prerequisites for understanding ML algorithms.", resources: [{ title: "Khan Academy Math", link: "https://www.khanacademy.org/math", type: "practice" }, { title: "Essential Math for ML", link: "https://www.youtube.com/watch?v=71oMnLY2H56", type: "watch" }] },
                    { id: "python", label: "Python", parentId: "math", status: 'locked', description: "The lingua franca of AI. Master NumPy, Pandas, and environment management.", resources: [{ title: "Real Python", link: "https://realpython.com/", type: "read" }, { title: "Python for Data Science", link: "https://www.youtube.com/watch?v=LHBE6Q9XlzI", type: "watch" }] },
                    { id: "ml", label: "Machine Learning", parentId: "python", status: 'locked', description: "Supervised vs Unsupervised learning. Scikit-Learn. Gradient Descent.", resources: [{ title: "Andrew Ng's ML Course", link: "https://www.coursera.org/learn/machine-learning", type: "watch" }, { title: "Scikit-Learn Docs", link: "https://scikit-learn.org/stable/", type: "read" }] },
                    { id: "dl", label: "Deep Learning", parentId: "ml", status: 'locked', description: "Neural Networks, Backpropagation, CNNs, and RNNs using PyTorch or TensorFlow.", resources: [{ title: "Fast.ai", link: "https://course.fast.ai/", type: "watch" }, { title: "Deep Learning Book", link: "https://www.deeplearningbook.org/", type: "read" }] },
                    { id: "llm", label: "LLMs & RAG", parentId: "dl", status: 'locked', description: "Large Language Models, Transformers, Attention Mechanism, and Retrieval Augmented Generation.", resources: [{ title: "Karpathy's Zero to Hero", link: "https://karpathy.ai/zero-to-hero.html", type: "watch" }, { title: "LangChain Docs", link: "https://python.langchain.com/", type: "read" }] }
                ]
            },
            "devops": {
                id: "devops",
                image: "https://images.unsplash.com/photo-1614624532983-4ce03382d63d?auto=format&fit=crop&q=80&w=150",
                title: "DevOps Engineer",
                description: "Bridge the gap between development and operations with CI/CD and Cloud.",
                nodes: [
                    { id: "linux", label: "Linux Admin", type: "root", status: 'unlocked', description: "Deep dive into kernel, shell scripting, and process management.", resources: [{ title: "Linux Journey", link: "https://linuxjourney.com/", type: "read" }, { title: "Vim Adventures", link: "https://vim-adventures.com/", type: "practice" }] },
                    { id: "net", label: "Networking", parentId: "linux", status: 'locked', description: "OSI Model, TCP/IP, DNS, LOAD Balancers. Hardcore networking limits debugging time.", resources: [{ title: "Network Chuck", link: "https://www.youtube.com/c/NetworkChuck", type: "watch" }, { title: "MDN Networking", link: "https://developer.mozilla.org/en-US/docs/Learn/Common_questions/Web_mechanics", type: "read" }] },
                    { id: "k8s", label: "Kubernetes", parentId: "net", status: 'locked', description: "Container Orchestration. Pods, Services, Ingress, and Helm charts.", resources: [{ title: "Kubernetes The Hard Way", link: "https://github.com/kelseyhightower/kubernetes-the-hard-way", type: "practice" }, { title: "K8s Docs", link: "https://kubernetes.io/docs/home/", type: "read" }] },
                    { id: "aws", label: "AWS / Cloud", parentId: "net", status: 'locked', description: "EC2, S3, IAM, VPC. The cloud infrastructure standard.", resources: [{ title: "AWS Free Tier", link: "https://aws.amazon.com/free/", type: "practice" }, { title: "AWS Skill Builder", link: "https://explore.skillbuilder.aws/", type: "read" }] },
                    { id: "cicd", label: "CI/CD Pipeline", parentId: "k8s", status: 'locked', description: "Automated testing and deployment using GitHub Actions or Jenkins.", resources: [{ title: "GitHub Actions Docs", link: "https://docs.github.com/en/actions", type: "read" }, { title: "GitLab CI Course", link: "https://www.youtube.com/watch?v=l5705U8s_nQ", type: "watch" }] }
                ]
            },
            "fullstack": {
                id: "fullstack",
                image: "https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&q=80&w=150",
                title: "Full Stack Developer",
                description: "The complete package. Handle both client-side and server-side complexity.",
                nodes: [
                    { id: "web", label: "Web Core", type: "root", status: 'unlocked', description: "HTML/CSS/JS mastery is the baseline. No shortcuts.", resources: [{ title: "MDN Web Docs", link: "https://developer.mozilla.org", type: "read" }, { title: "CS50 Web Programming", link: "https://cs50.harvard.edu/web/", type: "watch" }] },
                    { id: "frontend", label: "Frontend Framework", parentId: "web", status: 'locked', description: "React, Vue, or Svelte. Choose one and get deep. Composable UI.", resources: [{ title: "React Docs", link: "https://react.dev", type: "read" }, { title: "Frontend Masters", link: "https://frontendmasters.com/guides/front-end-handbook/2019/", type: "read" }] },
                    { id: "backend", label: "Backend API", parentId: "web", status: 'locked', description: "RESTful services or GraphQL endpoints. Auth, Middleware, and Controllers.", resources: [{ title: "Express.js Docs", link: "https://expressjs.com/", type: "read" }, { title: "Building REST APIs", link: "https://www.youtube.com/watch?v=pKd0Rpw7O48", type: "watch" }] },
                    { id: "db", label: "Database", parentId: "backend", status: 'locked', description: "SQL for structure, NoSQL for scale. ORMs like Prisma/Drizzle.", resources: [{ title: "Prisma Docs", link: "https://www.prisma.io/docs", type: "read" }, { title: "PlanetScale Blog", link: "https://planetscale.com/blog", type: "read" }] },
                    { id: "deploy", label: "Deployment", parentId: "frontend", status: 'locked', description: "Vercel/Netlify for frontend, Railway/Render for backend. CI/CD.", resources: [{ title: "Vercel Docs", link: "https://vercel.com/docs", type: "read" }, { title: "Railway Docs", link: "https://docs.railway.app/", type: "read" }] }
                ]
            },
            "blockchain": {
                id: "blockchain",
                image: "https://images.unsplash.com/photo-1639762681485-074b7f938ba0?auto=format&fit=crop&q=80&w=150",
                title: "Blockchain Dev",
                description: "Learn to build decentralized applications and smart contracts.",
                nodes: [
                    { id: "crypto", label: "Cryptography", type: "root", status: 'unlocked', description: "Hashing (SHA-256), Asymmetric encryption, and Digital Signatures.", resources: [{ title: "Crypto 101", link: "https://www.coursera.org/learn/crypto", type: "watch" }, { title: "Anders Brownworth Demo", link: "https://andersbrownworth.com/blockchain/", type: "practice" }] },
                    { id: "eth", label: "Ethereum & EVM", parentId: "crypto", status: 'locked', description: "The World Computer. Gas, Transactions, and the account model.", resources: [{ title: "Ethereum.org", link: "https://ethereum.org/en/developers/docs/", type: "read" }, { title: "Mastering Ethereum", link: "https://github.com/ethereumbook/ethereumbook", type: "read" }] },
                    { id: "solidity", label: "Solidity", parentId: "eth", status: 'locked', description: "The language of Smart Contracts. State variables, mappings, and modifiers.", resources: [{ title: "CryptoZombies", link: "https://cryptozombies.io/", type: "practice" }, { title: "Solidity by Example", link: "https://solidity-by-example.org/", type: "read" }] },
                    { id: "dapp", label: "DApp Integration", parentId: "solidity", status: 'locked', description: "Connecting Frontend to Blockchain using Ethers.js or Viem.", resources: [{ title: "Scaffold-ETH", link: "https://github.com/scaffold-eth/scaffold-eth-2", type: "practice" }, { title: "Wagmi Hooks", link: "https://wagmi.sh/", type: "read" }] }
                ]
            }
        };



        /* --- ROADMAP ENGINE (SCALABLE) --- */


        /* --- AUTO-LAYOUT HOOK --- */
        const useTreeLayout = (nodes, rootId = "1") => {
            return useMemo(() => {
                const layout = [];
                const levels = {};
                const adj = {};

                nodes.forEach(n => {
                    if (n.parentId) {
                        if (!adj[n.parentId]) adj[n.parentId] = [];
                        adj[n.parentId].push(n.id);
                    }
                });

                const getDepth = (id, d = 0) => {
                    if (!levels[d]) levels[d] = [];
                    const node = nodes.find(n => n.id === id);
                    if (node && !levels[d].find(x => x.id === id)) levels[d].push(node);
                    (adj[id] || []).forEach(childId => getDepth(childId, d + 1));
                };

                const root = nodes.find(n => n.type === 'root') || nodes[0];
                if (root) getDepth(root.id, 0);

                const CANVAS_WIDTH = 1200;
                const LEVEL_HEIGHT = 180;

                Object.keys(levels).forEach(d => {
                    const depth = parseInt(d);
                    const layerNodes = levels[d];
                    const count = layerNodes.length;
                    const segment = CANVAS_WIDTH / (count + 1);

                    layerNodes.forEach((node, i) => {
                        layout.push({
                            ...node,
                            x: segment * (i + 1) - 80,
                            y: 80 + (depth * LEVEL_HEIGHT)
                        });
                    });
                });
                return layout;
            }, [nodes]);
        };        /* --- SHARED RESOURCES --- */
        const DEFAULT_RESOURCES = [
            { id: 1, title: 'JavaScript Complete Guide', topic: 'js', category: 'programming', type: 'link', url: 'https://javascript.info', description: 'Comprehensive JavaScript tutorial from basics to advanced. Covers everything from variables to advanced patterns.', tags: ['javascript', 'web', 'frontend'], addedDate: '2026-01-15' },
            { id: 2, title: 'Python for Data Science', topic: 'python', category: 'programming', type: 'video', url: 'https://www.youtube.com/watch?v=rfscVS0vtbw', description: 'Complete Python course for data science and machine learning. Includes NumPy, Pandas, and Matplotlib.', tags: ['python', 'data-science', 'ml'], duration: '12 hours', addedDate: '2026-01-20' },
            { id: 3, title: 'React Official Docs', topic: 'react', category: 'programming', type: 'link', url: 'https://react.dev', description: 'Official React documentation. The best place to learn React 18+ hooks and patterns.', tags: ['react', 'frontend', 'javascript'], addedDate: '2026-01-25' },
            { id: 4, title: 'JS Algorithms & Data Structures', topic: 'sql-dsa', category: 'programming', type: 'link', url: 'https://github.com/trekhleb/javascript-algorithms', description: 'Quick reference for data structures and algorithms with code examples in JS.', tags: ['dsa', 'algorithms', 'interview'], size: '1.2 MB', addedDate: '2026-02-01' },
            { id: 5, title: 'System Design Primer', topic: 'sys-design-primer', category: 'interview', type: 'link', url: 'https://github.com/donnemartin/system-design-primer', description: 'A comprehensive guide to designing large-scale systems. Mandatory for senior dev interviews.', tags: ['system-design', 'interview', 'architecture'], addedDate: '2026-01-18' },
            { id: 6, title: 'Modern Resume Template', topic: 'resume-template', category: 'career', type: 'link', url: 'https://www.overleaf.com/gallery/tagged/cv', description: 'Modern, ATS-friendly LaTeX and JSON resume templates for 2026.', tags: ['resume', 'career', 'job'], addedDate: '2026-01-22' },
            { id: 7, title: 'Node.js Design Patterns', topic: 'node', category: 'programming', type: 'link', url: 'https://github.com/vigneshshanmugam/nodejs-design-patterns', description: 'Design patterns for building core-level scalable enterprise applications with Node.js.', tags: ['node', 'backend', 'patterns'], addedDate: '2026-02-05' },
            { id: 8, title: 'Frontend Masters: Web Performance', topic: 'js-arch', category: 'programming', type: 'video', url: 'https://frontendmasters.com/courses/web-performance/', description: 'Deep dive into browser internals and V8 optimization techniques.', tags: ['performance', 'v8', 'architecture'], addedDate: '2026-02-08' },
            { id: 9, title: 'Designing Data-Intensive Applications', topic: 'sys-design', category: 'interview', type: 'link', url: 'https://dataintensive.net/', description: 'The bible of distributed systems and database internals. Essential reading for architects.', tags: ['distributed-systems', 'databases', 'architecture'], addedDate: '2026-01-30' }
        ];


        const RoadmapRenderer = ({ roadmapId, QP, onBack, user, update, userProgress, updateUserProgress }) => {
            const { motion, AnimatePresence } = window.Motion;
            const data = ROADMAP_MASTER_DATA[roadmapId];
            if (!data) return <div className="p-10 text-white">Roadmap not found: {roadmapId}</div>;

            const [selectedNode, setSelectedNode] = useState(null);
            const nodesWithPos = useTreeLayout(data.nodes);

            const lines = useMemo(() => {
                const edges = [];
                nodesWithPos.forEach(node => {
                    if (node.parentId) {
                        const parent = nodesWithPos.find(n => n.id === node.parentId);
                        if (parent) {
                            edges.push({ from: parent, to: node });
                        }
                    }
                });
                return edges;
            }, [nodesWithPos]);

            const getStatus = (nodeId) => {
                return (userProgress[roadmapId] && userProgress[roadmapId][nodeId]) || nodesWithPos.find(n => n.id === nodeId)?.status || 'locked';
            };

            const toggleStatus = (node) => {
                const current = (userProgress[roadmapId] && userProgress[roadmapId][node.id]);
                const newStatus = current === 'mastered' ? 'unlocked' : 'mastered';
                updateUserProgress(roadmapId, { ...(userProgress[roadmapId] || {}), [node.id]: newStatus });
            };

            const handleAddToVault = (resource) => {
                const vaultResources = user.resources || DEFAULT_RESOURCES;
                if (vaultResources.some(r => r.url === resource.link)) {
                    alert("Resource already in Vault");
                    return;
                }
                const newResource = {
                    id: Date.now(),
                    title: resource.title,
                    url: resource.link,
                    type: resource.type || 'link',
                    category: 'learning',
                    description: `Added from ${data.title} roadmap node: ${selectedNode.label}`,
                    tags: [roadmapId, 'roadmap'],
                    addedDate: new Date().toISOString().split('T')[0]
                };
                update({ ...user, resources: [newResource, ...vaultResources] });
            };

            const getResourceIcon = (type) => {
                switch (type) {
                    case 'watch': return 'monitor';
                    case 'practice': return 'tool';
                    case 'read': default: return 'file-text';
                }
            };

            const getResourceColor = (type) => {
                switch (type) {
                    case 'watch': return 'text-red-400';
                    case 'practice': return 'text-emerald-400';
                    case 'read': default: return 'text-blue-400';
                }
            };

            return (
                <div className="h-full flex flex-col animate-fade-in relative z-10 transition-colors duration-500">
                    <button
                        onClick={onBack}
                        className="fixed top-6 left-6 z-50 bg-black/50 backdrop-blur-md text-white border border-white/10 hover:bg-white hover:text-black rounded-full px-6 py-2 flex items-center gap-2 transition-all duration-300 group shadow-2xl"
                    >
                        <Icon name="arrow-left" size={16} className="group-hover:-translate-x-1 transition-transform" />
                        <span className="text-xs font-bold uppercase tracking-widest">Back to Hub</span>
                    </button>

                    <div className="absolute top-6 right-6 z-10 text-right pointer-events-none mix-blend-difference">
                        <h2 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-500 leading-none">{data.title}</h2>
                        <p className="text-[10px] text-cyan-400 font-mono mt-1 uppercase tracking-widest">Interactive Protocol</p>
                    </div>

                    <div className="flex-1 relative overflow-hidden dark:bg-[#050505] bg-slate-50 shadow-inner group cursor-grab active:cursor-grabbing">
                        <div className="absolute inset-0 overflow-auto no-scrollbar" style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}>
                            <style>{` .no-scrollbar::-webkit-scrollbar { display: none; } `}</style>
                            <div className="relative w-[1200px] mx-auto min-h-[800px] flex justify-center p-20 pt-32">
                                <svg className="absolute inset-0 w-full h-full pointer-events-none z-0">
                                    <defs>
                                        <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                                            <feGaussianBlur stdDeviation="4" result="blur" />
                                            <feComposite in="SourceGraphic" in2="blur" operator="over" />
                                        </filter>
                                    </defs>
                                    {lines.map((l, i) => (
                                        <path
                                            key={i}
                                            d={`M${l.from.x + 80} ${l.from.y + 64} C ${l.from.x + 80} ${l.from.y + 130}, ${l.to.x + 80} ${l.to.y - 50}, ${l.to.x + 80} ${l.to.y}`}
                                            fill="none"
                                            stroke="#475569"
                                            strokeWidth="2"
                                            className="opacity-50"
                                        />
                                    ))}
                                </svg>
                                {nodesWithPos.map(node => {
                                    const status = (userProgress[roadmapId] && userProgress[roadmapId][node.id]) || node.status;
                                    const isLocked = status === 'locked';
                                    const isMastered = status === 'mastered';



                                    return (
                                        <div
                                            key={node.id}
                                            onClick={() => setSelectedNode(node)}
                                            style={{ left: node.x, top: node.y }}
                                            className={`
                                                absolute w-40 min-w-[160px] py-4 rounded-xl text-center cursor-pointer transition-all duration-300 group z-10
                                                bg-black/80 backdrop-blur-md border-2 
                                                ${isMastered
                                                    ? 'border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.6)]'
                                                    : !isLocked
                                                        ? 'border-cyan-500 shadow-[0_0_20px_rgba(6,182,212,0.6)]'
                                                        : 'border-white/10 hover:border-purple-500 hover:shadow-[0_0_15px_rgba(168,85,247,0.5)] opacity-80 hover:opacity-100 grayscale hover:grayscale-0'
                                                }
                                            `}
                                        >
                                            <div className="flex items-center justify-center gap-2 mb-1 px-2">
                                                {isLocked && <Icon name="lock" size={12} className="text-slate-500 group-hover:text-purple-400 transition-colors" />}
                                                {isMastered && <Icon name="check" size={12} className="text-emerald-400" />}
                                                <span className={`text-xs font-bold uppercase tracking-wider transition-colors ${isMastered ? 'text-emerald-400' : isLocked ? 'text-slate-500 group-hover:text-purple-400' : 'text-white'}`}>{node.label}</span>
                                            </div>
                                            {!isLocked && <div className="text-[9px] text-slate-400 font-mono">{node.timeEstimate || 'View Details'}</div>}
                                            {(!isMastered && !isLocked) && (
                                                <span className="absolute -top-1 -right-1 flex h-3 w-3">
                                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
                                                    <span className="relative inline-flex rounded-full h-3 w-3 bg-cyan-500"></span>
                                                </span>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    <AnimatePresence>
                        {selectedNode && (
                            <>
                                <motion.div
                                    initial={{ opacity: 0 }}
                                    animate={{ opacity: 1 }}
                                    exit={{ opacity: 0 }}
                                    onClick={() => setSelectedNode(null)}
                                    className="fixed inset-0 z-40 bg-black/60 backdrop-blur-sm cursor-pointer"
                                />

                                <motion.div
                                    initial={{ x: "100%" }}
                                    animate={{ x: 0 }}
                                    exit={{ x: "100%" }}
                                    transition={{ type: "spring", stiffness: 300, damping: 30 }}
                                    className="fixed top-0 right-0 bottom-0 w-full md:w-[450px] dark:bg-[#0a0a0c] bg-white border-l dark:border-white/10 border-slate-200 shadow-2xl z-50 p-8 flex flex-col"
                                >
                                    <button onClick={() => setSelectedNode(null)} className="absolute top-6 right-6 p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-colors">
                                        <Icon name="x" size={24} />
                                    </button>

                                    <div className="mb-8 mt-4">
                                        <div className="flex items-center gap-3 mb-4">
                                            <span className="px-3 py-1 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 text-[10px] font-bold uppercase tracking-widest">{selectedNode.timeEstimate || "Self-Paced"}</span>
                                            {(userProgress[roadmapId] && userProgress[roadmapId][selectedNode.id] === 'mastered') &&
                                                <span className="px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-bold uppercase tracking-widest">Completed</span>
                                            }
                                        </div>
                                        <h3 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 leading-tight">{selectedNode.label}</h3>
                                        {selectedNode.description && <p className="text-sm dark:text-slate-400 text-slate-600 mt-4 leading-relaxed">{selectedNode.description}</p>}
                                    </div>

                                    <div className="space-y-6 flex-1 overflow-y-auto custom-scrollbar pr-2">
                                        {selectedNode.whyMatters && (
                                            <div className="p-4 rounded-xl bg-orange-500/5 border border-orange-500/10">
                                                <h4 className="flex items-center gap-2 text-xs font-bold text-orange-400 uppercase tracking-widest mb-2">
                                                    <Icon name="zap" size={14} /> Why It Matters
                                                </h4>
                                                <p className="text-sm text-orange-200/80 leading-relaxed">
                                                    {selectedNode.whyMatters}
                                                </p>
                                            </div>
                                        )}

                                        {selectedNode.keyConcepts && selectedNode.keyConcepts.length > 0 && (
                                            <div>
                                                <h4 className="text-xs font-bold dark:text-slate-500 text-slate-400 uppercase tracking-widest mb-3">Key Concepts</h4>
                                                <div className="flex flex-wrap gap-2">
                                                    {selectedNode.keyConcepts.map((concept, i) => (
                                                        <span key={i} className="px-3 py-1.5 rounded-lg bg-slate-800 border border-slate-700 text-slate-300 text-xs font-medium hover:border-cyan-500/50 hover:text-cyan-400 transition-colors cursor-default">
                                                            {concept}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        <div>
                                            <h4 className="text-xs font-bold dark:text-slate-500 text-slate-400 uppercase tracking-widest mb-4">Mastery Resources</h4>
                                            <div className="space-y-3">
                                                {(selectedNode.resources && selectedNode.resources.length > 0) ? (
                                                    selectedNode.resources.map((r, i) => {
                                                        const isAlreadyInVault = (user.resources || DEFAULT_RESOURCES).some(vr => vr.url === r.link);

                                                        return (
                                                            <div key={i} className="flex flex-col gap-2 p-4 rounded-xl dark:bg-white/5 bg-slate-100 border dark:border-white/5 border-slate-200 hover:border-cyan-500 hover:shadow-lg hover:shadow-cyan-500/10 transition-all group">
                                                                <a href={r.link} target="_blank" className="flex items-start gap-4 flex-1">
                                                                    <div className={`mt-0.5 p-2 rounded-lg bg-black/40 ${getResourceColor(r.type)}`}>
                                                                        <Icon name={getResourceIcon(r.type)} size={16} />
                                                                    </div>
                                                                    <div className="flex-1 text-left">
                                                                        <div className="text-sm font-bold dark:text-slate-200 text-slate-800 group-hover:text-cyan-400 transition-colors mb-1">{r.title}</div>
                                                                        <div className="text-[10px] uppercase font-bold tracking-wider opacity-50 dark:text-slate-400 text-slate-500">{r.type || 'Read'}</div>
                                                                    </div>
                                                                    <Icon name="external-link" size={14} className="text-slate-600 dark:text-slate-500 group-hover:text-cyan-400" />
                                                                </a>
                                                                <button
                                                                    onClick={(e) => { e.preventDefault(); if (!isAlreadyInVault) handleAddToVault(r); }}
                                                                    className={`flex items-center justify-center gap-2 py-2 px-3 rounded-lg text-[9px] font-black transition-all uppercase tracking-widest mt-2 
                                                                        ${isAlreadyInVault
                                                                            ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 cursor-default'
                                                                            : 'bg-white/5 hover:bg-cyan-500/10 text-slate-500 hover:text-cyan-400 border border-transparent hover:border-cyan-500/20'}`}
                                                                >
                                                                    <Icon name={isAlreadyInVault ? "check-circle" : "plus-circle"} size={12} />
                                                                    {isAlreadyInVault ? "In Data Vault" : "Add to Data Vault"}
                                                                </button>
                                                            </div>
                                                        );
                                                    })
                                                ) : (
                                                    <div className="text-center py-8 border border-dashed dark:border-white/10 border-slate-300 rounded-xl">
                                                        <span className="text-xs text-slate-500">No resources available.</span>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-auto pt-6 border-t dark:border-white/10 border-slate-200 bg-gradient-to-t from-[#0a0a0c] to-transparent">
                                        <button
                                            onClick={() => toggleStatus(selectedNode)}
                                            className={`w-full py-4 rounded-xl font-bold uppercase tracking-widest text-xs flex items-center justify-center gap-2 transition-all shadow-lg
                                                ${(userProgress[roadmapId] && userProgress[roadmapId][selectedNode.id] === 'mastered')
                                                    ? 'bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20'
                                                    : 'bg-gradient-to-r from-cyan-600 to-blue-600 text-white hover:shadow-cyan-500/30 border border-cyan-500/50 hover:scale-[1.02]'}`}
                                        >
                                            {(userProgress[roadmapId] && userProgress[roadmapId][selectedNode.id] === 'mastered') ? (
                                                <>
                                                    <Icon name="x-circle" size={16} /> Mark Incomplete
                                                </>
                                            ) : (
                                                <>
                                                    <Icon name="check-circle" size={16} /> Mark as Complete
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </motion.div>
                            </>
                        )}
                    </AnimatePresence>
                </div>
            );
        };



        const RoadmapHub = ({ user, update }) => {
            const [view, setView] = useState('hub');
            const [activeId, setActiveId] = useState(null);

            const updateProgress = (mapId, progress) => {
                update({ ...user, roadmapProgress: { ...(user.roadmapProgress || {}), [mapId]: progress } });
            };

            if (view === 'roadmap' && activeId) {
                return (
                    <RoadmapRenderer
                        roadmapId={activeId}
                        onBack={() => setView('hub')}
                        user={user}
                        update={update}
                        userProgress={user.roadmapProgress || {}}
                        updateUserProgress={updateProgress}
                    />
                );
            }

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="flex items-end justify-between border-b border-white/5 pb-6">
                        <div>
                            <h2 className="text-4xl font-bold dark:text-white text-slate-900 tracking-tight">Roadmap Engine</h2>
                            <p className="dark:text-slate-400 text-slate-600 mt-2 font-mono text-xs">CHOOSE YOUR CAREER PATHWAY</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {Object.values(ROADMAP_MASTER_DATA).map(map => (
                            <div
                                key={map.id}
                                onClick={() => { setActiveId(map.id); setView('roadmap'); }}
                                className="group relative h-64 dark:bg-[#0a0a0f] bg-white border dark:border-white/10 border-slate-200 rounded-2xl overflow-hidden cursor-pointer hover:border-brand-500/50 transition-all duration-300 hover:shadow-[0_0_30px_rgba(var(--brand-500),0.15)] light:shadow-sm"
                            >
                                <div className="absolute top-0 right-0 w-full h-full bg-gradient-to-br from-brand-500/5 to-transparent group-hover:from-brand-500/10 transition-colors pointer-events-none"></div>
                                <div className="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t dark:from-black from-slate-100/50 to-transparent"></div>

                                <div className="absolute inset-0 p-6 flex flex-col">
                                    <div>
                                        <div className="mb-4 w-12 h-12 rounded-xl overflow-hidden border dark:border-white/10 border-slate-200 group-hover:scale-110 transition-transform">
                                            <img src={map.image} alt={map.title} className="w-full h-full object-cover" />
                                        </div>
                                        <h3 className="text-xl font-bold dark:text-white text-slate-900 mb-1">{map.title}</h3>
                                        <p className="text-sm dark:text-slate-400 text-slate-600 line-clamp-2">{map.description}</p>
                                    </div>

                                    <div className="mt-auto flex items-center gap-2 text-xs font-mono text-brand-400 opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 duration-300">
                                        INITIALIZE PROTOCOL <Icon name="arrow-right" size={12} />
                                    </div>
                                </div>
                            </div>
                        ))}

                        {/* Coming Soon Card */}
                        <div className="h-64 border dark:border-white/5 border-slate-300 border-dashed rounded-2xl flex flex-col items-center justify-center dark:text-slate-600 text-slate-400 gap-4">
                            <Icon name="lock" size={24} />
                            <span className="text-xs font-bold uppercase tracking-widest">More Paths Locked</span>
                        </div>
                    </div>
                </div>
            );
        };


        /* --- DATA VAULT: RESOURCE MANAGEMENT SYSTEM --- */
        const Vault = ({ user, update, setTab, onPortalOpen }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [category, setCategory] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedResource, setSelectedResource] = useState(null);
            const [isAdding, setIsAdding] = useState(false);
            const [newResource, setNewResource] = useState({ title: '', category: 'learning', type: 'link', description: '', url: '', tags: '' });

            // Initialize resources from user data or defaults
            const resources = (user.resources && user.resources.length > 0) ? user.resources : DEFAULT_RESOURCES;

            const handleAddResource = () => {
                if (!newResource.title || !newResource.url) return;
                const resource = {
                    ...newResource,
                    id: Date.now(),
                    tags: newResource.tags.split(',').map(t => t.trim()).filter(t => t),
                    addedDate: new Date().toISOString().split('T')[0]
                };
                update({ ...user, resources: [resource, ...resources] });
                setIsAdding(false);
                setNewResource({ title: '', category: 'learning', type: 'link', description: '', url: '', tags: '' });
            };

            const toggleBookmark = (id) => {
                const bookmarks = user.bookmarks || [];
                const newBookmarks = bookmarks.includes(id) ? bookmarks.filter(b => b !== id) : [...bookmarks, id];
                update({ ...user, bookmarks: newBookmarks });
            };

            const categories = [
                { id: 'all', label: 'ALL RESOURCES', icon: 'layers', count: resources.length },
                { id: 'learning', label: 'LEARNING RESOURCES', icon: 'graduation-cap', count: resources.filter(r => r.category === 'learning').length },
                { id: 'programming', label: 'PROGRAMMING', icon: 'code', count: resources.filter(r => r.category === 'programming').length },
                { id: 'interview', label: 'INTERVIEW PREP', icon: 'briefcase', count: resources.filter(r => r.category === 'interview').length },
                { id: 'career', label: 'CAREER', icon: 'trending-up', count: resources.filter(r => r.category === 'career').length },
                { id: 'study', label: 'STUDY MATERIALS', icon: 'book-open', count: resources.filter(r => r.category === 'study').length },
                { id: 'tools', label: 'TOOLS & UTILITIES', icon: 'wrench', count: resources.filter(r => r.category === 'tools').length }
            ];

            const filteredResources = resources.filter(r => {
                const matchesCategory = category === 'all' || r.category === category;
                const matchesSearch = searchQuery === '' ||
                    r.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    r.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    r.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()));
                return matchesCategory && matchesSearch;
            });

            const getResourceIcon = (r) => {
                if (r.topic) return r.topic;
                switch (r.type) {
                    case 'pdf': return 'file-text';
                    case 'video': return 'play-circle';
                    case 'link': return 'link';
                    default: return 'file';
                }
            };

            const getTypeColor = (type) => {
                switch (type) {
                    case 'pdf': return 'dark:text-red-400 text-red-600';
                    case 'video': return 'dark:text-purple-400 text-purple-600';
                    case 'link': return 'dark:text-blue-400 text-blue-600';
                    default: return 'dark:text-slate-400 text-slate-600';
                }
            };

            return (
                <div className="space-y-6 animate-fade-in p-6 dark:bg-black bg-black rounded-[2.5rem] border border-white/5 relative overflow-hidden">
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(var(--brand-500),0.02),transparent_70%)] pointer-events-none"></div>
                    <div className="relative z-10 space-y-6">
                        {/* Header */}
                        <div className="flex flex-col lg:flex-row lg:items-end lg:justify-between border-b border-white/10 pb-6 gap-6">
                            <div className="flex items-center gap-4">
                                <div className="p-3 bg-brand-500/10 rounded-2xl border border-brand-500/20 shadow-[0_0_30px_rgba(var(--brand-500),0.2)] relative">
                                    <StatLogo type="vault-hero" className="w-10 h-10 text-brand-500" />
                                    <div className="absolute inset-0 bg-brand-500/20 blur-xl opacity-50"></div>
                                </div>
                                <div className="space-y-1">
                                    <h2 className="text-2xl font-black text-white tracking-tighter uppercase leading-none">DATA VAULT</h2>
                                    <div className="flex items-center gap-2">
                                        <div className="w-1 h-3 bg-brand-500 rounded-full"></div>
                                        <p className="text-slate-500 text-[9px] font-black uppercase tracking-[0.3em] leading-none">Cortex Memory Core // Restricted Access</p>
                                    </div>
                                </div>
                            </div>

                            <div className="flex items-center gap-4 flex-1 lg:max-w-md">
                                <div className="relative flex-1 group">
                                    <Icon name="search" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-600 group-focus-within:text-brand-400 transition-colors" size={16} />
                                    <input
                                        type="text"
                                        placeholder="SEARCH NEURAL ASSETS..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full bg-white/2 border border-white/5 rounded-xl py-3 pl-10 pr-4 text-[10px] font-black uppercase tracking-widest text-white outline-none focus:border-brand-500/30 focus:bg-white/5 transition-all placeholder:text-slate-700 font-mono"
                                    />
                                </div>
                                <button onClick={() => setIsAdding(true)} className="flex items-center gap-2 px-6 py-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl text-[10px] font-black uppercase tracking-widest transition-all shadow-[0_0_20px_rgba(var(--brand-600),0.2)] hover:shadow-[0_0_30px_rgba(var(--brand-500),0.4)] flex-shrink-0">
                                    <Icon name="plus" size={14} />
                                    <span>Sync Asset</span>
                                </button>
                            </div>
                        </div>

                        <AnimatePresence>
                            {isAdding && (
                                <motion.div onClick={() => setIsAdding(false)} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[110] bg-black/80 backdrop-blur-xl flex items-center justify-center p-4">
                                    <motion.div onClick={e => e.stopPropagation()} initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="w-full max-w-xl bg-[#0a0a0f] border border-white/10 rounded-[2.5rem] shadow-2xl overflow-hidden relative">
                                        <div className="absolute inset-0 bg-gradient-to-br from-brand-500/5 to-transparent pointer-events-none"></div>
                                        <div className="p-8 md:p-10 relative z-10">
                                            <div className="flex items-center justify-between mb-10 pb-6 border-b border-white/5">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-10 h-10 rounded-xl bg-brand-500/10 border border-brand-500/20 flex items-center justify-center text-brand-500">
                                                        <Icon name="plus" size={20} />
                                                    </div>
                                                    <div>
                                                        <h3 className="text-xl font-black text-white uppercase tracking-tighter">Sync New Asset</h3>
                                                        <p className="text-[9px] font-bold text-slate-500 uppercase tracking-[0.3em] mt-1">Cortex Registry // Layer 1</p>
                                                    </div>
                                                </div>
                                                <button onClick={() => setIsAdding(false)} className="flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-red-500/10 hover:text-red-500 border border-white/10 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all group">
                                                    <Icon name="arrow-left" size={14} className="group-hover:-translate-x-1 transition-transform" />
                                                    <span>Return</span>
                                                </button>
                                            </div>
                                            <div className="space-y-6">
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2">Title</label>
                                                    <input value={newResource.title} onChange={e => setNewResource({ ...newResource, title: e.target.value })} className="w-full p-4 bg-black/40 border border-white/10 rounded-xl text-white outline-none focus:border-brand-500 transition-colors" placeholder="e.g., Deep Learning Manifest" />
                                                </div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2">Category</label>
                                                        <select value={newResource.category} onChange={e => setNewResource({ ...newResource, category: e.target.value })} className="w-full p-4 bg-black/40 border border-white/10 rounded-xl text-white outline-none focus:border-brand-500 transition-colors">
                                                            {categories.filter(c => c.id !== 'all').map(c => <option key={c.id} value={c.id}>{c.label}</option>)}
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2">Format</label>
                                                        <select value={newResource.type} onChange={e => setNewResource({ ...newResource, type: e.target.value })} className="w-full p-4 bg-black/40 border border-white/10 rounded-xl text-white outline-none focus:border-brand-500 transition-colors">
                                                            <option value="link">Link</option>
                                                            <option value="pdf">PDF</option>
                                                            <option value="video">Video</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2">Resource URL</label>
                                                    <input value={newResource.url} onChange={e => setNewResource({ ...newResource, url: e.target.value })} className="w-full p-4 bg-black/40 border border-white/10 rounded-xl text-white outline-none focus:border-brand-500 transition-colors" placeholder="https://..." />
                                                </div>
                                                <div>
                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-2">Tags (comma separated)</label>
                                                    <input value={newResource.tags} onChange={e => setNewResource({ ...newResource, tags: e.target.value })} className="w-full p-4 bg-black/40 border border-white/10 rounded-xl text-white outline-none focus:border-brand-500 transition-colors" placeholder="ai, neural, tech" />
                                                </div>
                                                <div className="pt-4 flex gap-4">
                                                    <button onClick={() => setIsAdding(false)} className="flex-1 py-5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-400 transition-all">Cancel Protocol</button>
                                                    <Button onClick={handleAddResource} variant="primary" className="flex-[2] py-5 text-xs font-black" icon="plus">Register Neural Asset</Button>
                                                </div>
                                            </div>
                                        </div>
                                    </motion.div>
                                </motion.div>
                            )}

                            {selectedResource && (
                                <AnimatePresence>
                                    <motion.div onClick={() => setSelectedResource(null)} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[110] bg-black/90 backdrop-blur-2xl flex items-center justify-center p-4">
                                        <motion.div onClick={e => e.stopPropagation()} initial={{ y: 20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} className="w-full max-w-2xl bg-[#08080c] border border-white/10 rounded-[3rem] overflow-hidden shadow-[0_0_100px_rgba(0,0,0,0.8)] relative">
                                            <div className="absolute inset-0 bg-gradient-to-br from-brand-500/5 to-transparent pointer-events-none"></div>
                                            <div className="p-8 md:p-12 space-y-8">
                                                <div className="flex items-start justify-between">
                                                    <div className="flex items-center gap-6">
                                                        <div className="w-24 h-24 rounded-[2.5rem] bg-black/60 flex items-center justify-center relative group/icon shadow-2xl transition-all duration-500 hover:scale-110" style={{ color: (TOPIC_CONFIG[selectedResource.topic] || TOPIC_CONFIG.default).color, border: `1px solid ${(TOPIC_CONFIG[selectedResource.topic] || TOPIC_CONFIG.default).border}` }}>
                                                            <div className="absolute inset-0 blur-3xl rounded-full opacity-40 transition-opacity" style={{ backgroundColor: (TOPIC_CONFIG[selectedResource.topic] || TOPIC_CONFIG.default).color }}></div>
                                                            <TopicIcon topic={selectedResource.topic} size={52} className="relative z-10" />
                                                        </div>
                                                        <div className="h-16 w-px bg-white/10 mx-2"></div>
                                                        <div className="flex flex-col">
                                                            <Logo className="w-12 h-12 text-brand-500 mb-2" />
                                                            <span className="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] leading-none">Cortex Verified Protocol</span>
                                                        </div>
                                                    </div>
                                                    <button onClick={() => setSelectedResource(null)} className="flex items-center gap-3 px-6 py-3 bg-white/5 hover:bg-red-500/10 hover:text-red-500 border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 transition-all group shadow-2xl">
                                                        <Icon name="arrow-left" size={16} className="group-hover:-translate-x-1 transition-transform" />
                                                        <span>Return to Vault</span>
                                                    </button>
                                                </div>
                                                <div>
                                                    <div className="flex items-center gap-3 mb-4">
                                                        <span className="px-3 py-1 bg-brand-500/10 text-brand-400 text-[10px] font-black rounded-full border border-brand-500/20 tracking-widest uppercase">{selectedResource.category}</span>
                                                        <span className="text-slate-500 font-mono text-xs uppercase">{selectedResource.type} // {selectedResource.size || selectedResource.duration || 'Web'}</span>
                                                    </div>
                                                    <h3 className="text-2xl font-black text-white leading-tight mb-4 uppercase tracking-tighter">{selectedResource.title}</h3>
                                                    <p className="text-base text-slate-400 leading-relaxed">{selectedResource.description}</p>
                                                </div>
                                                <div className="flex flex-wrap gap-2 pt-4">
                                                    {selectedResource.tags.map(tag => (
                                                        <span key={tag} className="px-4 py-2 bg-white/5 border border-white/5 rounded-xl text-xs font-bold text-slate-300 uppercase tracking-widest">#{tag}</span>
                                                    ))}
                                                </div>
                                                <div className="pt-10 flex flex-col sm:flex-row gap-4">
                                                    {STRUCTURED_LEARNING_DATA[selectedResource.topic] ? (
                                                        <Button onClick={() => { onPortalOpen(selectedResource.topic); setSelectedResource(null); }} className="flex-1 py-7 text-xs font-black bg-brand-600 shadow-[0_0_30px_rgba(var(--brand-600),0.3)]" icon="zap">INITIALIZE LEARNING PROTOCOL // COMPLETE</Button>
                                                    ) : (
                                                        <Button onClick={() => { if (selectedResource.url && selectedResource.url !== '#') window.open(selectedResource.url, '_blank'); }} className="flex-1 py-7 text-xs font-black bg-blue-600 shadow-[0_0_30px_rgba(37,99,235,0.2)]" icon="external-link">ACCESS NEURAL ASSET // OPEN</Button>
                                                    )}
                                                    <button onClick={() => toggleBookmark(selectedResource.id)} className={`flex items-center justify-center gap-3 px-8 py-7 rounded-2xl border transition-all font-black text-[10px] uppercase tracking-widest ${user.bookmarks?.includes(selectedResource.id) ? 'bg-amber-500/20 border-amber-500 text-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.2)]' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white hover:bg-white/10'}`}>
                                                        <Icon name="bookmark" size={18} />
                                                        <span>{user.bookmarks?.includes(selectedResource.id) ? 'SAVED' : 'SAVE TO VAULT'}</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </motion.div>
                                    </motion.div>
                                </AnimatePresence>
                            )}
                        </AnimatePresence>

                        {/* Category Tabs */}
                        <div className="flex gap-2 overflow-x-auto pb-2 custom-scrollbar">
                            {categories.map(cat => (
                                <button
                                    key={cat.id}
                                    onClick={() => setCategory(cat.id)}
                                    className={`flex items-center gap-3 px-4 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest whitespace-nowrap transition-all duration-300 border ${category === cat.id
                                        ? 'bg-brand-500/10 text-brand-400 border-brand-500/30 shadow-[0_0_20px_rgba(var(--brand-500),0.1)]'
                                        : 'bg-white/2 bg-black border-white/5 text-slate-500 hover:text-slate-300 hover:border-white/10'
                                        }`}
                                >
                                    <Icon name={cat.icon} size={14} className={category === cat.id ? "text-brand-400" : "text-slate-600"} />
                                    <span>{cat.label}</span>
                                    <span className={`px-2 py-0.5 rounded-md text-[9px] font-black ${category === cat.id
                                        ? 'bg-brand-500/20 text-brand-300'
                                        : 'bg-white/5 text-slate-700'
                                        }`}>
                                        {cat.count}
                                    </span>
                                </button>
                            ))}
                        </div>

                        {/* Stats */}
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            {[
                                { label: 'TOTAL LIBRARY', value: resources.length, type: 'library', color: 'indigo', glow: 'shadow-indigo-500/20' },
                                { label: 'PROTOCOLS', value: categories.length - 1, type: 'protocols', color: 'emerald', glow: 'shadow-emerald-500/20' },
                                { label: 'VISUAL STREAMS', value: resources.filter(r => r.type === 'video').length, type: 'streams', color: 'purple', glow: 'shadow-purple-500/20' },
                                { label: 'INTEL ASSETS', value: resources.filter(r => r.type === 'pdf').length, type: 'assets', color: 'amber', glow: 'shadow-amber-500/20' }
                            ].map((stat, i) => (
                                <Card key={i} className={`bg-black/40 border-${stat.color}-500/20 hover:border-${stat.color}-500/40 transition-all p-5 relative overflow-hidden group`}>
                                    <div className={`absolute -right-4 -top-4 w-16 h-16 bg-${stat.color}-500/10 blur-2xl rounded-full group-hover:bg-${stat.color}-500/20 transition-all`}></div>
                                    <div className="flex items-center justify-between relative z-10">
                                        <div>
                                            <p className={`text-[10px] font-bold text-${stat.color}-400 uppercase tracking-[0.3em] mb-1.5 opacity-70`}>{stat.label}</p>
                                            <p className="text-xl font-black text-white uppercase tracking-tighter leading-none">{stat.value}</p>
                                        </div>
                                        <div className={`w-12 h-12 rounded-2xl bg-${stat.color}-500/10 border border-${stat.color}-500/20 flex items-center justify-center shadow-lg ${stat.glow} group-hover:scale-110 transition-transform`}>
                                            <StatLogo type={stat.type} className={`w-7 h-7 text-${stat.color}-400`} />
                                        </div>
                                    </div>
                                </Card>
                            ))}
                        </div>

                        {/* Resources Grid */}
                        <div className="pt-4">
                            <div className="flex items-center justify-between mb-6">
                                <div className="flex items-center gap-4">
                                    <h3 className="text-sm font-black text-white uppercase tracking-widest">
                                        {category === 'all' ? 'Core Assets' : categories.find(c => c.id === category)?.label}
                                    </h3>
                                    <span className="px-2 py-0.5 bg-white/5 border border-white/5 rounded text-[10px] font-black text-slate-600 uppercase tracking-tighter">{filteredResources.length} Detected</span>
                                </div>
                                <div className="flex items-center gap-2 text-[10px] font-bold text-slate-700 uppercase tracking-widest">
                                    <Icon name="filter" size={12} />
                                    <span>Sort: Chronological</span>
                                </div>
                            </div>

                            {filteredResources.length === 0 ? (
                                <Card className="text-center py-12">
                                    <Icon name="search-x" size={48} className="mx-auto dark:text-slate-600 text-slate-400 mb-4" />
                                    <p className="dark:text-slate-400 text-slate-600">No resources found matching your search</p>
                                </Card>
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {filteredResources.map(resource => {
                                        const config = TOPIC_CONFIG[resource.topic] || TOPIC_CONFIG.default;
                                        return (
                                            <Card key={resource.id} onClick={() => setSelectedResource(resource)}
                                                className="cursor-pointer group relative overflow-hidden transition-all duration-500 bg-white/2 hover:bg-white/5 border-white/5 hover:border-brand-500/30 shadow-2xl"
                                                style={{ '--topic-color': config.color }}>
                                                <div className="absolute inset-0 bg-gradient-to-br from-[var(--topic-color)] to-transparent opacity-0 group-hover:opacity-5 transition-opacity duration-500"></div>
                                                {user.bookmarks?.includes(resource.id) && <div className="absolute top-4 right-4 text-amber-500 z-10"><Icon name="bookmark" size={14} className="fill-amber-500" /></div>}
                                                <div className="flex items-start gap-4 mb-5 relative z-10">
                                                    <div className="w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 transition-all duration-500 group-hover:scale-110 shadow-2xl relative"
                                                        style={{ color: config.color, backgroundColor: config.bg, border: `1px solid ${config.border}` }}>
                                                        <div className="absolute inset-0 blur-xl opacity-20 group-hover:opacity-40 transition-opacity" style={{ backgroundColor: config.color }}></div>
                                                        <TopicIcon topic={resource.topic} size={28} className="relative z-10" />
                                                    </div>
                                                    <div className="flex-1 min-w-0 pt-1">
                                                        <h4 className="font-black dark:text-white text-slate-900 mb-1.5 truncate group-hover:text-brand-500 transition-colors uppercase tracking-tight text-[13px]" style={{ color: config.color }}>{resource.title}</h4>
                                                        <p className="text-[10px] dark:text-slate-500 text-slate-600 line-clamp-2 leading-relaxed font-bold uppercase tracking-widest opacity-80">{resource.description}</p>
                                                    </div>
                                                </div>

                                                <div className="flex flex-wrap gap-1.5 mb-5 relative z-10">
                                                    {resource.tags.slice(0, 3).map(tag => (
                                                        <span key={tag} className="px-2 py-1 text-[8px] font-black uppercase tracking-[0.1em] rounded bg-white/5 text-slate-500 border border-white/5">
                                                            {tag}
                                                        </span>
                                                    ))}
                                                </div>

                                                <div className="flex items-center justify-between text-[9px] font-black text-slate-600 pt-4 border-t border-white/5 uppercase tracking-[0.2em] relative z-10">
                                                    <span className="flex items-center gap-2"><Icon name="hard-drive" size={10} /> {resource.size || resource.duration || 'SECURE LINK'}</span>
                                                    <div className="flex items-center gap-4">
                                                        <span className="group-hover:text-brand-400 transition-colors">ACCESS PROTOCOL</span>
                                                        <Icon name="arrow-right" size={10} className="group-hover:translate-x-1 transition-transform" />
                                                    </div>
                                                </div>
                                            </Card>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };


        /* --- UNIFIED LEARNING PORTAL: 6-PAGE INTERACTIVE SYSTEM --- */
        const UnifiedLearningPortal = ({ topicId, onBack, user, update }) => {
            const { motion, AnimatePresence } = window.Motion;
            const data = STRUCTURED_LEARNING_DATA[topicId];
            const [currentModuleIndex, setCurrentModuleIndex] = useState(0);
            const [completedModules, setCompletedModules] = useState(user.topicProgress?.[topicId] || []);

            if (!data) return (
                <div className="flex flex-col items-center justify-center p-20 text-center space-y-6">
                    <Icon name="alert-triangle" size={64} className="text-amber-500 animate-pulse" />
                    <h3 className="text-2xl font-black text-white uppercase tracking-tighter">Protocol Data Missing</h3>
                    <p className="text-slate-400 max-w-md">The requested neural node "{topicId}" has not been indexed in the Structured Learning Core.</p>
                    <Button onClick={onBack} variant="secondary">Return to Safety</Button>
                </div>
            );

            const modules = data.modules || [];
            const currentModule = modules[currentModuleIndex] || {};
            const isLastModule = currentModuleIndex === modules.length - 1;

            const handleNext = () => {
                const newCompleted = [...new Set([...completedModules, currentModuleIndex])];
                setCompletedModules(newCompleted);

                update({
                    ...user,
                    topicProgress: {
                        ...(user.topicProgress || {}),
                        [topicId]: newCompleted
                    }
                });

                if (!isLastModule) {
                    setCurrentModuleIndex(currentModuleIndex + 1);
                }
            };

            return (
                <div className="fixed inset-0 z-[1000] bg-[#020205] text-slate-300 font-sans flex flex-col animate-fade-in text-base">
                    {/* Header */}
                    <div className="h-20 border-b border-white/5 flex items-center justify-between px-8 bg-black/40 backdrop-blur-md shrink-0">
                        <div className="flex items-center gap-6">
                            <button onClick={onBack} className="p-3 bg-white/5 hover:bg-red-500/10 hover:text-red-500 rounded-xl text-slate-400 transition-all border border-white/5 group">
                                <Icon name="arrow-left" size={20} className="group-hover:-translate-x-1 transition-transform" />
                            </button>
                            <div>
                                <h2 className="text-xl font-black text-white uppercase tracking-tighter flex items-center gap-3">
                                    <TopicIcon topic={topicId} size={24} />
                                    {data.title}
                                    {data.certification && (
                                        <div className="flex items-center gap-2 px-3 py-1 bg-amber-500/10 border border-amber-500/20 rounded-full ml-4">
                                            <Icon name="award" size={14} className="text-amber-500" />
                                            <span className="text-[10px] font-black text-amber-500 uppercase tracking-wide">{data.certification.name}</span>
                                        </div>
                                    )}
                                </h2>
                                <div className="flex items-center gap-3 mt-1 text-[10px] font-bold uppercase tracking-widest text-slate-500">
                                    <span className="text-brand-500">Module {currentModuleIndex + 1} of {modules.length}</span>
                                    <span className="w-1 h-1 rounded-full bg-slate-700"></span>
                                    <span>{currentModule.title}</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="hidden md:block text-right">
                                <div className="text-[10px] font-black text-emerald-500 uppercase tracking-widest animate-pulse">Live Connection</div>
                                <div className="text-[10px] font-bold text-slate-600 uppercase tracking-widest">Latency: 12ms</div>
                            </div>
                            <div className="w-12 h-12 rounded-full border-2 border-emerald-500/20 flex items-center justify-center bg-emerald-500/10 text-emerald-500">
                                <Icon name="wifi" size={20} />
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 flex overflow-hidden">
                        {/* Sidebar: Curriculum */}
                        <div className="w-80 border-r border-white/5 bg-black/20 hidden lg:flex flex-col overflow-y-auto custom-scrollbar">
                            <div className="p-6 space-y-8">
                                <div>
                                    <h4 className="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-6 pl-2">Curriculum Map</h4>
                                    <div className="space-y-2">
                                        {modules.map((m, i) => {
                                            const isCompleted = completedModules.includes(i);
                                            const isActive = currentModuleIndex === i;
                                            return (
                                                <button
                                                    key={i}
                                                    onClick={() => setCurrentModuleIndex(i)}
                                                    className={`w-full text-left p-4 rounded-xl border transition-all group relative overflow-hidden ${isActive ? 'bg-brand-500/10 border-brand-500/30 text-white' : 'border-transparent hover:bg-white/5 text-slate-500'}`}
                                                >
                                                    <div className="flex items-center gap-4 relative z-10">
                                                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold transition-colors ${isActive ? 'bg-brand-500 text-white' : isCompleted ? 'bg-emerald-500/10 text-emerald-500' : 'bg-white/5 group-hover:bg-white/10'}`}>
                                                            {isCompleted ? <Icon name="check" size={14} /> : i + 1}
                                                        </div>
                                                        <div className="flex-1 min-w-0">
                                                            <p className={`text-[11px] font-bold uppercase tracking-tight truncate ${isActive ? 'text-brand-100' : 'text-slate-400'}`}>{m.title}</p>
                                                        </div>
                                                    </div>
                                                    {isActive && <div className="absolute inset-y-0 left-0 w-1 bg-brand-500"></div>}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="flex-1 overflow-y-auto custom-scrollbar relative bg-[radial-gradient(circle_at_50%_0%,rgba(var(--brand-500),0.03),transparent_70%)]">
                            <div className="max-w-4xl mx-auto py-16 px-8 space-y-16 pb-32">
                                <AnimatePresence mode="wait">
                                    <motion.div
                                        key={currentModuleIndex}
                                        initial={{ opacity: 0, y: 10 }}
                                        animate={{ opacity: 1, y: 0 }}
                                        exit={{ opacity: 0, y: -10 }}
                                        transition={{ duration: 0.2 }}
                                    >
                                        {/* Module Title */}
                                        <div className="space-y-6 text-center md:text-left">
                                            <span className="inline-block px-4 py-1.5 bg-brand-500/10 border border-brand-500/20 text-brand-400 text-[10px] font-black uppercase tracking-[0.3em] rounded-full">
                                                Phase {currentModuleIndex + 1} Protocol
                                            </span>
                                            <h1 className="text-4xl md:text-5xl font-black text-white tracking-tighter uppercase leading-none">
                                                {currentModule.title}
                                            </h1>
                                            <p className="text-xl text-slate-400 leading-relaxed font-medium max-w-2xl">
                                                {currentModule.description}
                                            </p>
                                        </div>

                                        <div className="h-px bg-gradient-to-r from-transparent via-white/10 to-transparent my-12"></div>

                                        {/* Reference Concepts (Sections) */}
                                        <div className="space-y-12">
                                            {currentModule.sections?.map((section, idx) => (
                                                <div key={idx} className="group">
                                                    <div className="flex items-start gap-4 mb-4">
                                                        <Icon name="chevron-right" className="text-brand-500 mt-1.5 group-hover:translate-x-1 transition-transform" />
                                                        <h3 className="text-2xl font-bold text-white uppercase tracking-tight">{section.title}</h3>
                                                    </div>
                                                    <div className="pl-10 text-lg text-slate-400 leading-relaxed border-l-2 border-white/5 group-hover:border-brand-500/30 transition-colors py-1">
                                                        {section.body}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* Practical Examples */}
                                        {currentModule.practical && (
                                            <div className="mt-20">
                                                <div className="flex items-center gap-4 mb-8">
                                                    <div className="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-500">
                                                        <Icon name="terminal" size={20} />
                                                    </div>
                                                    <h3 className="text-2xl font-black text-white uppercase tracking-widest">Practical Application</h3>
                                                </div>
                                                <div className="grid gap-8">
                                                    {currentModule.practical.snippets?.map((snippet, idx) => (
                                                        <div key={idx} className="rounded-2xl overflow-hidden border border-white/10 bg-[#0a0a0c] shadow-2xl">
                                                            <div className="px-6 py-3 bg-white/5 border-b border-white/5 flex justify-between items-center">
                                                                <span className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                                                    <Icon name="code" size={14} /> {snippet.title}
                                                                </span>
                                                                <span className="text-[10px] font-mono text-emerald-500 bg-emerald-500/10 px-2 py-1 rounded">{snippet.lang}</span>
                                                            </div>
                                                            <div className="p-6 overflow-x-auto relative group">
                                                                <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                    <Button variant="secondary" className="!py-1 !px-3 !text-[10px]" icon="copy">Copy</Button>
                                                                </div>
                                                                <pre className="text-sm font-mono text-emerald-400/90 leading-relaxed">
                                                                    <code>{snippet.code}</code>
                                                                </pre>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* Knowledge Check */}
                                        {currentModule.quiz && (
                                            <div className="mt-20 p-1 md:p-8 rounded-[2.5rem] bg-gradient-to-br from-brand-900/10 to-transparent border border-brand-500/20 relative overflow-hidden">
                                                <div className="absolute top-0 right-0 p-10 opacity-5 pointer-events-none"><Icon name="brain" size={200} /></div>
                                                <div className="relative z-10 p-6 md:p-8">
                                                    <h3 className="text-xl font-black text-white uppercase tracking-widest mb-8 flex items-center gap-3">
                                                        <Icon name="activity" className="text-brand-500" /> Neural Verification
                                                    </h3>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                        {currentModule.quiz.map((q, idx) => (
                                                            <div key={idx} className="p-6 rounded-3xl bg-black/40 border border-white/10 hover:border-brand-500/50 transition-all group backdrop-blur-sm">
                                                                <p className="text-sm font-bold text-white mb-6 leading-relaxed bg-white/5 p-4 rounded-xl border border-white/5">{q.question}</p>
                                                                <div className="space-y-2">
                                                                    {q.options.map((opt, oi) => (
                                                                        <button key={oi} className="w-full text-left px-5 py-3 rounded-xl bg-white/5 text-xs text-slate-400 hover:bg-white/10 hover:text-white transition-colors flex items-center gap-3 group/opt">
                                                                            <div className="w-4 h-4 rounded-full border border-slate-600 group-hover/opt:border-brand-500 group-hover/opt:bg-brand-500 transition-all"></div>
                                                                            {opt}
                                                                        </button>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Navigation Footer */}
                                        <div className="mt-24 flex items-center justify-end border-t border-white/5 pt-12">
                                            <Button
                                                onClick={handleNext}
                                                variant="primary"
                                                className="px-12 py-6 text-xs font-black shadow-[0_0_50px_rgba(var(--brand-500),0.3)] rounded-2xl hover:scale-105 active:scale-95 transition-all"
                                                icon={isLastModule ? "check-circle" : "arrow-right"}
                                            >
                                                {isLastModule ? "COMPLETE FULL PROTOCOL" : "MARK COMPLETE & CONTINUE"}
                                            </Button>
                                        </div>

                                    </motion.div>
                                </AnimatePresence>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };


        /* --- HR PROTOCOL: ROLE-BASED LEARNING & SOP HUB --- */
        const HRPrep = ({ user, update, log, onPortalOpen }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [view, setView] = useState('dashboard');
            const [selectedPath, setSelectedPath] = useState(null);
            const [selectedModule, setSelectedModule] = useState(null);
            const [selectedSOP, setSelectedSOP] = useState(null);
            const [verifiedSOPs, setVerifiedSOPs] = useState(user.verifiedSOPs || []);
            const [aiQuestion, setAiQuestion] = useState('');
            const [aiResponse, setAiResponse] = useState(null);
            const [isConsulting, setIsConsulting] = useState(false);

            const consultCortex = () => {
                if (!aiQuestion) return;
                setAiResponse("Consulting neural substrate... [SEARCHING]");

                setTimeout(() => {
                    let response = "I don't have specific data on that in this SOP. However, standard protocol suggests maintaining SOC2 compliance.";
                    const q = aiQuestion.toLowerCase();

                    if (selectedSOP) {
                        const contentString = (selectedSOP.steps || []).join(" ").toLowerCase();
                        const foundStep = (selectedSOP.steps || []).find(s => s.toLowerCase().includes(q));

                        if (foundStep) {
                            response = `Relevant directive found: "${foundStep}" - This is a mandatory requirement for ${selectedSOP.code} sync progress.`;
                        } else if (q.includes("safety") || q.includes("secure") || q.includes("protect")) {
                            response = `According to ${selectedSOP.code}, security is the primary directive. This protocol specifically covers ${selectedSOP.category} aspects and mandates strict adherence to the defined procedures.`;
                        } else if (q.includes("version") || q.includes("update") || q.includes("new")) {
                            response = `This protocol (${selectedSOP.code}) is currently at version ${selectedSOP.version} and was recently verified as stable and fully active in the production environment.`;
                        } else if (q.includes("who") || q.includes("lead") || q.includes("own")) {
                            response = `Ownership of the ${selectedSOP.title} protocol lies with the Lead System Architect and the Compliance Oversight Committee.`;
                        } else if (q.includes("emergency") || q.includes("fast") || q.includes("quick")) {
                            response = `In cases of high-velocity emergencies, cross-reference this with SOP-OPS-777 (Incident Response Alpha) for the immediate escalation chain.`;
                        } else if (q.includes("steps") || q.includes("procedure") || q.includes("how")) {
                            response = `The procedure involves ${selectedSOP.steps?.length || 0} primary steps, focusing on ${selectedSOP.category} standards. Please review the main document pane for the full sequence.`;
                        }
                    }

                    setAiResponse(response);
                }, 1200);
            };

            const LEARNING_PATHS = [
                {
                    id: 'sql-dsa',
                    topic: 'sql-dsa',
                    title: 'SQL Mastery & DSA',
                    description: 'Optimize queries for scale using advanced data structures. B-Trees, Execution Plans, and Relational Algebra.',
                    category: 'Core Engineering',
                    difficulty: 'Advanced',
                    estimatedHours: 35,
                    icon: 'database',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                },
                {
                    id: 'sys-design-primer',
                    topic: 'sys-design-primer',
                    title: 'System Design Primer',
                    description: 'Foundational concepts for building global architecture. Availability, CAP Theorem, and Load Balancing.',
                    category: 'Architecture',
                    difficulty: 'Intermediate',
                    estimatedHours: 20,
                    icon: 'layout',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                },
                {
                    id: 'sys-design',
                    topic: 'sys-design',
                    title: 'Systems Design & Scalability',
                    description: 'Deep dive into sharding, replication, and distributed consensus. Master the art of the 100M user scale.',
                    category: 'Architecture',
                    difficulty: 'Expert',
                    estimatedHours: 45,
                    icon: 'layers',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                },
                {
                    id: 'js-arch',
                    topic: 'js-arch',
                    title: 'JavaScript Systems Architecture',
                    description: 'V8 internals, Event Loop orchestration, and memory-safe enterprise JS design patterns.',
                    category: 'Core Engineering',
                    difficulty: 'Expert',
                    estimatedHours: 40,
                    icon: 'cpu',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                },
                {
                    id: 'interview-protocol',
                    topic: 'interview-protocol',
                    title: 'Executive Interview Protocol',
                    description: 'STAR+ method, psychological leverage, and strategic negotiation for senior/lead positions.',
                    category: 'Professional',
                    difficulty: 'Elite',
                    estimatedHours: 15,
                    icon: 'briefcase',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                },
                {
                    id: 'resume-template',
                    topic: 'resume-template',
                    title: 'Modern Resume Template',
                    description: 'ATS-optimized, impact-driven resume engineering using the Z-pattern and Google Bullet method.',
                    category: 'Professional',
                    difficulty: 'Elite',
                    estimatedHours: 10,
                    icon: 'file-text',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                },
                {
                    id: 'company-culture',
                    topic: 'company-culture',
                    title: 'Neural Culture & Values',
                    description: 'The ideological backbone of Velosify. Understanding the mission of cognitive elevation and human-machine synergy.',
                    category: 'Corporate',
                    difficulty: 'Beginner',
                    estimatedHours: 5,
                    icon: 'flame',
                    modules: [{ id: 'core', title: 'Start Protocol' }]
                }
            ];

            const SOP_DATA = [
                {
                    id: 's1', topic: 'hr', title: 'System Security Protocol', code: 'SOP-SEC-001', category: 'Security', version: '4.0',
                    description: 'Mandatory encryption and access control standards for all production environments.',
                    steps: [
                        "Verify Multi-Factor Authentication (MFA) is active on all gateway entry points.",
                        "Audit access logs for any unauthorized neural sync attempts within the last 24 cycles.",
                        "Ensure all data in transit is encrypted using AES-256 protocols.",
                        "Rotate encryption keys if any breach of the outer perimeter is detected."
                    ]
                },
                {
                    id: 's2', topic: 'hr', title: 'Data Privacy Standards', code: 'SOP-DATA-092', category: 'Compliance', version: '1.2',
                    description: 'GDPR and SOC2 compliance monitoring and reporting frequency.',
                    steps: [
                        "Anonymize all user metadata stored in the primary neural database.",
                        "Execute quarterly data deletion protocols for accounts inactive for >365 days.",
                        "Document all data processing activities for the annual SOC2 audit.",
                        "Validate that third-party integrations adhere to the same privacy tier as the core system."
                    ]
                },
                {
                    id: 's3', topic: 'hr', title: 'Engineering Onboarding', code: 'SOP-ENG-005', category: 'HR', version: '2.5',
                    description: 'Standard environment setup and PR review guidelines for new recruits.',
                    steps: [
                        "Provision the developer neural interface and establish the initial workspace symlink.",
                        "Sync the global Git configuration and establish access to the private repository network.",
                        "Review the 'Coding Standards' manifesto and complete the basic security clearance test.",
                        "Submit the first 'Hello World' PR to verify integration with the CI/CD pipeline."
                    ]
                },
                {
                    id: 's4', topic: 'hr', title: 'Incident Response Alpha', code: 'SOP-OPS-777', category: 'Operations', version: '3.1',
                    description: 'Tier-1 critical system failure communication and escalation chain.',
                    steps: [
                        "Immediately trigger the SILENT ALARM to alert the on-call Command Oversight.",
                        "Downgrade all non-essential services to 'Maintenance' mode to preserve core bandwidth.",
                        "Establish a secure war-room channel on the localized bridge.",
                        "Initiate automated diagnostics to identify the source of the system anomaly."
                    ]
                },
                {
                    id: 's5', topic: 'hr', title: 'Remote Access VPN', code: 'SOP-NET-012', category: 'Security', version: '2.0',
                    description: 'Zero-trust network access requirements for non-office personnel.',
                    steps: [
                        "Initialize the secure tunnel using the approved Zero-Trust client.",
                        "Perform a device integrity scan before establishing the link to the internal mesh.",
                        "Authenticate through the biometric verification gate.",
                        "Ensure all session data is routed through the regional security cluster."
                    ]
                },
                {
                    id: 's6', topic: 'hr', title: 'Neural Link Safety', code: 'SOP-BIO-009', category: 'Biometrics', version: '1.0',
                    description: 'Standards for maintaining safe cognitive load during deep focus sessions.',
                    steps: [
                        "Monitor cognitive drain levels using the integrated telemetry sensors.",
                        "Enforce a 5-minute 'Cool Down' period after 90 minutes of high-velocity work.",
                        "Recalibrate the neural interface if focus jitter exceeds defined thresholds.",
                        "Maintain hydration levels as specified in the biological maintenance protocol."
                    ]
                },
                {
                    id: 's7', topic: 'hr', title: 'Emergency Shutdown Alpha', code: 'SOP-SYS-999', category: 'Critical', version: '5.2',
                    description: 'Immediate termination of all external network links and data vaults.',
                    steps: [
                        "Broadcast the SHUTDOWN signal to all subordinate system nodes.",
                        "Immediately sever all external fiber links and satellite uplinks.",
                        "Flush volatile memory buffers to the cold-storage vault.",
                        "Wait for the 'All Clear' physical verification before system re-initiation."
                    ]
                },
                {
                    id: 's8', topic: 'hr', title: 'Code Deployment Delta', code: 'SOP-DEPL-044', category: 'DevOps', version: '2.8',
                    description: 'Blue-green deployment strategy and automated rollback triggers.',
                    steps: [
                        "Deploy the new build candidate to the 'Green' environment slot.",
                        "Run automated smoke tests and health checks against the Green cluster.",
                        "Switch the global load balancer traffic to the Green environment (10% -> 50% -> 100%).",
                        "Monitor error rates for 15 minutes; trigger ROLLBACK if failure rate > 0.5%."
                    ]
                }
            ];

            const handleModuleComplete = (pathId, moduleId) => {
                const currentProgress = user.learningProgress || {};
                const pathProgress = currentProgress[pathId] || [];
                if (!pathProgress.includes(moduleId)) {
                    update({
                        ...user,
                        learningProgress: {
                            ...currentProgress,
                            [pathId]: [...pathProgress, moduleId]
                        }
                    });
                    log();
                }
                setSelectedModule(null);
            };

            const DashboardView = () => (
                <div className="space-y-10 animate-fade-in content-fade-in">
                    <div className="flex flex-col md:flex-row md:items-end md:justify-between border-b dark:border-white/5 border-slate-200 pb-8 gap-6">
                        <div className="flex items-center gap-6">
                            <div className="p-4 bg-brand-500/10 rounded-2xl border border-brand-500/20 shadow-[0_0_40px_rgba(var(--brand-500),0.2)] relative group">
                                <StatLogo type="hr-hero" className="w-10 h-10 text-brand-500" />
                                <div className="absolute -top-1 -right-1 w-3 h-3 bg-emerald-500 rounded-full border-2 border-black animate-pulse"></div>
                            </div>
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <span className="px-3 py-1 bg-brand-500/10 text-brand-400 text-[10px] font-black tracking-[0.2em] rounded-md border border-brand-500/20">OPERATIONAL SECURITY</span>
                                </div>
                                <h2 className="text-xl font-bold dark:text-white text-slate-900 tracking-tight uppercase leading-none">HR PROTOCOL</h2>
                                <p className="dark:text-slate-500 text-slate-600 mt-3 text-[10px] font-bold uppercase tracking-widest leading-none">Your digitized career enablement and administrative hub.</p>
                            </div>
                        </div>
                        <div className="flex gap-4">
                            <button onClick={() => setView('sop-hub')} className="flex items-center gap-3 px-6 py-4 dark:bg-white/5 bg-white border dark:border-white/10 border-slate-200 rounded-2xl text-[10px] font-black tracking-widest text-slate-400 hover:text-brand-500 hover:border-brand-500 transition-all shadow-xl group">
                                <Icon name="book-open" size={18} className="group-hover:scale-110 transition-transform" />
                                SOP LIBRARY
                            </button>
                        </div>
                    </div>

                    {/* Quick Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        {[
                            { label: 'Paths Active', value: LEARNING_PATHS.length, type: 'paths', text: 'text-indigo-400', bg: 'bg-indigo-500/10', border: 'border-indigo-500/20', glow: 'shadow-indigo-500/20' },
                            { label: 'Modules Verified', value: Object.values(user.learningProgress || {}).flat().length, type: 'modules', text: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20', glow: 'shadow-emerald-500/20' },
                            { label: 'Study Velocity', value: 'High', type: 'velocity', text: 'text-amber-400', bg: 'bg-amber-500/10', border: 'border-amber-500/20', glow: 'shadow-amber-500/20' },
                            { label: 'SOP Compliance', value: `${Math.round((verifiedSOPs.length / SOP_DATA.length) * 100)}%`, type: 'compliance', text: 'text-blue-400', bg: 'bg-blue-500/10', border: 'border-blue-500/20', glow: 'shadow-blue-500/20' }
                        ].map((stat, i) => (
                            <Card key={i} className={cn("group hover:border-brand-500 transition-all border-b-2 bg-black/40 relative overflow-hidden", stat.border)}>
                                <div className={`absolute -right-4 -top-4 w-16 h-16 bg-${stat.color || 'brand'}-500/10 blur-2xl rounded-full group-hover:bg-brand-500/20 transition-all`}></div>
                                <div className="flex items-center justify-between relative z-10">
                                    <div>
                                        <p className="text-[10px] font-bold dark:text-slate-500 text-slate-400 uppercase tracking-[0.2em] mb-1">{stat.label}</p>
                                        <p className="text-2xl font-bold dark:text-white text-slate-900 leading-none">{stat.value}</p>
                                    </div>
                                    <div className={cn("w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transition-transform group-hover:scale-110", stat.bg, stat.text, stat.glow)}>
                                        <StatLogo type={stat.type} className="w-7 h-7" />
                                    </div>
                                </div>
                            </Card>
                        ))}
                    </div>

                    {/* Primary Content Sections */}
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        {/* Learning Modules */}
                        <div className="lg:col-span-8 space-y-8">
                            <div className="flex items-center justify-between">
                                <h3 className="text-lg font-bold dark:text-white text-slate-900 flex items-center gap-3">
                                    <div className="w-1 h-5 bg-brand-500 rounded-full"></div>
                                    ACTIVE LEARNING PATHS
                                </h3>
                            </div>

                            <div className="grid grid-cols-1 gap-6">
                                {LEARNING_PATHS.map(path => {
                                    const completed = (user.learningProgress?.[path.id] || []).length;
                                    const total = path.modules.length;
                                    const percent = Math.round((completed / total) * 100);

                                    return (
                                        <div key={path.id} onClick={() => { setSelectedPath(path); setView('learning-path'); }} className="dark:bg-[#0a0a10] bg-white border dark:border-white/5 border-slate-200 rounded-[2rem] p-8 cursor-pointer group hover:border-brand-500 transition-all relative overflow-hidden shadow-sm">
                                            <div className="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity"><Icon name={path.icon} size={100} /></div>
                                            <div className="flex flex-col md:flex-row md:items-center gap-8">
                                                <div className="w-16 h-16 rounded-2xl dark:bg-black/50 bg-slate-50 flex items-center justify-center relative group-hover:bg-brand-500 group-hover:text-white transition-all shadow-xl border dark:border-white/10 border-slate-200">
                                                    <div className="absolute inset-0 bg-brand-500/10 blur-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                    <TopicIcon topic={path.topic} size={32} className="relative z-10" />
                                                </div>
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-3 mb-2">
                                                        <span className="px-2 py-0.5 dark:bg-white/5 bg-slate-100 text-[9px] font-black dark:text-slate-400 text-slate-500 uppercase tracking-widest rounded">{path.category}</span>
                                                        <span className="px-2 py-0.5 dark:bg-white/5 bg-slate-100 text-[9px] font-black dark:text-slate-400 text-slate-500 uppercase tracking-widest rounded">{path.difficulty}</span>
                                                    </div>
                                                    <h4 className="text-base font-bold dark:text-white text-slate-900 group-hover:text-brand-500 transition-colors tracking-tight uppercase">{path.title}</h4>
                                                    <p className="text-[11px] dark:text-slate-500 text-slate-600 mt-1.5 max-w-lg font-medium leading-relaxed">{path.description}</p>
                                                </div>
                                                <div className="w-full md:w-48 space-y-3">
                                                    <div className="flex justify-between items-center text-[10px] font-black uppercase tracking-widest">
                                                        <span className="dark:text-slate-500 text-slate-400">Mastery</span>
                                                        <span className="dark:text-white text-slate-900 font-black">{percent}%</span>
                                                    </div>
                                                    <div className="h-2 w-full dark:bg-white/5 bg-slate-100 rounded-full overflow-hidden">
                                                        <div className="h-full bg-brand-500 rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(var(--brand-500),0.5)]" style={{ width: `${percent}%` }}></div>
                                                    </div>
                                                    <div className="text-[9px] font-black dark:text-slate-500 text-slate-400 uppercase tracking-[0.2em]">{completed} / {total} MODULES VERIFIED</div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Sidebar Assist */}
                        <div className="lg:col-span-4 space-y-6">
                            <Card className="dark:!bg-brand-500/5 bg-brand-50 border-brand-500/20 p-8">
                                <h3 className="text-xs font-black text-brand-500 uppercase tracking-[0.3em] mb-6 flex items-center gap-2">
                                    <Icon name="award" size={16} /> RECENT ACHIEVEMENTS
                                </h3>
                                <div className="space-y-6">
                                    {[
                                        { title: 'Neural Pioneer', desc: 'Completed first module', icon: 'zap' },
                                        { title: 'Security Clear', desc: 'Read all SOPs', icon: 'shield' }
                                    ].map((ach, i) => (
                                        <div key={i} className="flex gap-4">
                                            <div className="w-10 h-10 rounded-xl dark:bg-white/5 bg-white border dark:border-white/10 border-slate-200 flex items-center justify-center text-brand-400 shadow-sm"><Icon name={ach.icon} size={18} /></div>
                                            <div>
                                                <p className="text-sm font-black dark:text-white text-slate-900 uppercase tracking-tight">{ach.title}</p>
                                                <p className="text-[10px] font-bold dark:text-slate-500 text-slate-400 uppercase tracking-widest mt-0.5">{ach.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </Card>

                            <Card className="p-8 dark:bg-surface-900 bg-white border-dashed border-2 dark:border-white/10 border-slate-200 text-center">
                                <Icon name="layout-grid" className="mx-auto text-slate-500 mb-4" size={32} />
                                <h4 className="text-sm font-black dark:text-white text-slate-900 uppercase tracking-widest mb-2 text-center">MORE CONTENT PENDING</h4>
                                <p className="text-[10px] font-bold dark:text-slate-500 text-slate-400 uppercase tracking-widest text-center">NEW MODULES ADDED BI-WEEKLY</p>
                            </Card>
                        </div>
                    </div>
                </div>
            );

            const LearningPathView = () => (
                <div className="space-y-8 animate-fade-in pb-12">
                    <div className="flex items-center gap-4 mb-8">
                        <button onClick={() => setView('dashboard')} className="p-3 rounded-xl dark:bg-white/5 bg-white border dark:border-white/10 border-slate-200 text-slate-400 hover:text-brand-500 hover:border-brand-500 transition-all shadow-sm">
                            <Icon name="arrow-left" size={20} />
                        </button>
                        <div className="flex-1 flex items-center gap-6">
                            {selectedPath?.topic === 'company-culture' ? (
                                <div className="p-3 bg-brand-500/10 rounded-2xl border border-brand-500/20 shadow-[0_0_30px_rgba(var(--brand-500),0.2)]">
                                    <StatLogo type="culture-hero" className="w-10 h-10 text-brand-500" />
                                </div>
                            ) : (
                                <div className="p-3 bg-brand-500/10 rounded-2xl border border-brand-500/20">
                                    <TopicIcon topic={selectedPath?.topic} size={40} className="text-brand-500" />
                                </div>
                            )}
                            <div>
                                <h2 className="text-3xl font-bold dark:text-white text-slate-900 tracking-tight">{selectedPath?.title}</h2>
                                <div className="flex items-center gap-4 mt-1 text-[10px] font-bold uppercase tracking-widest text-slate-500">
                                    <span className="text-brand-400">{selectedPath?.difficulty}</span>
                                    <span></span>
                                    <span>{selectedPath?.estimatedHours} Hours</span>
                                    <span></span>
                                    <span className="dark:text-white text-slate-900">{(user.learningProgress?.[selectedPath?.id] || []).length} / {selectedPath?.modules.length} DONE</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-8 space-y-4">
                            {selectedPath?.modules.map((module, idx) => {
                                const isDone = (user.learningProgress?.[selectedPath.id] || []).includes(module.id);
                                return (
                                    <div key={module.id} onClick={() => {
                                        if (STRUCTURED_LEARNING_DATA[selectedPath.topic]) {
                                            onPortalOpen(selectedPath.topic);
                                        } else {
                                            setSelectedModule(module);
                                        }
                                    }} className={`holo-card rounded-2xl p-6 cursor-pointer border-l-4 transition-all hover:scale-[1.01] ${isDone ? 'border-emerald-500' : 'border-brand-500'}`}>
                                        <div className="flex items-center gap-6">
                                            <div className={`w-14 h-14 rounded-2xl flex items-center justify-center border-2 ${isDone ? 'dark:bg-emerald-500/10 bg-emerald-50 border-emerald-500/30 text-emerald-500' : 'dark:bg-brand-500/10 bg-brand-50 border-brand-500/30 text-brand-500'}`}>
                                                {isDone ? <Icon name="check" size={24} /> : <span className="text-lg font-black">{idx + 1}</span>}
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="text-lg font-bold dark:text-white text-brand-900 uppercase tracking-tight">{module.title}</h4>
                                                <p className="text-sm dark:text-slate-400 text-slate-600 mt-1">{module.description}</p>
                                            </div>
                                            <Icon name="chevron-right" size={20} className="text-slate-400" />
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="lg:col-span-4 space-y-6">
                            <Card className="!bg-brand-900/10 border-brand-500/20 p-8">
                                <h4 className="font-black text-brand-400 text-[10px] uppercase tracking-[0.3em] mb-6 flex items-center gap-2">
                                    <Icon name="sparkles" size={14} /> Tutor Cortex
                                </h4>
                                <div className="space-y-4">
                                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-relaxed">Ask AI about this specific career pathway and its industrial application.</p>
                                    <textarea placeholder="e.g., How does this path help with Senior Architect roles?" className="w-full p-4 bg-black/40 border border-white/10 rounded-xl text-white text-xs outline-none focus:border-brand-500 min-h-[100px]" />
                                    <Button className="w-full py-3" icon="zap">QUERY TUTOR</Button>
                                </div>
                            </Card>
                            <Card className="dark:bg-white/5 border-white/10">
                                <h4 className="font-black text-slate-500 text-[10px] uppercase tracking-[0.3em] mb-4">Path Intelligence</h4>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center text-xs">
                                        <span className="text-slate-400 font-bold uppercase tracking-widest">Current Velocity</span>
                                        <span className="text-white font-black">HIGH-STRATA</span>
                                    </div>
                                    <div className="flex justify-between items-center text-xs">
                                        <span className="text-slate-400 font-bold uppercase tracking-widest">Market Value</span>
                                        <span className="text-emerald-400 font-black">+14% SIG</span>
                                    </div>
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );

            const SOPHubView = () => (
                <div className="space-y-6 animate-fade-in content-fade-in">
                    <div className="flex items-center gap-4 mb-8">
                        <button onClick={() => setView('dashboard')} className="p-3 rounded-xl dark:bg-white/5 bg-white border dark:border-white/10 border-slate-200 text-slate-400 hover:text-brand-500 transition-all shadow-sm">
                            <Icon name="arrow-left" size={20} />
                        </button>
                        <h2 className="text-3xl font-black text-white tracking-tighter uppercase">SOP Library</h2>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {SOP_DATA.map(sop => (
                            <Card key={sop.id} onClick={() => { setSelectedSOP(sop); setView('sop-detail'); }} className="cursor-pointer group hover:border-brand-500 transition-all">
                                <div className="flex items-start gap-4 mb-6">
                                    <div className="w-12 h-12 rounded-xl bg-brand-500/10 text-brand-500 flex items-center justify-center group-hover:bg-brand-500 group-hover:text-white transition-all"><Icon name="file-text" size={24} /></div>
                                    <div>
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-[10px] font-mono text-slate-500 font-bold">{sop.code}</span>
                                            <span className="px-2 py-0.5 rounded bg-white/5 text-[8px] font-bold text-slate-400 uppercase tracking-widest">{sop.category}</span>
                                        </div>
                                        <h4 className="font-bold dark:text-white text-slate-900 group-hover:text-brand-500 transition-colors uppercase tracking-tight">{sop.title}</h4>
                                        <p className="text-[10px] dark:text-slate-500 text-slate-400 mt-2 font-medium leading-relaxed line-clamp-2">{sop.description}</p>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center text-[10px] uppercase font-bold tracking-widest text-slate-500 pt-4 border-t dark:border-white/5 border-slate-200">
                                    <span>Version {sop.version}</span>
                                    <span className="text-emerald-500">Active</span>
                                </div>
                            </Card>
                        ))}
                    </div>
                </div>
            );

            const SOPDetailView = () => (
                <div className="space-y-8 animate-fade-in content-fade-in">
                    <div className="flex items-center justify-between border-b dark:border-white/5 border-slate-200 pb-6 mb-8">
                        <div className="flex items-center gap-6">
                            <button onClick={() => setView('sop-hub')} className="px-5 py-3 rounded-xl dark:bg-white/5 bg-white border dark:border-white/10 border-slate-200 text-slate-400 hover:text-brand-500 transition-all shadow-sm flex items-center gap-3 font-black text-[10px] uppercase tracking-widest group">
                                <Icon name="arrow-left" size={18} className="group-hover:-translate-x-1 transition-transform" />
                                <span>Back to HUB</span>
                            </button>
                            <div>
                                <h2 className="text-3xl font-black text-white tracking-tighter uppercase">{selectedSOP?.title}</h2>
                                <p className="text-xs text-brand-400 font-mono mt-1 font-bold tracking-widest">{selectedSOP?.code} // VERSION {selectedSOP?.version}</p>
                            </div>
                        </div>
                        <div className="flex gap-4">
                            {!verifiedSOPs.includes(selectedSOP?.id) ? (
                                <Button variant="primary" icon="shield-check" onClick={() => {
                                    const next = [...verifiedSOPs, selectedSOP.id];
                                    setVerifiedSOPs(next);
                                    update({ ...user, verifiedSOPs: next });
                                    log();
                                }}>VERIFY COMPLIANCE</Button>
                            ) : (
                                <div className="px-6 py-3 bg-emerald-500/10 border border-emerald-500/30 text-emerald-500 rounded-xl text-[10px] font-black tracking-widest uppercase flex items-center gap-2">
                                    <Icon name="check-circle" size={16} />
                                    VERIFIED PROTOCOL
                                </div>
                            )}
                            <Button variant="secondary" icon="download">DOWNLOAD</Button>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-2 space-y-8">
                            <Card className="light:bg-slate-50 !p-10">
                                <h3 className="text-xl font-black text-white mb-8 border-b dark:border-white/5 border-slate-200 pb-4">PROCEDURE</h3>
                                <div className="space-y-8 text-lg leading-relaxed dark:text-slate-300 text-slate-800">
                                    {(selectedSOP?.steps || [
                                        "Initialize the system protocol by logging into the centralized interface.",
                                        "Ensure all biometric markers are active and verified."
                                    ]).map((step, idx) => (
                                        <div key={idx} className="flex gap-6">
                                            <div className="w-10 h-10 rounded-full bg-brand-500/20 text-brand-500 flex items-center justify-center font-black flex-shrink-0">{idx + 1}</div>
                                            <p>{step}</p>
                                        </div>
                                    ))}
                                    <div className="p-8 dark:bg-amber-500/10 bg-amber-50 rounded-2xl border dark:border-amber-500/20 border-amber-200 flex gap-4">
                                        <Icon name="alert-triangle" className="text-amber-500 flex-shrink-0" size={24} />
                                        <p className="text-sm dark:text-amber-200 text-amber-900 font-bold uppercase tracking-wider">Note: Failure to verify markers will result in an immediate protocol breach notification to HR Oversight.</p>
                                    </div>
                                </div>
                            </Card>
                        </div>
                        <div className="space-y-8">
                            <Card className="sticky top-6 !p-8 border-t-2 border-brand-500">
                                <h3 className="text-lg font-black text-white mb-6 flex items-center gap-3"><Icon name="sparkles" className="text-brand-400" /> NEURAL ASSISTANT</h3>
                                <div className="space-y-6">
                                    <p className="text-sm dark:text-slate-400 text-slate-600 font-medium">Ask anything about this document. My AI engine has indexed the entire protocol.</p>
                                    <textarea value={aiQuestion} onChange={(e) => setAiQuestion(e.target.value)} placeholder="e.g., What are the safety protocols?" className="w-full p-4 dark:bg-black bg-slate-50 border dark:border-white/10 border-slate-200 rounded-xl dark:text-white text-slate-900 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 min-h-[120px] font-medium" />
                                    <Button onClick={consultCortex} className="w-full py-4 text-xs" variant="primary" icon="zap">CONSULT CORTEX</Button>
                                    {aiResponse && (
                                        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="p-6 dark:bg-emerald-500/10 bg-emerald-50 rounded-2xl border dark:border-emerald-500/20 border-emerald-200">
                                            <p className="text-sm dark:text-emerald-300 text-emerald-900 font-bold leading-relaxed">{aiResponse}</p>
                                        </motion.div>
                                    )}
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );

            return (
                <>
                    <div className="p-6 lg:p-10 max-w-7xl mx-auto min-h-full">
                        <AnimatePresence mode="wait">
                            <motion.div key={view} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -10 }} transition={{ duration: 0.2 }} className="h-full">
                                {view === 'dashboard' && <DashboardView />}
                                {view === 'learning-path' && <LearningPathView />}
                                {view === 'sop-hub' && <SOPHubView />}
                                {view === 'sop-detail' && <SOPDetailView />}
                            </motion.div>
                        </AnimatePresence>
                    </div>

                    {/* PORTAL-STYLE FULLSCREEN MODAL (Independent of transforms) */}
                    {selectedModule && (
                        <div className="fixed inset-0 z-[200] bg-[#020205] flex flex-col animate-fade-in overflow-hidden">
                            {/* Immersive Header */}
                            <div className="px-8 py-6 md:px-12 border-b dark:border-white/10 border-slate-200 flex items-center justify-between dark:bg-[#050508] bg-white backdrop-blur-3xl">
                                <div className="flex items-center gap-8">
                                    <button onClick={() => setSelectedModule(null)} className="px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl text-[10px] font-black tracking-widest uppercase transition-all border border-red-500/20 flex items-center gap-2 group">
                                        <Icon name="x-circle" size={16} className="group-hover:rotate-90 transition-transform" />
                                        <span>ABORT MODULE // BACK</span>
                                    </button>
                                    <div className="h-10 w-px bg-white/10"></div>
                                    <div className="p-3 bg-brand-500/10 rounded-2xl border border-brand-500/20">
                                        <Logo className="w-12 h-12 text-brand-500" />
                                    </div>
                                    <div className="h-14 w-px bg-white/10"></div>
                                    <div>
                                        <div className="flex items-center gap-4 mb-2">
                                            <span className="px-3 py-1 rounded-lg bg-brand-500/10 text-[10px] font-black text-brand-500 uppercase tracking-[0.5em] border border-brand-500/20">{selectedPath?.category} // MODULE {selectedPath?.modules.indexOf(selectedModule) + 1}</span>
                                            <div className="flex gap-1.5">
                                                {[1, 2, 3].map(i => <div key={i} className={`w-1.5 h-1.5 rounded-full ${i <= (selectedPath?.modules.indexOf(selectedModule) + 1) ? 'bg-brand-500 shadow-[0_0_8px_rgba(var(--brand-500),0.8)]' : 'bg-slate-800'}`}></div>)}
                                            </div>
                                        </div>
                                        <h3 className="text-2xl md:text-5xl font-black dark:text-white text-slate-900 tracking-tighter uppercase leading-none">{selectedModule.title}</h3>
                                    </div>
                                </div>
                                <div className="flex items-center gap-6">
                                    <div className="hidden md:flex flex-col items-end">
                                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Protocol Sync</span>
                                        <span className="text-[11px] font-black text-emerald-500 uppercase tracking-[0.2em] animate-pulse flex items-center gap-2">
                                            <span className="w-2 h-2 rounded-full bg-emerald-500"></span>
                                            High Priority Active
                                        </span>
                                    </div>
                                    <div className="h-12 w-px bg-white/10 mx-2"></div>
                                    <button onClick={() => setSelectedModule(null)} className="p-6 bg-white/5 hover:bg-red-500/10 hover:text-red-500 rounded-[2.5rem] text-slate-400 transition-all border dark:border-white/10 border-slate-200 group shadow-2xl hover:scale-105 active:scale-95">
                                        <Icon name="x" size={28} className="group-hover:rotate-90 transition-transform" />
                                    </button>
                                </div>
                            </div>

                            {/* Immersive Content Scroller */}
                            <div className="flex-1 overflow-y-auto custom-scrollbar bg-[radial-gradient(circle_at_50%_0%,rgba(var(--brand-500),0.05),transparent_50%)]">
                                <div className="max-w-5xl mx-auto py-16 px-6 md:py-24 space-y-24">
                                    <div className="dark:bg-[#0a0a10]/80 backdrop-blur-md bg-white border dark:border-white/10 border-slate-200 rounded-[3.5rem] p-12 md:p-24 shadow-[0_0_100px_rgba(0,0,0,0.5)] relative overflow-hidden group/content">
                                        <div className="absolute top-0 right-0 p-8 opacity-10 pointer-events-none group-hover/content:opacity-20 transition-all duration-700"><Icon name="cpu" size={300} className="text-brand-500" /></div>
                                        <div className="absolute bottom-0 left-0 p-8 opacity-10 pointer-events-none group-hover/content:opacity-20 transition-all duration-700"><Icon name="brain" size={200} className="text-brand-500" /></div>

                                        <div className="prose prose-lg prose-invert max-w-none relative z-10">
                                            <div className="flex items-center gap-6 mb-16">
                                                <div className="h-0.5 w-12 bg-brand-500"></div>
                                                <span className="text-xs font-black dark:text-brand-400 text-brand-600 uppercase tracking-[0.6em]">TECHNICAL MANIFESTO</span>
                                                <div className="h-0.5 flex-1 bg-gradient-to-r from-brand-500/50 to-transparent"></div>
                                            </div>
                                            <div className="dark:text-slate-200 text-slate-800 text-lg md:text-xl leading-[1.6] whitespace-pre-wrap font-medium tracking-tight">
                                                {selectedModule.content || 'Decrypting high-priority module content. Please maintain neural sync...'}
                                            </div>
                                            <div className="mt-20 pt-12 border-t border-white/5 flex items-center justify-between">
                                                <div className="flex items-center gap-4 text-slate-500">
                                                    <Icon name="clock" size={18} />
                                                    <span className="text-xs font-black uppercase tracking-widest">Est. Reading: 8 Minutes</span>
                                                </div>
                                                <div className="text-[10px] font-black text-brand-500/50 uppercase tracking-[0.4em]">VERIFIED SOURCE // CORE SYSTEMS</div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Knowledge Verification Quiz Section */}
                                    {selectedModule.questions && selectedModule.questions.length > 0 && (
                                        <div className="space-y-12">
                                            <div className="flex flex-col items-center gap-6 mb-8">
                                                <div className="w-24 h-24 rounded-[2.5rem] bg-brand-500/10 text-brand-500 flex items-center justify-center border border-brand-500/20 shadow-[0_0_40px_rgba(var(--brand-500),0.25)] animate-pulse">
                                                    <Icon name="shield-check" size={48} />
                                                </div>
                                                <div className="text-center">
                                                    <h4 className="text-lg font-black dark:text-white text-slate-900 uppercase tracking-[0.5em] mb-2 text-center">CRYPTO-VERIFICATION</h4>
                                                    <p className="text-xs font-bold dark:text-slate-500 text-slate-400 uppercase tracking-widest text-center">PROVIDE THE CORRECT DATA RESPONSE TO VALIDATE SYNC</p>
                                                </div>
                                            </div>

                                            {selectedModule.questions.map((q, i) => (
                                                <div key={i} className="dark:bg-[#0a0a10]/60 backdrop-blur-sm bg-white border dark:border-white/10 border-slate-200 rounded-[3.5rem] p-12 md:p-20 transition-all hover:border-brand-500/50 shadow-2xl">
                                                    <div className="flex flex-col md:flex-row gap-10 mb-16">
                                                        <div className="w-20 h-20 rounded-[1.5rem] bg-brand-500/10 text-brand-500 border border-brand-500/30 flex items-center justify-center font-black text-4xl flex-shrink-0 shadow-lg">0{i + 1}</div>
                                                        <p className="text-3xl md:text-5xl font-black dark:text-white text-slate-900 tracking-tighter leading-none pt-2">{q.question}</p>
                                                    </div>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                                        {q.options.map(opt => {
                                                            const isCorrect = opt === q.correctAnswer;
                                                            return (
                                                                <button
                                                                    key={opt}
                                                                    onClick={() => {
                                                                        const btn = document.getElementById(`opt-${opt}-${i}`);
                                                                        if (isCorrect) {
                                                                            btn.classList.add('dark:bg-emerald-500/20', 'bg-emerald-100', 'border-emerald-500', 'text-emerald-500', 'shadow-[0_0_30px_rgba(16,185,129,0.3)]');
                                                                        } else {
                                                                            btn.classList.add('dark:bg-red-500/20', 'bg-red-100', 'border-red-500', 'text-red-500', 'animate-shake');
                                                                        }
                                                                    }}
                                                                    id={`opt-${opt}-${i}`}
                                                                    className="group px-12 py-10 rounded-[2.5rem] dark:bg-white/5 bg-slate-50 border dark:border-white/10 border-slate-200 text-left text-lg hover:border-brand-500 transition-all font-black tracking-widest uppercase active:scale-[0.98] flex items-center justify-between"
                                                                >
                                                                    <span>{opt}</span>
                                                                    <div className="w-4 h-4 rounded-full border-2 border-slate-700 group-hover:border-brand-500 group-hover:bg-brand-500 transition-all"></div>
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div className="h-24"></div>
                            </div>

                            {/* Contextual Footer */}
                            <div className="p-8 md:px-16 border-t dark:border-white/10 border-slate-200 dark:bg-black/90 bg-white backdrop-blur-2xl flex flex-col md:flex-row items-center justify-between gap-8 shadow-[0_-20px_50px_rgba(0,0,0,0.3)]">
                                <div className="flex items-center gap-10">
                                    <button onClick={() => setSelectedModule(null)} className="px-10 py-5 bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/30 rounded-2xl text-[10px] font-black tracking-[0.4em] uppercase group flex items-center gap-3 transition-all hover:scale-105 active:scale-95 shadow-lg">
                                        <Icon name="alert-triangle" size={18} className="animate-pulse" />
                                        TERMINATE MODULE // GO BACK
                                    </button>
                                    <div className="h-6 w-px bg-white/10 hidden md:block"></div>
                                    <div className="hidden lg:flex items-center gap-4 text-[10px] font-black text-slate-500 uppercase tracking-[0.3em]">
                                        <span className="flex h-2 w-2 rounded-full bg-brand-500 animate-ping"></span>
                                        ENCRYPTION LEVEL 4.0 // QUANTUM VERIFIED
                                    </div>
                                </div>
                                <button
                                    onClick={() => handleModuleComplete(selectedPath.id, selectedModule.id)}
                                    className="w-full md:w-auto px-16 py-8 bg-brand-500 hover:bg-brand-600 text-white font-black rounded-[2.5rem] shadow-[0_20px_40px_rgba(var(--brand-500),0.4)] transition-all hover:-translate-y-1 active:scale-95 text-xs flex items-center justify-center gap-4 border border-brand-400/50"
                                >
                                    <Icon name="shield-check" size={24} />
                                    VERIFY & COMPLETE MODULE
                                </button>
                            </div>
                        </div>
                    )}
                </>
            );
        };


        /* --- MAIN APP SHELL --- */
        const MainApp = ({ session }) => {
            const { motion, AnimatePresence } = window.Motion;
            const [cmdOpen, setCmdOpen] = useState(false);
            const [tab, setTab] = useState('dashboard');
            const [mobileOpen, setMobileOpen] = useState(false);
            const [cortexOpen, setCortexOpen] = useState(true);
            const [isExpanded, setIsExpanded] = useState(true);
            const [activePortalTopic, setActivePortalTopic] = useState(null);


            // KEY GEN
            const storageKey = session?.user?.id ? `velosify_user_${session.user.id}` : 'velosify_guest';

            const [data, setData] = useState(() => {
                const base = { themeColor: 'violet', goalName: 'GATE 2026', examDate: '2026-02-01', totalTime: 0, syllabus: [], kanban: { todo: [], doing: [], done: [] }, flashcards: [], resources: [], dsa: [], focus: { timeLeft: 1500, initialTime: 1500, isActive: false }, roadmapProgress: {}, learningProgress: {}, topicProgress: {} };
                const s = localStorage.getItem(storageKey);
                if (s) {
                    try {
                        const parsed = JSON.parse(s);
                        return { ...base, ...parsed, focus: { ...base.focus, ...(parsed.focus || {}) } };
                    } catch (e) { return base; }
                }
                return base;
            });

            // DATA PERSISTENCE
            useEffect(() => { localStorage.setItem(storageKey, JSON.stringify(data)); }, [data, storageKey]);

            // Theme Engine
            useEffect(() => {
                const r = document.documentElement;
                const t = { violet: ['99 102 241', '79 70 229', '129 140 248'], cyan: ['6 182 212', '8 145 178', '34 211 238'], emerald: ['16 185 129', '5 150 105', '52 211 153'], rose: ['244 63 94', '225 29 72', '251 113 133'] };
                const c = t[data.themeColor] || t.violet;
                r.style.setProperty('--brand-500', c[0]); r.style.setProperty('--brand-600', c[1]); r.style.setProperty('--brand-400', c[2]);
            }, [data.themeColor]);

            // Focus Timer Global
            useEffect(() => {
                let i; if (data.focus.isActive && data.focus.timeLeft > 0) {
                    i = setInterval(() => setData(d => {
                        if (d.focus.timeLeft <= 0) return { ...d, focus: { ...d.focus, isActive: false }, totalTime: d.totalTime + (d.focus.initialTime / 60) };
                        return { ...d, focus: { ...d.focus, timeLeft: d.focus.timeLeft - 1 } };
                    }), 1000);
                } return () => clearInterval(i);
            }, [data.focus.isActive]);

            // Command Palette
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); setCmdOpen(p => !p); }
                    if (e.key === 'Escape') setCmdOpen(false);
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            const log = () => setData(d => ({ ...d, totalTime: d.totalTime + 1 }));
            const logout = async () => { await window.sb.auth.signOut(); window.location.reload(); };
            const resetData = () => { if (confirm("This will include your saved data.")) { localStorage.removeItem(storageKey); window.location.reload(); } };

            return (
                <div className="relative h-screen w-screen overflow-hidden dark:bg-black bg-slate-100 transition-colors duration-500">
                    {/* LIVING BACKGROUND */}
                    <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob bg-purple-900/20 dark:bg-purple-900/20 bg-blue-100/50 dark:bg-transparent"></div>
                        <div className="absolute top-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000 bg-cyan-900/20 dark:bg-cyan-900/20 bg-purple-100/50 dark:bg-transparent"></div>
                        <div className="absolute bottom-[-10%] left-[20%] w-[50%] h-[50%] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000 bg-brand-900/20 dark:bg-brand-900/20 bg-pink-100/50 dark:bg-transparent"></div>
                    </div>

                    <div className="relative z-10 flex h-screen overflow-hidden font-sans dark:text-slate-200 text-slate-800 transition-all duration-700">
                        {cmdOpen && (
                            <div className="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-start justify-center pt-32 animate-fade-in" onClick={() => setCmdOpen(false)}>
                                <div className="w-full max-w-2xl bg-surface-900 border border-white/10 rounded-xl shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                                    <div className="flex items-center gap-4 p-4 border-b border-white/5">
                                        <Icon name="search" className="text-slate-400" />
                                        <input autoFocus placeholder="Jump to module..." className="flex-1 bg-transparent border-none outline-none text-white font-medium"
                                            onKeyDown={e => {
                                                if (e.key === 'Enter') {
                                                    const val = e.target.value.toLowerCase();
                                                    if (val.includes('dsa')) setTab('dsa');
                                                    else if (val.includes('vault') || val.includes('res')) setTab('resources');
                                                    else if (val.includes('focus')) setTab('focus');
                                                    else if (val.includes('dash')) setTab('dashboard');
                                                    setCmdOpen(false);
                                                }
                                            }}
                                        />
                                        <div className="text-[10px] font-mono text-slate-500 bg-white/5 px-2 py-1 rounded">ESC</div>
                                    </div>
                                    <div className="p-2">
                                        <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest px-3 py-2">Quick Navigation</div>
                                        {[
                                            { id: 'dashboard', l: 'Dashboard', i: 'layout-dashboard' },
                                            { id: 'dsa', l: 'DSA Tracker', i: 'code' },
                                            { id: 'resources', l: 'Data Vault', i: 'lock' },
                                            { id: 'focus', l: 'Focus Engine', i: 'zap' }
                                        ].map(x => (
                                            <button key={x.id} onClick={() => { setTab(x.id); setCmdOpen(false); }} className="w-full flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-white/5 text-slate-300 hover:text-white transition-colors text-sm text-left">
                                                <Icon name={x.i} size={16} /> {x.l}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Mobile Backdrop */}
                        {mobileOpen && <div className="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm lg:hidden" onClick={() => setMobileOpen(false)}></div>}

                        {/* Sidebar */}
                        <aside className={`fixed inset-y-0 left-0 z-50 bg-[#050510]/95 backdrop-blur-3xl border-r border-white/5 flex flex-col transition-all duration-500 cubic-bezier(0.4, 0, 0.2, 1) lg:static lg:translate-x-0 ${mobileOpen ? 'translate-x-0 shadow-[20px_0_50px_rgba(0,0,0,0.5)] w-72' : '-translate-x-full w-72'} ${isExpanded ? 'lg:w-72' : 'lg:w-24'}`}>
                            <div className={`transition-all duration-500 flex items-center justify-between ${!isExpanded ? 'lg:flex-col lg:gap-6 lg:p-4 lg:justify-center mb-6' : 'p-6 mb-2'}`}>
                                <div className={`flex items-center gap-3 group cursor-pointer ${!isExpanded ? 'justify-center' : ''}`} onClick={() => setTab('dashboard')}>
                                    <div className="relative">
                                        <Logo className="w-9 h-9 text-brand-400 group-hover:scale-110 transition-transform duration-500 z-10 relative" />
                                        <div className="absolute inset-0 bg-brand-500/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                    </div>
                                    <span className={`font-black text-xl tracking-tighter text-white transition-all duration-500 ${!isExpanded ? 'lg:opacity-0 lg:w-0 lg:hidden overflow-hidden' : 'opacity-100 w-auto'}`}>VELOSIFY</span>
                                </div>
                                <button onClick={() => setMobileOpen(false)} className="lg:hidden text-slate-400 hover:text-white"><Icon name="x" size={24} /></button>
                                <button
                                    onClick={() => setIsExpanded(!isExpanded)}
                                    className={`hidden lg:flex items-center justify-center p-1.5 rounded-lg bg-white/5 border border-white/10 text-slate-400 hover:text-white transition-all hover:border-brand-500/50 ${!isExpanded ? 'rotate-180' : ''}`}
                                >
                                    <Icon name="chevron-left" size={16} />
                                </button>
                            </div>
                            <nav className="flex-1 px-3 space-y-1 overflow-y-auto custom-scrollbar">
                                {[
                                    { id: 'dashboard', i: 'layout-grid', l: 'Dashboard' },
                                    { id: 'roadmaps', i: 'waypoints', l: 'Roadmaps' },
                                    { id: 'dsa', i: 'terminal-square', l: 'DSA Tracker' },
                                    { id: 'syllabus', i: 'library', l: 'Syllabus' },
                                    { id: 'resources', i: 'container', l: 'Data Vault' },
                                    { id: 'hr-prep', i: 'briefcase', l: 'HR Protocol' },
                                    { id: 'flashcards', i: 'gallery-vertical-end', l: 'Neuro-Cards' },
                                    { id: 'projects', i: 'trello', l: 'Task System' },
                                    { id: 'focus', i: 'aperture', l: 'Focus Hub' },
                                    { id: 'settings', i: 'sliders-horizontal', l: 'System Config' }
                                ].map(x => (
                                    <button
                                        key={x.id}
                                        onClick={() => { setTab(x.id); setMobileOpen(false); }}
                                        className={`w-full flex items-center gap-4 px-3 py-2.5 rounded-xl transition-all duration-300 group relative overflow-hidden ${tab === x.id ? 'text-white bg-brand-500/10 shadow-[0_0_20px_rgba(var(--brand-500),0.1)] border border-brand-500/20' : 'text-slate-500 hover:text-white hover:bg-white/5'} ${!isExpanded ? 'lg:justify-center lg:px-0' : ''}`}
                                    >
                                        {tab === x.id && (
                                            <motion.div
                                                layoutId="activeTab"
                                                className="absolute inset-0 bg-gradient-to-r from-brand-500/10 to-transparent opacity-50 z-0"
                                            />
                                        )}
                                        <div className={`relative z-10 transition-transform duration-300 group-hover:scale-110 ${tab === x.id ? 'text-brand-400' : ''}`}>
                                            <Icon name={x.i} size={20} />
                                        </div>
                                        <span className={`relative z-10 text-[11px] font-bold uppercase tracking-[0.15em] transition-all duration-500 ${!isExpanded ? 'lg:opacity-0 lg:w-0 lg:hidden transform translate-x-4' : 'opacity-100 transform translate-x-0'}`}>
                                            {x.l}
                                        </span>
                                        {tab === x.id && <div className="absolute right-0 top-1/2 -translate-y-1/2 h-6 w-1 bg-brand-500 rounded-l-full shadow-[0_0_15px_rgba(var(--brand-500),1)] z-20"></div>}
                                    </button>
                                ))}
                            </nav>
                            <div className={`p-6 border-t border-white/5 bg-transparent mt-auto transition-all duration-500 ${!isExpanded ? 'lg:items-center lg:justify-center' : ''}`}>
                                <div className={`flex items-center gap-3 mb-6 ${!isExpanded ? 'lg:flex-col lg:text-center' : ''}`}>
                                    <div className="relative group/avatar">
                                        <div className="w-10 h-10 rounded-2xl bg-gradient-to-br from-brand-600 to-brand-400 text-white flex items-center justify-center font-black text-sm border border-white/20 shadow-lg group-hover/avatar:scale-110 transition-all duration-300">
                                            {(session.user.email || 'U').charAt(0).toUpperCase()}
                                        </div>
                                        <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-500 rounded-full border-4 border-[#050510] animate-pulse"></div>
                                    </div>
                                    <div className={`overflow-hidden transition-all duration-500 ${!isExpanded ? 'lg:opacity-0 lg:h-0 lg:w-0' : 'opacity-100 transform translate-x-0'}`}>
                                        <div className="text-[11px] font-black text-white truncate w-32 uppercase tracking-tighter">{session.user.email?.split('@')[0]}</div>
                                        <div className="flex items-center gap-1.5 mt-0.5">
                                            <div className="w-1 h-1 rounded-full bg-emerald-400 animate-ping"></div>
                                            <div className="text-[9px] text-emerald-400/80 uppercase tracking-[0.2em] font-black">Connected</div>
                                        </div>
                                    </div>
                                </div>
                                <button
                                    onClick={logout}
                                    className={`w-full py-4 flex items-center justify-center gap-3 text-[10px] font-black text-slate-500 hover:text-red-400 hover:bg-red-500/10 rounded-2xl transition-all duration-300 border border-white/5 hover:border-red-500/30 tracking-[0.3em] uppercase group active:scale-95`}
                                >
                                    <Icon name="log-out" size={14} className="group-hover:-translate-x-1 transition-transform" />
                                    <span className={!isExpanded ? 'lg:hidden' : ''}>TERMINATE</span>
                                </button>
                            </div>
                        </aside>

                        <main className="flex-1 overflow-y-auto relative z-10 flex flex-col">
                            {/* Mobile Header */}
                            <header className="lg:hidden p-4 border-b border-white/5 flex items-center justify-between bg-surface-900/50 backdrop-blur-md sticky top-0 z-30">
                                <div className="flex items-center gap-3">
                                    <Logo className="w-8 h-8 text-brand-400" />
                                    <span className="font-bold text-lg tracking-tight text-white">VELOSIFY</span>
                                </div>
                                <button onClick={() => setMobileOpen(true)} className="p-2 text-slate-300 hover:text-white transition-colors">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                                </button>
                            </header>

                            <div className="p-6 lg:p-10 max-w-7xl mx-auto min-h-full w-full">
                                {tab === 'dashboard' && <Dashboard user={data} setTab={setTab} />}
                                {tab === 'focus' && <FocusEngine focus={data.focus} setFocus={f => setData(d => ({ ...d, focus: (typeof f === 'function' ? f(d.focus) : f) }))} setTab={setTab} />}
                                {tab === 'roadmaps' && <RoadmapHub user={data} update={setData} />}
                                {tab === 'syllabus' && <Syllabus user={data} update={setData} log={log} />}
                                {tab === 'projects' && <Kanban user={data} update={setData} log={log} />}
                                {tab === 'flashcards' && <Flashcards user={data} update={setData} log={log} />}
                                {tab === 'resources' && <Vault user={data} update={setData} setTab={setTab} onPortalOpen={setActivePortalTopic} />}
                                {tab === 'dsa' && <DSATracker user={data} update={setData} log={log} />}

                                {tab === 'hr-prep' && <HRPrep user={data} update={setData} log={log} onPortalOpen={setActivePortalTopic} />}
                                {tab === 'settings' && <Settings user={data} update={setData} reset={resetData} />}
                            </div>
                        </main>

                        {/* GLOBAL NEURAL PORTAL - ROOT LEVEL FOR TRUE FULLSCREEN */}
                        <AnimatePresence>
                            {activePortalTopic && (
                                <UnifiedLearningPortal
                                    topicId={activePortalTopic}
                                    onBack={() => setActivePortalTopic(null)}
                                    user={data}
                                    update={setData}
                                />
                            )}
                        </AnimatePresence>
                    </div>
                </div>
            );
        };

        const Root = () => {
            const [ready, setReady] = useState(false);
            const [session, setSession] = useState(null);
            const [showAuth, setShowAuth] = useState(false);

            useEffect(() => {
                const check = () => { if (window.__SESSION__ !== undefined) { setSession(window.__SESSION__); setReady(true); } };
                check();
                const onAuth = (_e, s) => { setSession(s); setReady(true); };
                const { data: { subscription } } = window.sb.auth.onAuthStateChange(onAuth);
                window.addEventListener('velosify-ready', check);
                return () => { subscription.unsubscribe(); window.removeEventListener('velosify-ready', check); }
            }, []);

            if (!ready && window.__SESSION__ === undefined) return null;

            if (session) return <MainApp key={session.user.id} session={session} />;

            return (
                <>
                    <LandingPage onLogin={() => setShowAuth(true)} />
                    {showAuth && <AuthModal onClose={() => setShowAuth(false)} />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Root />);
    </script>
</body>

</html>